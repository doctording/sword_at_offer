
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>rpc · spring-note</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="doctording">
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-prism/prism.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-ace/ace.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-codeblock-filename/block.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-sectionx/sectionx.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-page-treeview/style.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../../styles/website.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="rpc.html" />
    
    
    <link rel="prev" href="distribute_id.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    [1 常见设计模式]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../design_pattern/proxy.html">
            
                <a href="../design_pattern/proxy.html">
            
                    
                    代理模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../design_pattern/singleton.html">
            
                <a href="../design_pattern/singleton.html">
            
                    
                    单例模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../design_pattern/factory.html">
            
                <a href="../design_pattern/factory.html">
            
                    
                    工厂模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../design_pattern/template.html">
            
                <a href="../design_pattern/template.html">
            
                    
                    模板方法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../design_pattern/strategy.html">
            
                <a href="../design_pattern/strategy.html">
            
                    
                    策略模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../design_pattern/decorator.html">
            
                <a href="../design_pattern/decorator.html">
            
                    
                    装饰器模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="../design_pattern/observer.html">
            
                <a href="../design_pattern/observer.html">
            
                    
                    观察者模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="../design_pattern/visitor.html">
            
                <a href="../design_pattern/visitor.html">
            
                    
                    访问者模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.9" data-path="../design_pattern/iterator.html">
            
                <a href="../design_pattern/iterator.html">
            
                    
                    迭代器模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.10" data-path="../design_pattern/facade.html">
            
                <a href="../design_pattern/facade.html">
            
                    
                    门面模式
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    [2 数据结构和算法基础]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../java_data_structure/java_basic_datastructure.html">
            
                <a href="../java_data_structure/java_basic_datastructure.html">
            
                    
                    常见基础数据结构
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="../java_data_structure/array_list.html">
            
                <a href="../java_data_structure/array_list.html">
            
                    
                    ArrayList & LinkedList
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="../java_data_structure/hash_map.html">
            
                <a href="../java_data_structure/hash_map.html">
            
                    
                    HashMap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.3" data-path="../java_data_structure/hash_table.html">
            
                <a href="../java_data_structure/hash_table.html">
            
                    
                    HashTable
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.4" data-path="../java_utils/Map.html">
            
                <a href="../java_utils/Map.html">
            
                    
                    HashMap,HashTable,ConcurrentHashMap 对比
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.5" data-path="../java_data_structure/fail_fast.html">
            
                <a href="../java_data_structure/fail_fast.html">
            
                    
                    fail-fast,ConcurrentModificationException
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.6" data-path="../java_utils/quick_sort.html">
            
                <a href="../java_utils/quick_sort.html">
            
                    
                    快排(没事手写写)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../java_data_structure/concurrent_datastructure.html">
            
                <a href="../java_data_structure/concurrent_datastructure.html">
            
                    
                    concurrent数据结构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../java_data_structure/advanced_structure.html">
            
                <a href="../java_data_structure/advanced_structure.html">
            
                    
                    高级数据结构
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.3.1" data-path="../java_data_structure/b_tree.html">
            
                <a href="../java_data_structure/b_tree.html">
            
                    
                    B/B+ Tree
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    [3 Java基础问题]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../java_data_structure/System_arraycopy.html">
            
                <a href="../java_data_structure/System_arraycopy.html">
            
                    
                    System.arraycopy, Array.copyOf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../java_utils/equals_hashcode.html">
            
                <a href="../java_utils/equals_hashcode.html">
            
                    
                    == & equals方法 & hashcode方法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../java_utils/Calendar.html">
            
                <a href="../java_utils/Calendar.html">
            
                    
                    Calendar & Date
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../java_utils/Compare.html">
            
                <a href="../java_utils/Compare.html">
            
                    
                    Comparison method violates its general contract
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../java_utils/int_Integer.html">
            
                <a href="../java_utils/int_Integer.html">
            
                    
                    int(基本类型) & Integer(包装类类型)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../java_utils/exception.html">
            
                <a href="../java_utils/exception.html">
            
                    
                    Java异常&错误
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../java_utils/String.html">
            
                <a href="../java_utils/String.html">
            
                    
                    String,StringBuffer,StringBuilder
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../java_utils/reflect.html">
            
                <a href="../java_utils/reflect.html">
            
                    
                    反射机制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="../java_utils/call_back.html">
            
                <a href="../java_utils/call_back.html">
            
                    
                    回调 & 事件机制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.10" data-path="../java_utils/array_collection.html">
            
                <a href="../java_utils/array_collection.html">
            
                    
                    数组，集合转换等问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.11" data-path="../java_utils/annotation.html">
            
                <a href="../java_utils/annotation.html">
            
                    
                    注解 Annotation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.12" data-path="../java_jvm/jvm_runtime.html">
            
                <a href="../java_jvm/jvm_runtime.html">
            
                    
                    Runtime类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.13" data-path="../java_data_structure/unsafe.html">
            
                <a href="../java_data_structure/unsafe.html">
            
                    
                    unsafe
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.14" data-path="../java_thinking_in_Java/basic.html">
            
                <a href="../java_thinking_in_Java/basic.html">
            
                    
                    《Java编程思想》第3章：操作符，第4章：控制执行流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.15" data-path="../java_thinking_in_Java/constructor.html">
            
                <a href="../java_thinking_in_Java/constructor.html">
            
                    
                    《Java编程思想》第5章：初始化和清理(重点)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.16" data-path="../java_thinking_in_Java/public_private_protect.html">
            
                <a href="../java_thinking_in_Java/public_private_protect.html">
            
                    
                    《Java编程思想》第6章：访问权限控制(重要)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.17" data-path="../java_thinking_in_Java/class_final.html">
            
                <a href="../java_thinking_in_Java/class_final.html">
            
                    
                    《Java编程思想》第7章：复用类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.18" data-path="../java_thinking_in_Java/polymorphism.html">
            
                <a href="../java_thinking_in_Java/polymorphism.html">
            
                    
                    《Java编程思想》第8章：多态
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.19" data-path="../java_thinking_in_Java/class_final.html">
            
                <a href="../java_thinking_in_Java/class_final.html">
            
                    
                    《Java编程思想》第9章：接口 补充：抽象类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.20" data-path="../java_thinking_in_Java/innner_class.html">
            
                <a href="../java_thinking_in_Java/innner_class.html">
            
                    
                    《Java编程思想》第10章：内部类
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    [4 Java多线程 & 并发基础]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../java_thread_concurrent/thread_basic.html">
            
                <a href="../java_thread_concurrent/thread_basic.html">
            
                    
                    线程基础
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1" data-path="../java_thread_concurrent/thread_design.html">
            
                <a href="../java_thread_concurrent/thread_design.html">
            
                    
                    多线程设计模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.2" data-path="../java_thread_concurrent/hook_thread.html">
            
                <a href="../java_thread_concurrent/hook_thread.html">
            
                    
                    Hook线程
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../java_thread_concurrent/thread_pool.html">
            
                <a href="../java_thread_concurrent/thread_pool.html">
            
                    
                    线程池
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.2.1" data-path="../java_thread_concurrent/concurrency_problems.html">
            
                <a href="../java_thread_concurrent/concurrency_problems.html">
            
                    
                    常见的多线程题目
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.2" data-path="../java_thread_concurrent/thread_pool_self.html">
            
                <a href="../java_thread_concurrent/thread_pool_self.html">
            
                    
                    自定义线程池
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../java_thread_concurrent/cas.html">
            
                <a href="../java_thread_concurrent/cas.html">
            
                    
                    CAS(Conmpare And Swap/Exchange) & unsafe
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../java_thread_concurrent/aqs.html">
            
                <a href="../java_thread_concurrent/aqs.html">
            
                    
                    AQS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" >
            
                <span>
            
                    
                    [常见关键字和类]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.5.1" data-path="../java_thread_concurrent/countdownlatch_cyclicBarrier.html">
            
                <a href="../java_thread_concurrent/countdownlatch_cyclicBarrier.html">
            
                    
                    CountDownLatch & CyclicBarrier
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5.2" data-path="../java_thread_concurrent/longAdder.html">
            
                <a href="../java_thread_concurrent/longAdder.html">
            
                    
                    LongAdder
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5.3" data-path="../java_thread_concurrent/semaphore.html">
            
                <a href="../java_thread_concurrent/semaphore.html">
            
                    
                    Semaphore
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5.4" data-path="../java_thread_concurrent/volatile.html">
            
                <a href="../java_thread_concurrent/volatile.html">
            
                    
                    volatile 关键字
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5.5" data-path="../java_thread_concurrent/synchronized.html">
            
                <a href="../java_thread_concurrent/synchronized.html">
            
                    
                    synchronized 关键字
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="../java_thread_concurrent/thread_lock.html">
            
                <a href="../java_thread_concurrent/thread_lock.html">
            
                    
                    Java Lock
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.6.1" data-path="../java_thread_concurrent/thread_lock_type.html">
            
                <a href="../java_thread_concurrent/thread_lock_type.html">
            
                    
                    Java Lock 分类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6.2" data-path="../java_thread_concurrent/thread_deadlock.html">
            
                <a href="../java_thread_concurrent/thread_deadlock.html">
            
                    
                    Thread 死锁问题
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="../java_thread_concurrent/threadLocal.html">
            
                <a href="../java_thread_concurrent/threadLocal.html">
            
                    
                    ThreadLocal
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    [5 Java8]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../java8/java8_completableFuture.html">
            
                <a href="../java8/java8_completableFuture.html">
            
                    
                    CompletableFuture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../java8/java8_future.html">
            
                <a href="../java8/java8_future.html">
            
                    
                    Future
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../java8/interface_default.html">
            
                <a href="../java8/interface_default.html">
            
                    
                    interface defalt static
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../java8/java8_mem.html">
            
                <a href="../java8/java8_mem.html">
            
                    
                    Java8 jvm内存结构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../java8/lambda.html">
            
                <a href="../java8/lambda.html">
            
                    
                    Java8 lambda表达式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../java8/java8_optional.html">
            
                <a href="../java8/java8_optional.html">
            
                    
                    Java8 Optional
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="../java8/streams.html">
            
                <a href="../java8/streams.html">
            
                    
                    Java8 Streams
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="../java8/streams_parallel.html">
            
                <a href="../java8/streams_parallel.html">
            
                    
                    Java8 并行数据处理与性能
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                    [6 JVM]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../java_jvm/jvm_mem_model.html">
            
                <a href="../java_jvm/jvm_mem_model.html">
            
                    
                    内存模型与线程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../java_jvm/jvm_class_load.html">
            
                <a href="../java_jvm/jvm_class_load.html">
            
                    
                    类加载机制,类加载器,内存布局
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../java_jvm/jvm_mem_gc.html">
            
                <a href="../java_jvm/jvm_mem_gc.html">
            
                    
                    堆栈 & 各种GC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../java_jvm/jvm_params.html">
            
                <a href="../java_jvm/jvm_params.html">
            
                    
                    JVM参数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../java_jvm/jvm_tools.html">
            
                <a href="../java_jvm/jvm_tools.html">
            
                    
                    JVM命令工具(jstack,jmap,jcmd...)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                    [7 缓存 & 限流]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../db_cache/LFU.html">
            
                <a href="../db_cache/LFU.html">
            
                    
                    LFU
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../db_cache/LRU.html">
            
                <a href="../db_cache/LRU.html">
            
                    
                    LRU
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../db_cache/consistent_hash.html">
            
                <a href="../db_cache/consistent_hash.html">
            
                    
                    一致性Hash
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../db_cache/bloom.html">
            
                <a href="../db_cache/bloom.html">
            
                    
                    布隆过滤器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="../db_cache/cache.html">
            
                <a href="../db_cache/cache.html">
            
                    
                    缓存
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.6" data-path="flow_limit.html">
            
                <a href="flow_limit.html">
            
                    
                    限流
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.7" data-path="../java_thread_concurrent/cpu_cache.html">
            
                <a href="../java_thread_concurrent/cpu_cache.html">
            
                    
                    CPU,缓存
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" >
            
                <span>
            
                    
                    [8 数据库]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../db_cache/mysql.html">
            
                <a href="../db_cache/mysql.html">
            
                    
                    数据库/表/查询
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" >
            
                <span>
            
                    
                    [9 I/O & 网络]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../java_io_net/io_interrupte.html">
            
                <a href="../java_io_net/io_interrupte.html">
            
                    
                    IO和中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../java_io_net/io_basic.html">
            
                <a href="../java_io_net/io_basic.html">
            
                    
                    IO基础
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.2.1" data-path="../java_io_net/nio_basic.html">
            
                <a href="../java_io_net/nio_basic.html">
            
                    
                    nio
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2.2" data-path="../java_io_net/from_io_to_epoll.html">
            
                <a href="../java_io_net/from_io_to_epoll.html">
            
                    
                    从io到epoll
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="../java_io_net/http_tcp.html">
            
                <a href="../java_io_net/http_tcp.html">
            
                    
                    http & tcp
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="nginx.html">
            
                <a href="nginx.html">
            
                    
                    nginx基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="tomcat.html">
            
                <a href="tomcat.html">
            
                    
                    tomcat
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" >
            
                <span>
            
                    
                    [10 分布式]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="distribute.html">
            
                <a href="distribute.html">
            
                    
                    分布式基础
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1.1" data-path="distribute_tx.html">
            
                <a href="distribute_tx.html">
            
                    
                    分布式事务
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.2" data-path="distribute_lock.html">
            
                <a href="distribute_lock.html">
            
                    
                    分布式锁
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.3" data-path="distribute_id.html">
            
                <a href="distribute_id.html">
            
                    
                    分布式ID
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter active" data-level="1.11.2" data-path="rpc.html">
            
                <a href="rpc.html">
            
                    
                    rpc
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.11.3" data-path="rpc.html">
            
                <a href="rpc.html">
            
                    
                    rpc
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.4" data-path="design.html">
            
                <a href="design.html">
            
                    
                    网络设计模式
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" >
            
                <span>
            
                    
                    [11 剑指offer]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="../thought_of_solve/thought.html">
            
                <a href="../thought_of_solve/thought.html">
            
                    
                    剑指Offer解题思路(全)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >rpc</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div class="treeview__container"><div class="treeview__container-title"><span class="treeview__main-title">Treeview</span><span class="treeview__copyright">Copyright @doctording all right reserved, powered by <a href="https://github.com/aleen42" target="_blank">aleen42</a></span></div><ul>
<li><div><a href="#rpcremote-procedure-call">rpc(Remote Procedure Call)</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#rpc-&#x95EE;&#x9898;&#x5F15;&#x5165;">rpc &#x95EE;&#x9898;&#x5F15;&#x5165;</a><i></i></div></li>
<li><div><a href="#&#x4F20;&#x7EDF;&#x7684;socket&#x7F16;&#x7A0B;">&#x4F20;&#x7EDF;&#x7684;socket&#x7F16;&#x7A0B;</a><i></i></div></li>
<li><div><a href="#stub&#x4EE3;&#x7406;&#x7C7B;&#x5C4F;&#x853D;&#x7F51;&#x7EDC;&#x7EC6;&#x8282;">Stub&#x4EE3;&#x7406;&#x7C7B;&#x5C4F;&#x853D;&#x7F51;&#x7EDC;&#x7EC6;&#x8282;</a><i></i></div></li>
<li><div><a href="#&#x53CD;&#x5C04;--&#x52A8;&#x6001;&#x4EE3;&#x7406;">&#x53CD;&#x5C04; + &#x52A8;&#x6001;&#x4EE3;&#x7406;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#&#x6539;&#x8FDB;">&#x6539;&#x8FDB;</a><i></i></div></li>
</ul></li>
<li><div><a href="#&#x4EFB;&#x610F;&#x670D;&#x52A1;&#x7684;&#x7075;&#x6D3B;&#x652F;&#x6301;">&#x4EFB;&#x610F;&#x670D;&#x52A1;&#x7684;&#x7075;&#x6D3B;&#x652F;&#x6301;</a><i></i></div></li>
<li><div><a href="#rpc-&#x5E8F;&#x5217;&#x5316;&#x534F;&#x8BAE;">RPC &#x5E8F;&#x5217;&#x5316;&#x534F;&#x8BAE;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#&#x7528;&#x5E8F;&#x5217;&#x5316;&#x534F;&#x8BAE;&#x6539;&#x5199;&#x4EE3;&#x7801;">&#x7528;&#x5E8F;&#x5217;&#x5316;&#x534F;&#x8BAE;&#x6539;&#x5199;&#x4EE3;&#x7801;</a><i></i></div></li>
</ul></li>
<li><div><a href="#rpc-&#x7F51;&#x7EDC;&#x534F;&#x8BAE;">RPC &#x7F51;&#x7EDC;&#x534F;&#x8BAE;</a><i></i></div></li>
<li><div><a href="#&#x56DE;&#x987E;rpc">&#x56DE;&#x987E;RPC</a><i></i></div></li>
<li><div><a href="#&#x4E3A;&#x4EC0;&#x4E48;&#x9700;&#x8981;&#x670D;&#x52A1;&#x6CE8;&#x518C;&#x4E0E;&#x53D1;&#x73B0;">&#x4E3A;&#x4EC0;&#x4E48;&#x9700;&#x8981;&#x670D;&#x52A1;&#x6CE8;&#x518C;&#x4E0E;&#x53D1;&#x73B0;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#&#x670D;&#x52A1;&#x53D1;&#x73B0;">&#x670D;&#x52A1;&#x53D1;&#x73B0;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#&#x5BA2;&#x6237;&#x7AEF;&#x5B9E;&#x73B0;">&#x5BA2;&#x6237;&#x7AEF;&#x5B9E;&#x73B0;</a><i></i></div></li>
<li><div><a href="#&#x670D;&#x52A1;&#x7AEF;&#x5B9E;&#x73B0;">&#x670D;&#x52A1;&#x7AEF;&#x5B9E;&#x73B0;</a><i></i></div></li>
<li><div><a href="#&#x670D;&#x52A1;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#xFF08;service-registry&#xFF09;">&#x670D;&#x52A1;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#xFF08;Service Registry&#xFF09;</a><i></i></div></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</div>


<p>[TOC]</p>
<h1 id="rpcremote-procedure-call">rpc(Remote Procedure Call)</h1>
<p>Remote Procedure Call (RPC) is a powerful technique for constructing distributed, client-server based applications. It is based on extending the conventional local procedure calling so that the called procedure need not exist in the same address space as the calling procedure. The two processes may be on the same system, or they may be on different systems with a network connecting them.</p>
<h2 id="rpc-&#x95EE;&#x9898;&#x5F15;&#x5165;">rpc &#x95EE;&#x9898;&#x5F15;&#x5165;</h2>
<p>&#x4E24;&#x53F0;&#x4E0D;&#x540C;&#x7684;&#x4E3B;&#x673A;&#x8FDB;&#x7A0B;&#x8981;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#xFF1F;</p>
<p>&#x6700;&#x6613;&#x60F3;&#x5230;&#x7684;&#x6700;&#x539F;&#x59CB;&#x505A;&#x6CD5;&#xFF1A;tcp/ip&#x901A;&#x4FE1;&#xFF0C;&#x4E8C;&#x8FDB;&#x5236;&#x6570;&#x636E;&#x4F20;&#x8F93;</p>
<ul>
<li>&#x86EE;&#x70E6;&#x70B9;&#xFF1A;&#x5199;&#x7F51;&#x7EDC;&#xFF1B;&#x670D;&#x52A1;&#x52A8;&#x6001;&#x6269;&#x5C55;&#x540E;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x53C8;&#x5F97;&#x5BF9;&#x63A5;&#x5904;&#x7406;&#x4E86;</li>
</ul>
<p>&#x5982;&#x4E0B;&#x4E00;&#x70B9;&#x4E00;&#x70B9;&#x7684;&#x6539;&#x8FDB;&#x51FA;&#x6765;&#xFF08;&#x53C2;&#x8003;&#xFF1A;&#x9A6C;&#x58EB;&#x5175;&#x8001;&#x5E08;&#x7684;RPC&#x8BB2;&#x89E3;&#x8BFE;&#x7A0B;&#xFF09;&#xFF0C;&#x77E5;&#x8BC6;&#x70B9;</p>
<ul>
<li>JAVA socket&#x7F16;&#x7A0B;&#x57FA;&#x7840;</li>
<li>JAVA&#x53CD;&#x5C04;</li>
<li>&#x4EE3;&#x7406;&#x6A21;&#x5F0F;/&#x52A8;&#x6001;&#x4EE3;&#x7406;</li>
<li>&#x5E8F;&#x5217;&#x5316;</li>
</ul>
<h2 id="&#x4F20;&#x7EDF;&#x7684;socket&#x7F16;&#x7A0B;">&#x4F20;&#x7EDF;&#x7684;socket&#x7F16;&#x7A0B;</h2>
<ul>
<li>User</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> rpc<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">Serializable</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Author mubi
 * @Date 2020/5/18 23:10
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setId</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;User{&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;id=&quot;</span> <span class="token operator">+</span> id <span class="token operator">+</span>
                <span class="token string">&quot;, name=&apos;&quot;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">&apos;\&apos;&apos;</span> <span class="token operator">+</span>
                <span class="token string">&apos;}&apos;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>IUserService</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> rpc<span class="token punctuation">;</span>

<span class="token comment">/**
 * @Author mubi
 * @Date 2020/5/18 23:10
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IUserService</span> <span class="token punctuation">{</span>
    <span class="token class-name">User</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>UserServiceImpl</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> rpc<span class="token punctuation">;</span>

<span class="token comment">/**
 * @Author mubi
 * @Date 2020/5/18 23:10
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">IUserService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token string">&quot;zhang&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>Server</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> rpc<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">ServerSocket</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">Socket</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Author mubi
 * @Date 2020/5/18 23:18
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Server</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// &#x76D1;&#x542C;&#x6307;&#x5B9A;&#x7684;&#x7AEF;&#x53E3;</span>
        <span class="token keyword">int</span> port <span class="token operator">=</span> <span class="token number">55533</span><span class="token punctuation">;</span>
        <span class="token class-name">ServerSocket</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// server&#x5C06;&#x4E00;&#x76F4;&#x7B49;&#x5F85;&#x8FDE;&#x63A5;&#x7684;&#x5230;&#x6765;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;server&#x5C06;&#x4E00;&#x76F4;&#x7B49;&#x5F85;&#x8FDE;&#x63A5;&#x7684;&#x5230;&#x6765;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Socket</span> socket <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// &#x5EFA;&#x7ACB;&#x597D;&#x8FDE;&#x63A5;&#x540E;&#xFF0C;&#x4ECE;socket&#x4E2D;&#x83B7;&#x53D6;&#x8F93;&#x5165;&#x6D41;&#xFF0C;&#x5E76;&#x5EFA;&#x7ACB;&#x7F13;&#x51B2;&#x533A;&#x8FDB;&#x884C;&#x8BFB;&#x53D6;</span>
        <span class="token class-name">InputStream</span> in <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">OutputStream</span> out <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DataInputStream</span> dis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DataOutputStream</span> dos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">int</span> id <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;client send id:&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">IUserService</span> userService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">getUserById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>

        dos<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dos<span class="token punctuation">.</span><span class="token function">writeUTF</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dos<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        server<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>client</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> rpc<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">Socket</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Author mubi
 * @Date 2020/5/18 23:18
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// &#x8981;&#x8FDE;&#x63A5;&#x7684;&#x670D;&#x52A1;&#x7AEF;IP&#x5730;&#x5740;&#x548C;&#x7AEF;&#x53E3;</span>
        <span class="token class-name">String</span> host <span class="token operator">=</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> port <span class="token operator">=</span> <span class="token number">55533</span><span class="token punctuation">;</span>
        <span class="token comment">// &#x4E0E;&#x670D;&#x52A1;&#x7AEF;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;</span>
        <span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// &#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x540E;&#x83B7;&#x5F97;&#x8F93;&#x51FA;&#x6D41;</span>
        <span class="token class-name">ByteArrayOutputStream</span> byteArrayOutputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DataOutputStream</span> dos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>byteArrayOutputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dos<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>byteArrayOutputStream<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">InputStream</span> in <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DataInputStream</span> dis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> id <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readUTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>

        socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<h2 id="stub&#x4EE3;&#x7406;&#x7C7B;&#x5C4F;&#x853D;&#x7F51;&#x7EDC;&#x7EC6;&#x8282;"><code>Stub</code>&#x4EE3;&#x7406;&#x7C7B;&#x5C4F;&#x853D;&#x7F51;&#x7EDC;&#x7EC6;&#x8282;</h2>
<p>client &#x8BBF;&#x95EE;&#x592A;&#x590D;&#x6742;&#xFF0C;&#x4E14;&#x7F51;&#x7EDC;&#x8FD9;&#x90E8;&#x5206;&#x975E;&#x5F97;&#x4E86;&#x89E3;&#x4E0D;&#x53EF;</p>
<ul>
<li><p>&#x4E00;&#x4E2A;&#x4EE3;&#x7406;<code>Stub</code>&#x7C7B;&#xFF0C;&#x628A;&#x7F51;&#x7EDC;&#x8FD9;&#x90E8;&#x5206;&#x7ED9;&#x5C01;&#x88C5;&#x4E0B;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x8F7B;&#x677E;&#x70B9;</p>
</li>
<li><p>client</p>
</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> rpc<span class="token punctuation">;</span>

<span class="token comment">/**
 * @Author mubi
 * @Date 2020/5/18 23:18
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// &#x4EE3;&#x7406;</span>
        <span class="token class-name">Stub</span> stub <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Stub</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stub<span class="token punctuation">.</span><span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>Stub</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> rpc<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">DataInputStream</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">DataOutputStream</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">InputStream</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">Socket</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Author mubi
 * @Date 2020/5/18 23:18
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Stub</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token comment">// &#x8981;&#x8FDE;&#x63A5;&#x7684;&#x670D;&#x52A1;&#x7AEF;IP&#x5730;&#x5740;&#x548C;&#x7AEF;&#x53E3;</span>
        <span class="token class-name">String</span> host <span class="token operator">=</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> port <span class="token operator">=</span> <span class="token number">55533</span><span class="token punctuation">;</span>
        <span class="token comment">// &#x4E0E;&#x670D;&#x52A1;&#x7AEF;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;</span>
        <span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// &#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x540E;&#x83B7;&#x5F97;&#x8F93;&#x51FA;&#x6D41;</span>
        <span class="token class-name">ByteArrayOutputStream</span> byteArrayOutputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DataOutputStream</span> dos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>byteArrayOutputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dos<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>byteArrayOutputStream<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">InputStream</span> in <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DataInputStream</span> dis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> userId <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> userName <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readUTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> userName<span class="token punctuation">)</span><span class="token punctuation">;</span>

        socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> user<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<h2 id="&#x53CD;&#x5C04;--&#x52A8;&#x6001;&#x4EE3;&#x7406;">&#x53CD;&#x5C04; + &#x52A8;&#x6001;&#x4EE3;&#x7406;</h2>
<p>&#x65E2;&#x7136;&#x670D;&#x52A1;&#x7AEF; &#x548C; &#x5BA2;&#x6237;&#x7AEF;&#x90FD;&#x77E5;&#x9053;&#x7EA6;&#x5B9A;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x90A3;&#x4E48;Stub&#x76F4;&#x63A5;&#x628A;&#x8C03;&#x7528;&#x4F20;&#x9012;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x53C2;&#x6570;&#x4EC0;&#x4E48;&#x7684;&#x76F4;&#x63A5;&#x7ED9;&#x670D;&#x52A1;&#x7AEF;&#xFF1B;&#x670D;&#x52A1;&#x7AEF;&#x901A;&#x8FC7;&#x53CD;&#x5C04;&#x6267;&#x884C;&#xFF0C;&#x628A;&#x7ED3;&#x679C;&#x8FD4;&#x56DE;&#x7ED9; Stub &#x5C31;&#x884C;&#x4E86;; Stub &#x628A; &#x670D;&#x52A1;&#x7AEF;&#x6267;&#x884C;&#x7684; service&#x7C7B; &#x4EE3;&#x7406;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#xFF1B;</p>
<p>&#x8FD9;&#x6837;&#xFF1A;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8C03;&#x7528;&#xFF0C;&#x5C31;&#x5F88;&#x7B80;&#x5355;&#xFF1A;&#x5F97;&#x5230;service&#x5BF9;&#x8C61;&#xFF0C;&#x76F4;&#x63A5;&#x8C03;&#x7528;service&#x7684;&#x65B9;&#x6CD5;&#x5C31;&#x597D;&#x4E86;&#xFF1B;service&#x589E;&#x52A0;&#x65B9;&#x6CD5;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x4E5F;&#x662F;&#x76F4;&#x63A5;&#x8C03;&#x7528;</p>
<ul>
<li>Client</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> rpc<span class="token punctuation">;</span>

<span class="token comment">/**
 * @Author mubi
 * @Date 2020/5/18 23:18
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">IUserService</span> iUserService <span class="token operator">=</span> <span class="token class-name">Stub</span><span class="token punctuation">.</span><span class="token function">getStub</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>iUserService<span class="token punctuation">.</span><span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>Server</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> rpc<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect</span><span class="token punctuation">.</span><span class="token class-name">Method</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">ServerSocket</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">Socket</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Author mubi
 * @Date 2020/5/18 23:18
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Server</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// &#x76D1;&#x542C;&#x6307;&#x5B9A;&#x7684;&#x7AEF;&#x53E3;</span>
        <span class="token keyword">int</span> port <span class="token operator">=</span> <span class="token number">55533</span><span class="token punctuation">;</span>
        <span class="token class-name">ServerSocket</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// server&#x5C06;&#x4E00;&#x76F4;&#x7B49;&#x5F85;&#x8FDE;&#x63A5;&#x7684;&#x5230;&#x6765;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;server&#x5C06;&#x4E00;&#x76F4;&#x7B49;&#x5F85;&#x8FDE;&#x63A5;&#x7684;&#x5230;&#x6765;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Socket</span> socket <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// &#x5EFA;&#x7ACB;&#x597D;&#x8FDE;&#x63A5;&#x540E;&#xFF0C;&#x4ECE;socket&#x4E2D;&#x83B7;&#x53D6;&#x8F93;&#x5165;&#x6D41;&#xFF0C;&#x5E76;&#x5EFA;&#x7ACB;&#x7F13;&#x51B2;&#x533A;&#x8FDB;&#x884C;&#x8BFB;&#x53D6;</span>
        <span class="token class-name">InputStream</span> in <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">OutputStream</span> out <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ObjectInputStream</span> objectInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DataOutputStream</span> dos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//        int id = dis.readInt();</span>
<span class="token comment">//        System.out.println(&quot;client send id:&quot; + id);</span>
<span class="token comment">//</span>
<span class="token comment">//        IUserService userService = new UserServiceImpl();</span>
<span class="token comment">//        User user = userService.getUserById(id);</span>
        <span class="token class-name">String</span> methodName <span class="token operator">=</span> objectInputStream<span class="token punctuation">.</span><span class="token function">readUTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> parameterTypes <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>objectInputStream<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> methodArgs <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>objectInputStream<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// &#x65B9;&#x6CD5;&#x5B9E;&#x73B0;&#x5728; UserServiceImpl &#x5BF9;&#x8C61;&#x4E0A;</span>
        <span class="token class-name">IUserService</span> service <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Method</span> method <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span>methodName<span class="token punctuation">,</span> parameterTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span>method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>service<span class="token punctuation">,</span> methodArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>

        dos<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dos<span class="token punctuation">.</span><span class="token function">writeUTF</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dos<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        server<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>Stub</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> rpc<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect</span><span class="token punctuation">.</span><span class="token class-name">InvocationHandler</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect</span><span class="token punctuation">.</span><span class="token class-name">Method</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect</span><span class="token punctuation">.</span><span class="token class-name">Proxy</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">Socket</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Author mubi
 * @Date 2020/5/18 23:18
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Stub</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">IUserService</span> <span class="token function">getStub</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// &#x8C03;&#x7528;&#x65B9;&#x6CD5;&#x5904;&#x7406;&#x5668;</span>
        <span class="token class-name">InvocationHandler</span> h <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InvocationHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
                <span class="token comment">// &#x8981;&#x8FDE;&#x63A5;&#x7684;&#x670D;&#x52A1;&#x7AEF;IP&#x5730;&#x5740;&#x548C;&#x7AEF;&#x53E3;</span>
                <span class="token class-name">String</span> host <span class="token operator">=</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> port <span class="token operator">=</span> <span class="token number">55533</span><span class="token punctuation">;</span>
                <span class="token comment">// &#x4E0E;&#x670D;&#x52A1;&#x7AEF;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;</span>
                <span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// &#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x540E;&#x83B7;&#x5F97;&#x8F93;&#x51FA;&#x6D41;</span>
                <span class="token class-name">ObjectOutputStream</span> oos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// &#x65B9;&#x6CD5;&#x540D;&#xFF0C;&#x53C2;&#x6570;&#x7C7B;&#x578B;&#x548C;&#x5217;&#x8868;&#xFF08;&#x628A;&#x65B9;&#x6CD5;&#x4F20;&#x9012;&#x7ED9;&#x670D;&#x52A1;&#x7AEF;&#xFF09;</span>
                <span class="token class-name">String</span> methodName <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> paramTypes <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getParameterTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                oos<span class="token punctuation">.</span><span class="token function">writeUTF</span><span class="token punctuation">(</span>methodName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>paramTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>
                oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
                oos<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token class-name">InputStream</span> in <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">DataInputStream</span> dis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> userId <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> userName <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readUTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> userName<span class="token punctuation">)</span><span class="token punctuation">;</span>

                socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">return</span> user<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token class-name">Object</span> o <span class="token operator">=</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span><span class="token class-name">IUserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
               <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token class-name">IUserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">IUserService</span><span class="token punctuation">)</span>o<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Deprecated</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token comment">// &#x8981;&#x8FDE;&#x63A5;&#x7684;&#x670D;&#x52A1;&#x7AEF;IP&#x5730;&#x5740;&#x548C;&#x7AEF;&#x53E3;</span>
        <span class="token class-name">String</span> host <span class="token operator">=</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> port <span class="token operator">=</span> <span class="token number">55533</span><span class="token punctuation">;</span>
        <span class="token comment">// &#x4E0E;&#x670D;&#x52A1;&#x7AEF;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;</span>
        <span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// &#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x540E;&#x83B7;&#x5F97;&#x8F93;&#x51FA;&#x6D41;</span>
        <span class="token class-name">ByteArrayOutputStream</span> byteArrayOutputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DataOutputStream</span> dos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>byteArrayOutputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dos<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>byteArrayOutputStream<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">InputStream</span> in <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DataInputStream</span> dis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> userId <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> userName <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readUTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> userName<span class="token punctuation">)</span><span class="token punctuation">;</span>

        socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> user<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<h3 id="&#x6539;&#x8FDB;">&#x6539;&#x8FDB;</h3>
<ul>
<li>Stub</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> rpc<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect</span><span class="token punctuation">.</span><span class="token class-name">InvocationHandler</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect</span><span class="token punctuation">.</span><span class="token class-name">Method</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect</span><span class="token punctuation">.</span><span class="token class-name">Proxy</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">Socket</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Author mubi
 * @Date 2020/5/18 23:18
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Stub</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">IUserService</span> <span class="token function">getStub</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// &#x8C03;&#x7528;&#x65B9;&#x6CD5;&#x5904;&#x7406;&#x5668;</span>
        <span class="token class-name">InvocationHandler</span> h <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InvocationHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
                <span class="token comment">// &#x8981;&#x8FDE;&#x63A5;&#x7684;&#x670D;&#x52A1;&#x7AEF;IP&#x5730;&#x5740;&#x548C;&#x7AEF;&#x53E3;</span>
                <span class="token class-name">String</span> host <span class="token operator">=</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> port <span class="token operator">=</span> <span class="token number">55533</span><span class="token punctuation">;</span>
                <span class="token comment">// &#x4E0E;&#x670D;&#x52A1;&#x7AEF;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;</span>
                <span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// &#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x540E;&#x83B7;&#x5F97;&#x8F93;&#x51FA;&#x6D41;</span>
                <span class="token class-name">ObjectOutputStream</span> oos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// &#x65B9;&#x6CD5;&#x540D;&#xFF0C;&#x53C2;&#x6570;&#x7C7B;&#x578B;&#x548C;&#x5217;&#x8868;&#xFF08;&#x628A;&#x65B9;&#x6CD5;&#x4F20;&#x9012;&#x7ED9;&#x670D;&#x52A1;&#x7AEF;&#xFF09;</span>
                <span class="token class-name">String</span> methodName <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> paramTypes <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getParameterTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                oos<span class="token punctuation">.</span><span class="token function">writeUTF</span><span class="token punctuation">(</span>methodName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>paramTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>
                oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
                oos<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//                InputStream in = socket.getInputStream();</span>
<span class="token comment">//                DataInputStream dis = new DataInputStream(in);</span>
<span class="token comment">//                int userId = dis.readInt();</span>
<span class="token comment">//                String userName = dis.readUTF();</span>
<span class="token comment">//                User user = new User(userId, userName);</span>
                <span class="token comment">// &#x76F4;&#x63A5;&#x8BFB;&#x53D6;&#x670D;&#x52A1;&#x7AEF;&#x8FD4;&#x56DE;&#x7684;&#x5BF9;&#x8C61;</span>
                <span class="token class-name">ObjectInputStream</span> objectInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> objectInputStream<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">return</span> user<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token class-name">Object</span> o <span class="token operator">=</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span><span class="token class-name">IUserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
               <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token class-name">IUserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">IUserService</span><span class="token punctuation">)</span>o<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Deprecated</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token comment">// &#x8981;&#x8FDE;&#x63A5;&#x7684;&#x670D;&#x52A1;&#x7AEF;IP&#x5730;&#x5740;&#x548C;&#x7AEF;&#x53E3;</span>
        <span class="token class-name">String</span> host <span class="token operator">=</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> port <span class="token operator">=</span> <span class="token number">55533</span><span class="token punctuation">;</span>
        <span class="token comment">// &#x4E0E;&#x670D;&#x52A1;&#x7AEF;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;</span>
        <span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// &#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x540E;&#x83B7;&#x5F97;&#x8F93;&#x51FA;&#x6D41;</span>
        <span class="token class-name">ByteArrayOutputStream</span> byteArrayOutputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DataOutputStream</span> dos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>byteArrayOutputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dos<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>byteArrayOutputStream<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">InputStream</span> in <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DataInputStream</span> dis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> userId <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> userName <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readUTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> userName<span class="token punctuation">)</span><span class="token punctuation">;</span>

        socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> user<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>Server</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> rpc<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect</span><span class="token punctuation">.</span><span class="token class-name">Method</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">ServerSocket</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">Socket</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Author mubi
 * @Date 2020/5/18 23:18
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Server</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// &#x76D1;&#x542C;&#x6307;&#x5B9A;&#x7684;&#x7AEF;&#x53E3;</span>
        <span class="token keyword">int</span> port <span class="token operator">=</span> <span class="token number">55533</span><span class="token punctuation">;</span>
        <span class="token class-name">ServerSocket</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// server&#x5C06;&#x4E00;&#x76F4;&#x7B49;&#x5F85;&#x8FDE;&#x63A5;&#x7684;&#x5230;&#x6765;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;server&#x5C06;&#x4E00;&#x76F4;&#x7B49;&#x5F85;&#x8FDE;&#x63A5;&#x7684;&#x5230;&#x6765;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Socket</span> socket <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// &#x5EFA;&#x7ACB;&#x597D;&#x8FDE;&#x63A5;&#x540E;&#xFF0C;&#x4ECE;socket&#x4E2D;&#x83B7;&#x53D6;&#x8F93;&#x5165;&#x6D41;&#xFF0C;&#x5E76;&#x5EFA;&#x7ACB;&#x7F13;&#x51B2;&#x533A;&#x8FDB;&#x884C;&#x8BFB;&#x53D6;</span>
        <span class="token class-name">InputStream</span> in <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">OutputStream</span> out <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ObjectInputStream</span> objectInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        DataOutputStream dos = new DataOutputStream(out);</span>

<span class="token comment">//        int id = dis.readInt();</span>
<span class="token comment">//        System.out.println(&quot;client send id:&quot; + id);</span>
<span class="token comment">//</span>
<span class="token comment">//        IUserService userService = new UserServiceImpl();</span>
<span class="token comment">//        User user = userService.getUserById(id);</span>
        <span class="token class-name">String</span> methodName <span class="token operator">=</span> objectInputStream<span class="token punctuation">.</span><span class="token function">readUTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> parameterTypes <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>objectInputStream<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> methodArgs <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>objectInputStream<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// &#x65B9;&#x6CD5;&#x5B9E;&#x73B0;&#x5728; UserServiceImpl &#x5BF9;&#x8C61;&#x4E0A;</span>
        <span class="token class-name">IUserService</span> service <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Method</span> method <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span>methodName<span class="token punctuation">,</span> parameterTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span>method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>service<span class="token punctuation">,</span> methodArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//        dos.writeInt(user.getId());</span>
<span class="token comment">//        dos.writeUTF(user.getName());</span>
<span class="token comment">//        dos.flush();</span>
        <span class="token comment">// &#x76F4;&#x63A5;&#x628A;&#x8FD4;&#x56DE;&#x5BF9;&#x8C61;&#x5199;&#x56DE;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;</span>
        <span class="token class-name">ObjectOutputStream</span> objectOutputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span>
        objectOutputStream<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        objectOutputStream<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        server<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<h2 id="&#x4EFB;&#x610F;&#x670D;&#x52A1;&#x7684;&#x7075;&#x6D3B;&#x652F;&#x6301;">&#x4EFB;&#x610F;&#x670D;&#x52A1;&#x7684;&#x7075;&#x6D3B;&#x652F;&#x6301;</h2>
<p>&#x5BA2;&#x6237;&#x7AEF;&#x76F4;&#x63A5;&#x4F20;&#x9012;Service&#x5230;&#x670D;&#x52A1;&#x7AEF;&#xFF0C;&#x670D;&#x52A1;&#x7AEF;&#x83B7;&#x53D6;&#x6CE8;&#x518C;&#x670D;&#x52A1;&#x7684;&#x5B9E;&#x73B0;&#x7C7B;&#xFF0C;&#x5904;&#x7406;&#x597D;&#x4E86;&#x4E4B;&#x540E;&#x8FD4;&#x56DE;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;</p>
<p>&#x4E0D;&#x7BA1;&#x591A;&#x5C11;&#x79CD;&#x670D;&#x52A1;&#xFF1B;&#x53EA;&#x8981;&#x7EA6;&#x5B9A;&#x597D;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x5373;&#x53EF;&#xFF0C;&#x57FA;&#x672C;&#x4E0D;&#x9700;&#x8981;&#x4FEE;&#x6539;<code>Stub</code>&#x76F8;&#x5173;&#x4EE3;&#x7801;; client &#x8C03;&#x7528;&#x8FDC;&#x7A0B;&#x65B9;&#x6CD5;&#xFF0C;&#x5C31;&#x50CF;&#x8C03;&#x7528;&#x672C;&#x5730;&#x65B9;&#x6CD5;&#x4E00;&#x6837;&#xFF08;&#x8FD9;&#x6837;&#x4F60;&#x4E0D;&#x9700;&#x8981;&#x61C2;&#x7F51;&#x7EDC;&#x5E95;&#x5C42;&#xFF0C;&#x76F4;&#x63A5;&#x670D;&#x52A1;&#x7AEF;&#x6709;&#x4EC0;&#x4E48;&#xFF0C;&#x4F60;&#x5C31;&#x80FD;&#x7528;&#x4EC0;&#x4E48;&#xFF09;</p>
<ul>
<li>client</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> rpc<span class="token punctuation">;</span>

<span class="token comment">/**
 * @Author mubi
 * @Date 2020/5/18 23:18
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
<span class="token comment">//        IUserService iUserService = (IUserService) Stub.getStub(IUserService.class);</span>
<span class="token comment">//        System.out.println(iUserService.getUserById(12));</span>

        <span class="token class-name">IProService</span> iProService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">IProService</span><span class="token punctuation">)</span> <span class="token class-name">Stub</span><span class="token punctuation">.</span><span class="token function">getStub</span><span class="token punctuation">(</span><span class="token class-name">IProService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>iProService<span class="token punctuation">.</span><span class="token function">getProById</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>Stub</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> rpc<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect</span><span class="token punctuation">.</span><span class="token class-name">InvocationHandler</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect</span><span class="token punctuation">.</span><span class="token class-name">Method</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect</span><span class="token punctuation">.</span><span class="token class-name">Proxy</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">Socket</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Author mubi
 * @Date 2020/5/18 23:18
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Stub</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> <span class="token function">getStub</span><span class="token punctuation">(</span><span class="token class-name">Class</span> clazz<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// &#x8C03;&#x7528;&#x65B9;&#x6CD5;&#x5904;&#x7406;&#x5668;</span>
        <span class="token class-name">InvocationHandler</span> h <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InvocationHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
                <span class="token comment">// &#x8981;&#x8FDE;&#x63A5;&#x7684;&#x670D;&#x52A1;&#x7AEF;IP&#x5730;&#x5740;&#x548C;&#x7AEF;&#x53E3;</span>
                <span class="token class-name">String</span> host <span class="token operator">=</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> port <span class="token operator">=</span> <span class="token number">55533</span><span class="token punctuation">;</span>
                <span class="token comment">// &#x4E0E;&#x670D;&#x52A1;&#x7AEF;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;</span>
                <span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// &#x7C7B;&#x540D;,&#x65B9;&#x6CD5;&#x540D;&#xFF0C;&#x53C2;&#x6570;&#x7C7B;&#x578B;&#x548C;&#x5217;&#x8868;&#xFF08;&#x628A;&#x7C7B;+&#x65B9;&#x6CD5;&#x4F20;&#x9012;&#x7ED9;&#x670D;&#x52A1;&#x7AEF;&#xFF09;</span>
                <span class="token class-name">String</span> className <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> methodName <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> paramTypes <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getParameterTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token class-name">ObjectOutputStream</span> oos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                oos<span class="token punctuation">.</span><span class="token function">writeUTF</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>
                oos<span class="token punctuation">.</span><span class="token function">writeUTF</span><span class="token punctuation">(</span>methodName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>paramTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>
                oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
                oos<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// &#x76F4;&#x63A5;&#x8BFB;&#x53D6;&#x670D;&#x52A1;&#x7AEF;&#x8FD4;&#x56DE;&#x7684;&#x5BF9;&#x8C61;</span>
                <span class="token class-name">ObjectInputStream</span> objectInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Object</span> o <span class="token operator">=</span> objectInputStream<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                objectInputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">return</span> o<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token class-name">Object</span> o <span class="token operator">=</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>clazz<span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>clazz<span class="token punctuation">}</span><span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> o<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Deprecated</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">IUserService</span> <span class="token function">getStub</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// &#x8C03;&#x7528;&#x65B9;&#x6CD5;&#x5904;&#x7406;&#x5668;</span>
        <span class="token class-name">InvocationHandler</span> h <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InvocationHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
                <span class="token comment">// &#x8981;&#x8FDE;&#x63A5;&#x7684;&#x670D;&#x52A1;&#x7AEF;IP&#x5730;&#x5740;&#x548C;&#x7AEF;&#x53E3;</span>
                <span class="token class-name">String</span> host <span class="token operator">=</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> port <span class="token operator">=</span> <span class="token number">55533</span><span class="token punctuation">;</span>
                <span class="token comment">// &#x4E0E;&#x670D;&#x52A1;&#x7AEF;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;</span>
                <span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// &#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x540E;&#x83B7;&#x5F97;&#x8F93;&#x51FA;&#x6D41;</span>
                <span class="token class-name">ObjectOutputStream</span> oos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// &#x65B9;&#x6CD5;&#x540D;&#xFF0C;&#x53C2;&#x6570;&#x7C7B;&#x578B;&#x548C;&#x5217;&#x8868;&#xFF08;&#x628A;&#x65B9;&#x6CD5;&#x4F20;&#x9012;&#x7ED9;&#x670D;&#x52A1;&#x7AEF;&#xFF09;</span>
                <span class="token class-name">String</span> methodName <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> paramTypes <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getParameterTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                oos<span class="token punctuation">.</span><span class="token function">writeUTF</span><span class="token punctuation">(</span>methodName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>paramTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>
                oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
                oos<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//                InputStream in = socket.getInputStream();</span>
<span class="token comment">//                DataInputStream dis = new DataInputStream(in);</span>
<span class="token comment">//                int userId = dis.readInt();</span>
<span class="token comment">//                String userName = dis.readUTF();</span>
<span class="token comment">//                User user = new User(userId, userName);</span>
                <span class="token comment">// &#x76F4;&#x63A5;&#x8BFB;&#x53D6;&#x670D;&#x52A1;&#x7AEF;&#x8FD4;&#x56DE;&#x7684;&#x5BF9;&#x8C61;</span>
                <span class="token class-name">ObjectInputStream</span> objectInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> objectInputStream<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">return</span> user<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token class-name">Object</span> o <span class="token operator">=</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span><span class="token class-name">IUserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
               <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token class-name">IUserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">IUserService</span><span class="token punctuation">)</span>o<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Deprecated</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token comment">// &#x8981;&#x8FDE;&#x63A5;&#x7684;&#x670D;&#x52A1;&#x7AEF;IP&#x5730;&#x5740;&#x548C;&#x7AEF;&#x53E3;</span>
        <span class="token class-name">String</span> host <span class="token operator">=</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> port <span class="token operator">=</span> <span class="token number">55533</span><span class="token punctuation">;</span>
        <span class="token comment">// &#x4E0E;&#x670D;&#x52A1;&#x7AEF;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;</span>
        <span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// &#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x540E;&#x83B7;&#x5F97;&#x8F93;&#x51FA;&#x6D41;</span>
        <span class="token class-name">ByteArrayOutputStream</span> byteArrayOutputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DataOutputStream</span> dos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>byteArrayOutputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dos<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>byteArrayOutputStream<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">InputStream</span> in <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DataInputStream</span> dis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> userId <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> userName <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readUTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> userName<span class="token punctuation">)</span><span class="token punctuation">;</span>

        socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> user<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>Server</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> rpc<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect</span><span class="token punctuation">.</span><span class="token class-name">Method</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">ServerSocket</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">Socket</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Author mubi
 * @Date 2020/5/18 23:18
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Server</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// &#x76D1;&#x542C;&#x6307;&#x5B9A;&#x7684;&#x7AEF;&#x53E3;</span>
        <span class="token keyword">int</span> port <span class="token operator">=</span> <span class="token number">55533</span><span class="token punctuation">;</span>
        <span class="token class-name">ServerSocket</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// server&#x5C06;&#x4E00;&#x76F4;&#x7B49;&#x5F85;&#x8FDE;&#x63A5;&#x7684;&#x5230;&#x6765;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;server&#x5C06;&#x4E00;&#x76F4;&#x7B49;&#x5F85;&#x8FDE;&#x63A5;&#x7684;&#x5230;&#x6765;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Socket</span> socket <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// &#x5EFA;&#x7ACB;&#x597D;&#x8FDE;&#x63A5;&#x540E;&#xFF0C;&#x4ECE;socket&#x4E2D;&#x83B7;&#x53D6;&#x8F93;&#x5165;&#x6D41;&#xFF0C;&#x5E76;&#x5EFA;&#x7ACB;&#x7F13;&#x51B2;&#x533A;&#x8FDB;&#x884C;&#x8BFB;&#x53D6;</span>
        <span class="token class-name">InputStream</span> in <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ObjectInputStream</span> objectInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> clazzName <span class="token operator">=</span> objectInputStream<span class="token punctuation">.</span><span class="token function">readUTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> methodName <span class="token operator">=</span> objectInputStream<span class="token punctuation">.</span><span class="token function">readUTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> parameterTypes <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>objectInputStream<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> methodArgs <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>objectInputStream<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Class</span> clazz <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token comment">// &#x4ECE;&#x670D;&#x52A1;&#x6CE8;&#x518C;&#x4E2D;&#x627E;&#x5230;&#x5177;&#x4F53;&#x7684;&#x7C7B;, &#x8FD9;&#x91CC;&#x5199;&#x4E2A;&#x5047;&#x7684;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>clazzName<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;rpc.IUserService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            clazz <span class="token operator">=</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>clazzName<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;rpc.IProService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            clazz <span class="token operator">=</span> <span class="token class-name">ProServiceImpl</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Method</span> method <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span>methodName<span class="token punctuation">,</span> parameterTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> o <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>clazz<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> methodArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">OutputStream</span> out <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// &#x76F4;&#x63A5;&#x628A;&#x8FD4;&#x56DE;&#x5BF9;&#x8C61;&#x5199;&#x56DE;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;</span>
        <span class="token class-name">ObjectOutputStream</span> objectOutputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span>
        objectOutputStream<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>
        objectOutputStream<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        server<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<h2 id="rpc-&#x5E8F;&#x5217;&#x5316;&#x534F;&#x8BAE;">RPC &#x5E8F;&#x5217;&#x5316;&#x534F;&#x8BAE;</h2>
<p>&#x4E0A;&#x8FF0;&#x4EE3;&#x7801;&#x4E2D;&#x6D89;&#x53CA;&#x5230;&#x4E86;&#x5BF9;&#x8C61;&#x7684;&#x5E8F;&#x5217;&#x5316;&#xFF0C;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#xFF1A;&#x628A;&#x5BF9;&#x8C61;&#x8F6C;&#x6362;&#x5B57;&#x8282;&#x6570;&#x7EC4;&#x5728;&#x7F51;&#x7EDC;&#x79CD;&#x4F20;&#x8F93;&#xFF0C;&#x7136;&#x540E;&#x53C8;&#x8BFB;&#x53D6;&#x5B57;&#x8282;&#x6570;&#x7EC4;&#xFF0C;&#x518D;&#x6B21;&#x8F6C;&#x6362;&#x4E3A;&#x539F;&#x59CB;&#x5BF9;&#x8C61;</p>
<p>&#x5E8F;&#x5217;&#x5316;&#x6846;&#x67B6;&#xFF1A;</p>
<ul>
<li>java.io.Serializable</li>
<li>Hessian</li>
<li>google protobuf</li>
<li>facebook thrift</li>
<li>kyro</li>
<li>json&#x5E8F;&#x5217;&#x5316;&#x6846;&#x67B6;&#xFF1A;Jackson&#xFF0C;google Gson&#xFF0C;alibaba FastJson</li>
<li>xmlrpc(xstream)</li>
</ul>
<h3 id="&#x7528;&#x5E8F;&#x5217;&#x5316;&#x534F;&#x8BAE;&#x6539;&#x5199;&#x4EE3;&#x7801;">&#x7528;&#x5E8F;&#x5217;&#x5316;&#x534F;&#x8BAE;&#x6539;&#x5199;&#x4EE3;&#x7801;</h3>
<ul>
<li>Stub</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> rpc<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect</span><span class="token punctuation">.</span><span class="token class-name">InvocationHandler</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect</span><span class="token punctuation">.</span><span class="token class-name">Method</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect</span><span class="token punctuation">.</span><span class="token class-name">Proxy</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">Socket</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Author mubi
 * @Date 2020/5/18 23:18
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Stub</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> <span class="token function">getStub</span><span class="token punctuation">(</span><span class="token class-name">Class</span> clazz<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// &#x8C03;&#x7528;&#x65B9;&#x6CD5;&#x5904;&#x7406;&#x5668;</span>
        <span class="token class-name">InvocationHandler</span> h <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InvocationHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
                <span class="token comment">// &#x8981;&#x8FDE;&#x63A5;&#x7684;&#x670D;&#x52A1;&#x7AEF;IP&#x5730;&#x5740;&#x548C;&#x7AEF;&#x53E3;</span>
                <span class="token class-name">String</span> host <span class="token operator">=</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> port <span class="token operator">=</span> <span class="token number">55533</span><span class="token punctuation">;</span>
                <span class="token comment">// &#x4E0E;&#x670D;&#x52A1;&#x7AEF;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;</span>
                <span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// &#x6784;&#x9020;&#x8BF7;&#x6C42;&#x670D;&#x52A1;&#x5668;&#x7684;&#x5BF9;&#x8C61;</span>
                <span class="token class-name">RpcRequest</span> rpcRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RpcRequest</span><span class="token punctuation">(</span>clazz<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        method<span class="token punctuation">.</span><span class="token function">getParameterTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// &#x4F20;&#x9012;&#x4E8C;&#x8FDB;&#x5236;&#x7ED9;&#x670D;&#x52A1;&#x7AEF;</span>
                <span class="token class-name">OutputStream</span> outputStream <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                outputStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">HessianSerializerUtil</span><span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span>rpcRequest<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                socket<span class="token punctuation">.</span><span class="token function">shutdownOutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// &#x76F4;&#x63A5;&#x8BFB;&#x53D6;&#x670D;&#x52A1;&#x7AEF;&#x8FD4;&#x56DE;&#x7684;&#x4E8C;&#x8FDB;&#x5236;, &#x53CD;&#x5E8F;&#x5217;&#x5316;&#x4E3A;&#x5BF9;&#x8C61;&#x8FD4;&#x56DE;</span>
                <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token function">readInputStream</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Object</span> o <span class="token operator">=</span> <span class="token class-name">HessianSerializerUtil</span><span class="token punctuation">.</span><span class="token function">deserialize</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>

                inputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                outputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">return</span> o<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token class-name">Object</span> o <span class="token operator">=</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>clazz<span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>clazz<span class="token punctuation">}</span><span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> o<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">readInputStream</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> inputStream<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">2048</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> len<span class="token punctuation">;</span>
        <span class="token class-name">ByteArrayOutputStream</span> bos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>len <span class="token operator">=</span> inputStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            bos<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> bos<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>Server</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> rpc<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect</span><span class="token punctuation">.</span><span class="token class-name">Method</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">ServerSocket</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">Socket</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Author mubi
 * @Date 2020/5/18 23:18
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Server</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// &#x76D1;&#x542C;&#x6307;&#x5B9A;&#x7684;&#x7AEF;&#x53E3;</span>
        <span class="token keyword">int</span> port <span class="token operator">=</span> <span class="token number">55533</span><span class="token punctuation">;</span>
        <span class="token class-name">ServerSocket</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// server&#x5C06;&#x4E00;&#x76F4;&#x7B49;&#x5F85;&#x8FDE;&#x63A5;&#x7684;&#x5230;&#x6765;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;server&#x5C06;&#x4E00;&#x76F4;&#x7B49;&#x5F85;&#x8FDE;&#x63A5;&#x7684;&#x5230;&#x6765;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Socket</span> socket <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// &#x5EFA;&#x7ACB;&#x597D;&#x8FDE;&#x63A5;&#x540E;&#xFF0C;&#x4ECE;socket&#x4E2D;&#x83B7;&#x53D6;&#x5BA2;&#x6237;&#x7AEF;&#x4F20;&#x9012;&#x8FC7;&#x6765;&#x7684;&#x5BF9;&#x8C61;</span>
        <span class="token class-name">InputStream</span> in <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RpcRequest</span> rpcRequest <span class="token operator">=</span> <span class="token class-name">HessianSerializerUtil</span><span class="token punctuation">.</span><span class="token function">deserialize</span><span class="token punctuation">(</span><span class="token function">readInputStream</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        System.out.println(&quot;rpcRequest:&quot; + rpcRequest);</span>

        <span class="token comment">// &#x6267;&#x884C;&#x65B9;&#x6CD5;</span>
        <span class="token class-name">Class</span> clazz <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// &#x4ECE;&#x670D;&#x52A1;&#x6CE8;&#x518C;&#x4E2D;&#x627E;&#x5230;&#x5177;&#x4F53;&#x7684;&#x7C7B;, &#x8FD9;&#x91CC;&#x5199;&#x4E2A;&#x5047;&#x7684;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>rpcRequest<span class="token punctuation">.</span><span class="token function">getClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;rpc.IUserService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            clazz <span class="token operator">=</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>rpcRequest<span class="token punctuation">.</span><span class="token function">getClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;rpc.IProService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            clazz <span class="token operator">=</span> <span class="token class-name">ProServiceImpl</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Method</span> method <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span>rpcRequest<span class="token punctuation">.</span><span class="token function">getMethodName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rpcRequest<span class="token punctuation">.</span><span class="token function">getParamTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> o <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>clazz<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rpcRequest<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// &#x8FD4;&#x56DE;&#x5BF9;&#x8C61; &#x4E8C;&#x8FDB;&#x5236;&#x5F62;&#x5F0F;&#x53D1;&#x9001;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;</span>
        <span class="token class-name">OutputStream</span> out <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">HessianSerializerUtil</span><span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        server<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">readInputStream</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> inputStream<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">2048</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> len<span class="token punctuation">;</span>
        <span class="token class-name">ByteArrayOutputStream</span> bos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>len <span class="token operator">=</span> inputStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            bos<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> bos<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<h2 id="rpc-&#x7F51;&#x7EDC;&#x534F;&#x8BAE;">RPC &#x7F51;&#x7EDC;&#x534F;&#x8BAE;</h2>
<p>&#x901A;&#x4FE1;&#x534F;&#x8BAE;</p>
<ul>
<li>TCP/UDP</li>
<li>Web Service</li>
<li>Restful(http + json)</li>
<li>RMI(Remote Method Invocation)</li>
<li>JMS(Java Message Service)</li>
<li>RPC(Remote Procedure Call)</li>
</ul>
<p>RPC&#x91C7;&#x7528;&#x7684;&#x7F51;&#x7EDC;&#x534F;&#x8BAE;</p>
<p>RPC&#x672C;&#x8EAB;&#x91CD;&#x70B9;&#x5728;&#x4E8E;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x5404;&#x79CD;&#x7F51;&#x7EDC;&#x534F;&#x8BAE;&#x662F;&#x5B9E;&#x73B0;&#xFF0C;&#x6BD4;&#x5982;RMI,restful&#x7B49;&#xFF0C;&#x5176;&#x4E2D;(RMI&#x4E0D;&#x80FD;&#x8DE8;&#x8BED;&#x8A00;&#xFF0C;Resful&#x57FA;&#x4E8E;http&#xFF1A;&#x5E26;&#x5BBD;&#x5360;&#x7528;&#x9AD8;&#xFF0C;&#x6548;&#x7387;&#x4F4E;)</p>
<p>RPC&#x591A;&#x7528;&#x4E8E;&#x670D;&#x52A1;&#x5668;&#x96C6;&#x7FA4;&#x95F4;&#x7684;&#x901A;&#x4FE1;</p>
<h2 id="&#x56DE;&#x987E;rpc">&#x56DE;&#x987E;RPC</h2>
<p><img src="https://raw.githubusercontent.com/doctording/sword_at_offer/master/content/distributed_design/imgs/rpc.png" alt=""></p>
<h2 id="&#x4E3A;&#x4EC0;&#x4E48;&#x9700;&#x8981;&#x670D;&#x52A1;&#x6CE8;&#x518C;&#x4E0E;&#x53D1;&#x73B0;">&#x4E3A;&#x4EC0;&#x4E48;&#x9700;&#x8981;&#x670D;&#x52A1;&#x6CE8;&#x518C;&#x4E0E;&#x53D1;&#x73B0;</h2>
<p>&#x968F;&#x7740;&#x670D;&#x52A1;&#x6570;&#x91CF;&#x7684;&#x589E;&#x591A;&#xFF0C;&#x5404;&#x4E2A;&#x670D;&#x52A1;&#x4E4B;&#x95F4;&#x7684;&#x8C03;&#x7528;&#x53D8;&#x5F97;&#x9519;&#x7EFC;&#x590D;&#x6742;&#xFF0C;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x53EF;&#x80FD;&#x4F9D;&#x8D56;&#x5916;&#x90E8;&#x591A;&#x4E2A;&#x670D;&#x52A1;&#xFF0C;&#x5F53;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x7684;&#x57DF;&#x540D;&#x6216;IP&#x5730;&#x5740;&#x6539;&#x53D8;&#x4E86;&#x4E4B;&#x540E;&#x5982;&#x4F55;&#x901A;&#x77E5;&#x4F9D;&#x8D56;&#x65B9;&#xFF0C;&#x6216;&#x8005;&#x4F9D;&#x8D56;&#x65B9;&#x5982;&#x4F55;&#x5FEB;&#x901F;&#x7684;&#x53D1;&#x73B0;&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x65B9;&#x7684;&#x5730;&#x5740;&#x53D8;&#x5316;&#x3002;</p>
<ul>
<li>&#x5BA2;&#x6237;&#x7AEF;&#x4E0E;&#x670D;&#x52A1;&#x7AEF;&#x81EA;&#x5DF1;&#x7EF4;&#x62A4;&#xFF1A;&#x6709;&#x591A;&#x5C11;&#x4E2A;&#x670D;&#x52A1;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x5C31;&#x8981;&#x7EF4;&#x62A4;&#x591A;&#x5C11;&#x4E2A;(&#x670D;&#x52A1;&#x589E;&#x51CF;&#xFF0C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF0C;&#x5FC3;&#x8DF3;)</li>
<li>&#x627E;&#x4E2A;&#x4EE3;&#x7406;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x6709;&#x9700;&#x6C42;&#x627E;&#x4EE3;&#x7406;&#xFF0C;&#x4EE3;&#x7406;&#x7EF4;&#x6301;&#x8FD9;&#x4E9B;&#x670D;&#x52A1;&#xFF0C;&#x4E5F;&#x80FD;&#x7ED9;&#x5BA2;&#x6237;&#x901A;&#x77E5;&#xFF1B;&#xFF08;&#x53EF;&#x4EE5;&#x770B;&#x6210;<code>&#x4EE3;&#x7406;&#x6A21;&#x5F0F;</code>&#xFF09;</li>
</ul>
<p><img src="https://raw.githubusercontent.com/doctording/sword_at_offer/master/content/distributed_design/imgs/rpc_reg.png" alt=""></p>
<p><strong>&#x670D;&#x52A1;&#x6CE8;&#x518C;</strong>&#x5C31;&#x662F;&#x7EF4;&#x62A4;&#x4E00;&#x4E2A;&#x767B;&#x8BB0;&#x7C3F;&#xFF0C;&#x5B83;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#x5185;&#x6240;&#x6709;&#x7684;&#x670D;&#x52A1;&#x5730;&#x5740;&#x3002;&#x5F53;&#x65B0;&#x7684;&#x670D;&#x52A1;&#x542F;&#x52A8;&#x540E;&#xFF0C;&#x5B83;&#x4F1A;&#x5411;&#x767B;&#x8BB0;&#x7C3F;&#x4EA4;&#x5F85;&#x81EA;&#x5DF1;&#x7684;&#x5730;&#x5740;&#x4FE1;&#x606F;&#x3002;&#x670D;&#x52A1;&#x7684;&#x4F9D;&#x8D56;&#x65B9;&#x76F4;&#x63A5;&#x5411;&#x767B;&#x8BB0;&#x7C3F;&#x8981;Service Provider&#x5730;&#x5740;&#x5C31;&#x884C;&#x4E86;</p>
<h3 id="&#x670D;&#x52A1;&#x53D1;&#x73B0;">&#x670D;&#x52A1;&#x53D1;&#x73B0;</h3>
<p><a href="https://www.nginx.com/blog/service-discovery-in-a-microservices-architecture/" target="_blank">Nginx Service Discovery blog</a></p>
<p>&#x95EE;&#x9898;&#xFF1A;Service instances have dynamically assigned network locations. Moreover, the set of service instances changes dynamically because of autoscaling, failures, and upgrades. Consequently, your client code needs to use a more elaborate service discovery mechanism.
&#xFF08;&#x670D;&#x52A1;&#x5B9E;&#x4F8B;&#x662F;&#x52A8;&#x6001;&#x53D8;&#x5316;(&#x6269;&#x7F29;&#x5BB9;&#xFF0C;&#x5931;&#x8D25;&#xFF0C;&#x5347;&#x7EA7;)&#x7684;&#xFF0C;&#x4E14;&#x670D;&#x52A1;&#x5B9E;&#x4F8B;&#x7684;&#x7F51;&#x7EDC;&#x5730;&#x5740;&#x662F;&#x52A8;&#x6001;&#x8C03;&#x6574;&#x7684;&#xFF1B;&#x663E;&#x7136;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x9700;&#x8981;&#x80FD;&#x53CA;&#x65F6;&#x6B63;&#x786E;&#x7684;&#x611F;&#x77E5;&#x8FD9;&#x4E9B;&#x53D8;&#x5316;&#xFF0C;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x53EF;&#x9760;&#x7684;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x673A;&#x5236;&#xFF09;&#x3002;</p>
<h4 id="&#x5BA2;&#x6237;&#x7AEF;&#x5B9E;&#x73B0;">&#x5BA2;&#x6237;&#x7AEF;&#x5B9E;&#x73B0;</h4>
<p>When using client&#x2011;side discovery, the client is responsible for determining the network locations of available service instances and load balancing requests across them. The client queries a service registry, which is a database of available service instances. The client then uses a load&#x2011;balancing algorithm to select one of the available service instances and makes a request.&#x2018;</p>
<p>&#x7F3A;&#x70B9;&#xFF1A;</p>
<p>One significant drawback of this pattern is that it couples the client with the service registry. You must implement client&#x2011;side service discovery logic for each programming language and framework used by your service clients.&#xFF08;&#x8FD9;&#x79CD;&#x6A21;&#x5F0F;&#x7684;&#x4E00;&#x4E2A;&#x91CD;&#x8981;&#x7F3A;&#x70B9;&#x662F;&#x5B83;&#x5C06;&#x5BA2;&#x6237;&#x7AEF;&#x4E0E;&#x670D;&#x52A1;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#x8026;&#x5408;&#x8D77;&#x6765;&#x3002;&#x5BA2;&#x6237;&#x7AEF;&#x5FC5;&#x987B;&#x4E3A;&#x670D;&#x52A1;&#x7AEF;&#x4F7F;&#x7528;&#x7684;&#x6BCF;&#x79CD;&#x7F16;&#x7A0B;&#x8BED;&#x8A00;&#x548C;&#x6846;&#x67B6;&#x5B9E;&#x73B0;&#x4E00;&#x5957;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x903B;&#x8F91;&#x3002;&#xFF09;</p>
<h4 id="&#x670D;&#x52A1;&#x7AEF;&#x5B9E;&#x73B0;">&#x670D;&#x52A1;&#x7AEF;&#x5B9E;&#x73B0;</h4>
<p><img src="https://raw.githubusercontent.com/doctording/sword_at_offer/master/content/distributed_design/imgs/server-discovery.png" alt=""></p>
<p>The client makes a request to a service via a load balancer. The load balancer queries the service registry and routes each request to an available service instance. As with client&#x2011;side discovery, service instances are registered and deregistered with the service registry.</p>
<p>&#x4F18;&#x7F3A;&#x70B9;&#xFF1A;</p>
<p>The server&#x2011;side discovery pattern has several benefits and drawbacks. One great benefit of this pattern is that details of discovery are abstracted away from the client. Clients simply make requests to the load balancer. This eliminates the need to implement discovery logic for each programming language and framework used by your service clients. Also, as mentioned above, some deployment environments provide this functionality for free. This pattern also has some drawbacks, however. Unless the load balancer is provided by the deployment environment, it is yet another highly available system component that you need to set up and manage.</p>
<h4 id="&#x670D;&#x52A1;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#xFF08;service-registry&#xFF09;">&#x670D;&#x52A1;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#xFF08;Service Registry&#xFF09;</h4>
<p>It is a database containing the network locations of service instances. A service registry needs to be highly available and up to date. Clients can cache network locations obtained from the service registry. However, that information eventually becomes out of date and clients become unable to discover service instances. Consequently, a service registry consists of a cluster of servers that use a replication protocol to maintain consistency.</p>
<footer class="page-footer"><span class="copyright">Copyright @doctording all right reserved&#xFF0C;powered by Gitbook</span><span class="footer-modification">&#x8BE5;&#x6587;&#x4EF6;&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;
2020-07-21 08:59:11
</span></footer>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="distribute_id.html" class="navigation navigation-prev " aria-label="Previous page: 分布式ID">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="rpc.html" class="navigation navigation-next " aria-label="Next page: rpc">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"rpc","layout":"page","date":"2020-05-18 00:00","level":"1.11.2","depth":2,"next":{"title":"rpc","level":"1.11.3","depth":2,"path":"content/distributed_design/rpc.md","ref":"./content/distributed_design/rpc.md","articles":[]},"previous":{"title":"分布式ID","level":"1.11.1.3","depth":3,"path":"content/distributed_design/distribute_id.md","ref":"./content/distributed_design/distribute_id.md","articles":[]},"dir":"ltr"},"config":{"plugins":["prism","-highlight","-lunr","-search","-sharing","ace","codeblock-filename","search-plus","sectionx","splitter","tbfed-pagefooter","expandable-chapters","back-to-top-button","code","uml","page-treeview"],"styles":{"website":"styles/website.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright @doctording","modify_label":"该文件修改时间：","modify_format":"YYYY-MM-DD HH:mm:ss"},"page-treeview":{"copyright":"Copyright @doctording","minHeaderCount":"2","minHeaderDeep":"2"},"prism":{},"ace":{},"splitter":{},"code":{"copyButtons":true},"fontsettings":{"theme":"white","family":"sans","size":2},"sectionx":{},"uml":{"format":"svg"},"codeblock-filename":{},"back-to-top-button":{},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"expandable-chapters":{},"search-plus":{}},"theme":"default","author":"doctording","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"spring-note","language":"zh-hans","gitbook":"*","description":"Java开发"},"file":{"path":"content/distributed_design/rpc.md","mtime":"2020-07-21T00:59:11.780Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-07-25T04:41:57.751Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-ace/ace/ace.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-ace/ace.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sectionx/sectionx.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

