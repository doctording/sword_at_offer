
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Java Lock · java-note</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="doctording">
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-prism/prism.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-ace/ace.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-codeblock-filename/block.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-sectionx/sectionx.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-page-treeview/style.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-advanced-emoji/emoji-website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../../styles/website.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="thread_deadlock.html" />
    
    
    <link rel="prev" href="linux_lock.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    [计算机组成]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../computer/cpu_cache.html">
            
                <a href="../computer/cpu_cache.html">
            
                    
                    CPU,缓存
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../computer/process_thread.html">
            
                <a href="../computer/process_thread.html">
            
                    
                    进程和线程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../computer/memory_manage.html">
            
                <a href="../computer/memory_manage.html">
            
                    
                    物理内存管理算法
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    [I/O & 网络]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../java_io_net/io_interrupte.html">
            
                <a href="../java_io_net/io_interrupte.html">
            
                    
                    IO与中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" >
            
                <span>
            
                    
                    [IO基础]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="../java_io_net/io_basic.html">
            
                <a href="../java_io_net/io_basic.html">
            
                    
                    Java IO基础
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1.1" data-path="../java_io_net/io_basic_pro.html">
            
                <a href="../java_io_net/io_basic_pro.html">
            
                    
                    Java IO面试题
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="../java_io_net/nio_basic.html">
            
                <a href="../java_io_net/nio_basic.html">
            
                    
                    BIO 到 NIO & 多线程问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3" data-path="../java_io_net/from_io_to_epoll.html">
            
                <a href="../java_io_net/from_io_to_epoll.html">
            
                    
                    再谈select & epoll
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.4" data-path="../java_io_net/server_socket_channel.html">
            
                <a href="../java_io_net/server_socket_channel.html">
            
                    
                    ServerSocketChannel
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../distributed_design/design.html">
            
                <a href="../distributed_design/design.html">
            
                    
                    网络IO设计模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" >
            
                <span>
            
                    
                    [网络协议]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.4.1" data-path="../java_io_net/http_tcp.html">
            
                <a href="../java_io_net/http_tcp.html">
            
                    
                    tcp & udp
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.2" data-path="../java_io_net/http_tcp_tcpdump.html">
            
                <a href="../java_io_net/http_tcp_tcpdump.html">
            
                    
                    tcp tcpdump
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.3" data-path="../java_io_net/http_tcp_pro.html">
            
                <a href="../java_io_net/http_tcp_pro.html">
            
                    
                    http & tcp面试题
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../distributed_design/nginx.html">
            
                <a href="../distributed_design/nginx.html">
            
                    
                    nginx基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../java_io_net/netty.html">
            
                <a href="../java_io_net/netty.html">
            
                    
                    netty
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    [数据库]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../db_cache/io.html">
            
                <a href="../db_cache/io.html">
            
                    
                    局部性原理&磁盘IO
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../db_cache/mysql.html">
            
                <a href="../db_cache/mysql.html">
            
                    
                    MySQL
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.1" data-path="../db_cache/mysql_batis.html">
            
                <a href="../db_cache/mysql_batis.html">
            
                    
                    MySQL连接 & MyBatis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.2" data-path="../db_cache/mysql_opt.html">
            
                <a href="../db_cache/mysql_opt.html">
            
                    
                    MySQL优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.3" data-path="../db_cache/mysql_monitor.html">
            
                <a href="../db_cache/mysql_monitor.html">
            
                    
                    MySQL线上监控 & 指标
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../db_cache/redis.html">
            
                <a href="../db_cache/redis.html">
            
                    
                    Redis
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.3.1" data-path="../db_cache/redis_skip_list.html">
            
                <a href="../db_cache/redis_skip_list.html">
            
                    
                    跳表&zset
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../db_cache/mq.html">
            
                <a href="../db_cache/mq.html">
            
                    
                    rabbitmq
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    [分布式]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" >
            
                <span>
            
                    
                    [分布式基础]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1" data-path="../distributed_design/distribute.html">
            
                <a href="../distributed_design/distribute.html">
            
                    
                    分布式&微服务
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.2" data-path="../distributed_design/distribute_data.html">
            
                <a href="../distributed_design/distribute_data.html">
            
                    
                    分布式存储
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.3" data-path="../distributed_design/distribute_tx.html">
            
                <a href="../distributed_design/distribute_tx.html">
            
                    
                    分布式事务
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.4" data-path="../distributed_design/distribute_lock.html">
            
                <a href="../distributed_design/distribute_lock.html">
            
                    
                    分布式锁
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.5" data-path="../distributed_design/distribute_id.html">
            
                <a href="../distributed_design/distribute_id.html">
            
                    
                    分布式ID
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../distributed_design/rpc.html">
            
                <a href="../distributed_design/rpc.html">
            
                    
                    rpc
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../distributed_design/zk.html">
            
                <a href="../distributed_design/zk.html">
            
                    
                    zookeeper
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.3.1" data-path="../distributed_design/zk2.html">
            
                <a href="../distributed_design/zk2.html">
            
                    
                    zookeeper单机源码 & Watch机制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.2" data-path="../distributed_design/zk3.html">
            
                <a href="../distributed_design/zk3.html">
            
                    
                    zookeeper集群 & Zab协议
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../db_cache/LFU.html">
            
                <a href="../db_cache/LFU.html">
            
                    
                    LFU
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../db_cache/LRU.html">
            
                <a href="../db_cache/LRU.html">
            
                    
                    LRU
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="../db_cache/consistent_hash.html">
            
                <a href="../db_cache/consistent_hash.html">
            
                    
                    一致性Hash
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    [缓存 & 限流]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../db_cache/cache.html">
            
                <a href="../db_cache/cache.html">
            
                    
                    缓存
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1.1" data-path="../db_cache/bloom.html">
            
                <a href="../db_cache/bloom.html">
            
                    
                    布隆过滤器
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../distributed_design/flow_limit.html">
            
                <a href="../distributed_design/flow_limit.html">
            
                    
                    限流
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                    [常见设计模式]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../design_pattern/proxy.html">
            
                <a href="../design_pattern/proxy.html">
            
                    
                    代理模式
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1.1" data-path="../design_pattern/asm.html">
            
                <a href="../design_pattern/asm.html">
            
                    
                    ASM字节码操纵
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../design_pattern/singleton.html">
            
                <a href="../design_pattern/singleton.html">
            
                    
                    单例模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../design_pattern/factory.html">
            
                <a href="../design_pattern/factory.html">
            
                    
                    工厂模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../design_pattern/template.html">
            
                <a href="../design_pattern/template.html">
            
                    
                    模板方法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../design_pattern/strategy.html">
            
                <a href="../design_pattern/strategy.html">
            
                    
                    策略模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="../design_pattern/decorator.html">
            
                <a href="../design_pattern/decorator.html">
            
                    
                    装饰器模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7" data-path="../design_pattern/observer.html">
            
                <a href="../design_pattern/observer.html">
            
                    
                    观察者模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8" data-path="../design_pattern/publish.html">
            
                <a href="../design_pattern/publish.html">
            
                    
                    发布订阅模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.9" data-path="../design_pattern/visitor.html">
            
                <a href="../design_pattern/visitor.html">
            
                    
                    访问者模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.10" data-path="../design_pattern/iterator.html">
            
                <a href="../design_pattern/iterator.html">
            
                    
                    迭代器模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.11" data-path="../design_pattern/facade.html">
            
                <a href="../design_pattern/facade.html">
            
                    
                    门面模式
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                    [数据结构和算法基础]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../java_data_structure/algorithm_structure.html">
            
                <a href="../java_data_structure/algorithm_structure.html">
            
                    
                    Java算法数据结构使用
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1.1" data-path="../java_utils/sort.html">
            
                <a href="../java_utils/sort.html">
            
                    
                    常见排序(没事手写写)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../java_data_structure/java_basic_datastructure.html">
            
                <a href="../java_data_structure/java_basic_datastructure.html">
            
                    
                    常见基础数据结构
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.2.1" data-path="../java_data_structure/array_list.html">
            
                <a href="../java_data_structure/array_list.html">
            
                    
                    ArrayList & LinkedList & Vector
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.2" data-path="../java_data_structure/hash_map.html">
            
                <a href="../java_data_structure/hash_map.html">
            
                    
                    Java8 HashMap
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.2.2.1" data-path="../java_data_structure/hash_map_java7.html">
            
                <a href="../java_data_structure/hash_map_java7.html">
            
                    
                    Java1.7 HashMap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.2.2" data-path="../java_data_structure/hash_table.html">
            
                <a href="../java_data_structure/hash_table.html">
            
                    
                    HashTable
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.2.3" data-path="../java_data_structure/linked_hash_map.html">
            
                <a href="../java_data_structure/linked_hash_map.html">
            
                    
                    LinkedHashMap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.2.4" data-path="../java_data_structure/tree_map.html">
            
                <a href="../java_data_structure/tree_map.html">
            
                    
                    TreeMap
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.2.3" data-path="../java_data_structure/fail_fast.html">
            
                <a href="../java_data_structure/fail_fast.html">
            
                    
                    fail-fast,ConcurrentModificationException
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.4" data-path="../java_data_structure/concurrent_datastructure.html">
            
                <a href="../java_data_structure/concurrent_datastructure.html">
            
                    
                    concurrent数据结构
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.2.4.1" data-path="../java_data_structure/concurrent_hashmap.html">
            
                <a href="../java_data_structure/concurrent_hashmap.html">
            
                    
                    Java8 ConcurrentMap
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.2.4.1.1" data-path="../java_data_structure/concurrent_hashmap7.html">
            
                <a href="../java_data_structure/concurrent_hashmap7.html">
            
                    
                    Jdk1.7 ConcurrentMap
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.2.4.2" data-path="../java_data_structure/queue.html">
            
                <a href="../java_data_structure/queue.html">
            
                    
                    Java中的队列
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.2.5" data-path="../java_data_structure/Map.html">
            
                <a href="../java_data_structure/Map.html">
            
                    
                    HashMap,HashTable,ConcurrentHashMap对比
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../java_data_structure/advanced_structure.html">
            
                <a href="../java_data_structure/advanced_structure.html">
            
                    
                    高级数据结构
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.3.1" data-path="../java_data_structure/b_tree.html">
            
                <a href="../java_data_structure/b_tree.html">
            
                    
                    B/B+ Tree
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3.2" data-path="../java_data_structure/inversed_index.html">
            
                <a href="../java_data_structure/inversed_index.html">
            
                    
                    倒排索引
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3.3" data-path="../java_data_structure/lsm_tree.html">
            
                <a href="../java_data_structure/lsm_tree.html">
            
                    
                    LSM Tree
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" >
            
                <span>
            
                    
                    [Java基础问题]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../db_cache/serialize.html">
            
                <a href="../db_cache/serialize.html">
            
                    
                    序列化问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../java_utils/spi.html">
            
                <a href="../java_utils/spi.html">
            
                    
                    Java SPI机制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../java_utils/synthetic.html">
            
                <a href="../java_utils/synthetic.html">
            
                    
                    Java Synthetic
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="../java_utils/object.html">
            
                <a href="../java_utils/object.html">
            
                    
                    java.lang.Object
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="../java_data_structure/System_arraycopy.html">
            
                <a href="../java_data_structure/System_arraycopy.html">
            
                    
                    System.arraycopy, Array.copyOf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="../java_utils/equals_hashcode.html">
            
                <a href="../java_utils/equals_hashcode.html">
            
                    
                    == & equals方法 & hashcode方法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="../java_utils/Calendar.html">
            
                <a href="../java_utils/Calendar.html">
            
                    
                    Calendar & Date
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.8" data-path="../java_utils/Compare.html">
            
                <a href="../java_utils/Compare.html">
            
                    
                    Comparison method violates its general contract
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.9" data-path="../java_utils/int_Integer.html">
            
                <a href="../java_utils/int_Integer.html">
            
                    
                    int(基本类型) & Integer(包装类类型)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.10" data-path="../java_utils/exception.html">
            
                <a href="../java_utils/exception.html">
            
                    
                    Java异常&错误
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.11" data-path="../java_utils/String.html">
            
                <a href="../java_utils/String.html">
            
                    
                    String,StringBuffer,StringBuilder
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.12" data-path="../java_utils/reflect.html">
            
                <a href="../java_utils/reflect.html">
            
                    
                    反射机制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.13" data-path="../java_utils/call_back.html">
            
                <a href="../java_utils/call_back.html">
            
                    
                    回调 & 事件机制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.14" data-path="../java_utils/array_collection.html">
            
                <a href="../java_utils/array_collection.html">
            
                    
                    数组，集合转换等问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.15" data-path="../java_utils/annotation.html">
            
                <a href="../java_utils/annotation.html">
            
                    
                    注解 Annotation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.16" data-path="../java_jvm/jvm_runtime.html">
            
                <a href="../java_jvm/jvm_runtime.html">
            
                    
                    Runtime类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.17" data-path="../java_utils/override_overload.html">
            
                <a href="../java_utils/override_overload.html">
            
                    
                    重载和重写
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.18" data-path="../java_utils/reg.html">
            
                <a href="../java_utils/reg.html">
            
                    
                    正则
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.19" data-path="../java_data_structure/unsafe.html">
            
                <a href="../java_data_structure/unsafe.html">
            
                    
                    unsafe
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.20" data-path="../java_utils/val_static.html">
            
                <a href="../java_utils/val_static.html">
            
                    
                    Java static关键字
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.21" data-path="../java_thinking_in_Java/basic.html">
            
                <a href="../java_thinking_in_Java/basic.html">
            
                    
                    《Java编程思想》第3章：操作符，第4章：控制执行流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.22" data-path="../java_thinking_in_Java/constructor.html">
            
                <a href="../java_thinking_in_Java/constructor.html">
            
                    
                    《Java编程思想》第5章：初始化和清理(重点)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.23" data-path="../java_thinking_in_Java/public_private_protect.html">
            
                <a href="../java_thinking_in_Java/public_private_protect.html">
            
                    
                    《Java编程思想》第6章：访问权限控制(重要)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.24" data-path="../java_thinking_in_Java/class_final.html">
            
                <a href="../java_thinking_in_Java/class_final.html">
            
                    
                    《Java编程思想》第7章：复用类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.25" data-path="../java_thinking_in_Java/polymorphism.html">
            
                <a href="../java_thinking_in_Java/polymorphism.html">
            
                    
                    《Java编程思想》第8章：多态
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.26" data-path="../java_thinking_in_Java/class_final.html">
            
                <a href="../java_thinking_in_Java/class_final.html">
            
                    
                    《Java编程思想》第9章：接口 补充：抽象类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.27" data-path="../java_thinking_in_Java/innner_class.html">
            
                <a href="../java_thinking_in_Java/innner_class.html">
            
                    
                    《Java编程思想》第10章：内部类
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" >
            
                <span>
            
                    
                    [JVM]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../java_jvm/jvm.html">
            
                <a href="../java_jvm/jvm.html">
            
                    
                    JVM规范
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../java_jvm/jvm_class_load.html">
            
                <a href="../java_jvm/jvm_class_load.html">
            
                    
                    类加载机制,运行时内存
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="../java_jvm/jvm_mem_model.html">
            
                <a href="../java_jvm/jvm_mem_model.html">
            
                    
                    Java内存模型与线程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="../java_jvm/jvm_mem_gc.html">
            
                <a href="../java_jvm/jvm_mem_gc.html">
            
                    
                    堆栈 & GC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="../java_jvm/jvm_params.html">
            
                <a href="../java_jvm/jvm_params.html">
            
                    
                    JVM参数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.6" data-path="../java_jvm/jvm_tools.html">
            
                <a href="../java_jvm/jvm_tools.html">
            
                    
                    JVM命令工具(jstack,jmap,jcmd...)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" >
            
                <span>
            
                    
                    [Java多线程 & 并发基础]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="aqs.html">
            
                <a href="aqs.html">
            
                    
                    AQS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2" data-path="cas.html">
            
                <a href="cas.html">
            
                    
                    CAS & 原子变量
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.3" data-path="volatile.html">
            
                <a href="volatile.html">
            
                    
                    volatile 关键字
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.4" data-path="synchronized.html">
            
                <a href="synchronized.html">
            
                    
                    synchronized 关键字
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.5" data-path="thread_basic.html">
            
                <a href="thread_basic.html">
            
                    
                    线程基础
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.5.1" data-path="park_unpark.html">
            
                <a href="park_unpark.html">
            
                    
                    park unpark
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.5.2" data-path="thread_condition.html">
            
                <a href="thread_condition.html">
            
                    
                    Condition
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.5.3" data-path="semaphore.html">
            
                <a href="semaphore.html">
            
                    
                    Semaphore
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.5.4" data-path="hook_thread.html">
            
                <a href="hook_thread.html">
            
                    
                    Hook线程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.5.5" data-path="countdownlatch_cyclicBarrier.html">
            
                <a href="countdownlatch_cyclicBarrier.html">
            
                    
                    CountDownLatch & CyclicBarrier
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.5.6" data-path="longAdder.html">
            
                <a href="longAdder.html">
            
                    
                    LongAdder
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.5.7" data-path="exchanger.html">
            
                <a href="exchanger.html">
            
                    
                    Exchanger
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.5.8" data-path="thread_design.html">
            
                <a href="thread_design.html">
            
                    
                    多线程设计模式
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11.6" >
            
                <span>
            
                    
                    [线程池]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.6.1" data-path="thread_pool.html">
            
                <a href="thread_pool.html">
            
                    
                    Java线程池
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.6.2" data-path="concurrency_problems.html">
            
                <a href="concurrency_problems.html">
            
                    
                    常见的多线程题目
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.6.3" data-path="thread_pool_self.html">
            
                <a href="thread_pool_self.html">
            
                    
                    自定义线程池
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11.7" data-path="linux_lock.html">
            
                <a href="linux_lock.html">
            
                    
                    Linux spin lock & mutex
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.11.8" data-path="thread_lock.html">
            
                <a href="thread_lock.html">
            
                    
                    Java Lock
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.9" data-path="thread_deadlock.html">
            
                <a href="thread_deadlock.html">
            
                    
                    死锁问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.10" data-path="threadLocal.html">
            
                <a href="threadLocal.html">
            
                    
                    ThreadLocal对象
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../java8/java8.html">
            
                <a href="../java8/java8.html">
            
                    
                    Java8
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="../java8/java8_future.html">
            
                <a href="../java8/java8_future.html">
            
                    
                    Future
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="../java8/java8_completableFuture.html">
            
                <a href="../java8/java8_completableFuture.html">
            
                    
                    CompletableFuture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3" data-path="../java8/interface_default.html">
            
                <a href="../java8/interface_default.html">
            
                    
                    interface defalt static
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.4" data-path="../java8/java8_mem.html">
            
                <a href="../java8/java8_mem.html">
            
                    
                    Java8 jvm内存结构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.5" data-path="../java8/lambda.html">
            
                <a href="../java8/lambda.html">
            
                    
                    Java8 lambda表达式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.6" data-path="../java8/java8_optional.html">
            
                <a href="../java8/java8_optional.html">
            
                    
                    Java8 Optional
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.7" data-path="../java8/streams.html">
            
                <a href="../java8/streams.html">
            
                    
                    Java8 Streams
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.8" data-path="../java8/streams_parallel.html">
            
                <a href="../java8/streams_parallel.html">
            
                    
                    Java8 并行数据处理与性能
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13" >
            
                <span>
            
                    
                    [项目经验]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1" data-path="../system_design/seckill.html">
            
                <a href="../system_design/seckill.html">
            
                    
                    系统设计
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.2" data-path="../system_design/db_split.html">
            
                <a href="../system_design/db_split.html">
            
                    
                    10亿级订单系统分库分表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.3" data-path="../system_design/pdd.html">
            
                <a href="../system_design/pdd.html">
            
                    
                    个人项目介绍
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14" >
            
                <span>
            
                    
                    [脚本]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.1" data-path="../shell/awk.html">
            
                <a href="../shell/awk.html">
            
                    
                    awk
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.2" data-path="../shell/words_count.html">
            
                <a href="../shell/words_count.html">
            
                    
                    统计词频bash脚本
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15" >
            
                <span>
            
                    
                    [python]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.1" data-path="../python/py.html">
            
                <a href="../python/py.html">
            
                    
                    python基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.2" data-path="../python/py_coroutine.html">
            
                <a href="../python/py_coroutine.html">
            
                    
                    python协程gevent
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.3" data-path="../python/py_object.html">
            
                <a href="../python/py_object.html">
            
                    
                    python可变对象与不可变对象
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.4" data-path="../python/py_time.html">
            
                <a href="../python/py_time.html">
            
                    
                    python时间处理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.5" data-path="../python/py_contextor.html">
            
                <a href="../python/py_contextor.html">
            
                    
                    python上线文管理器
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16" >
            
                <span>
            
                    
                    [算法]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.1" data-path="../thought_of_solve/thought.html">
            
                <a href="../thought_of_solve/thought.html">
            
                    
                    剑指Offer解题思路(全)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Java Lock</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div class="treeview__container"><div class="treeview__container-title"><span class="treeview__main-title">Treeview</span><span class="treeview__copyright">Copyright @doctording all right reserved, powered by <a href="https://github.com/aleen42" target="_blank">aleen42</a></span></div><ul>
<li><div><a href="#lock">Lock</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#lock&#x57FA;&#x672C;&#x7528;&#x6CD5;&#x4F8B;&#x5B50;">Lock&#x57FA;&#x672C;&#x7528;&#x6CD5;&#x4F8B;&#x5B50;</a><i></i></div></li>
<li><div><a href="#&#x7B49;&#x5F85;&#x901A;&#x77E5;&#x673A;&#x5236;lock--condition">&#x7B49;&#x5F85;/&#x901A;&#x77E5;&#x673A;&#x5236;(Lock &amp; Condition)</a><i></i></div></li>
<li><div><a href="#lock&#x548C;synchronized&#x7684;&#x5BF9;&#x6BD4;">lock&#x548C;synchronized&#x7684;&#x5BF9;&#x6BD4;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#&#x9501;&#x53EF;&#x4EE5;&#x4E2D;&#x65AD;">&#x9501;&#x53EF;&#x4EE5;&#x4E2D;&#x65AD;</a><i></i></div></li>
</ul></li>
<li><div><a href="#&#x7EBF;&#x7A0B;&#x540C;&#x6B65;&#x6982;&#x5FF5;">&#x7EBF;&#x7A0B;&#x540C;&#x6B65;&#x6982;&#x5FF5;</a><i></i></div></li>
<li><div><a href="#&#x4E50;&#x89C2;&#x9501;&#x60B2;&#x89C2;&#x9501;">&#x4E50;&#x89C2;&#x9501;&amp;&#x60B2;&#x89C2;&#x9501;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#&#x4E50;&#x89C2;&#x9501;">&#x4E50;&#x89C2;&#x9501;</a><i></i></div></li>
<li><div><a href="#&#x60B2;&#x89C2;&#x9501;">&#x60B2;&#x89C2;&#x9501;</a><i></i></div></li>
</ul></li>
<li><div><a href="#&#x81EA;&#x65CB;&#x9501;">&#x81EA;&#x65CB;&#x9501;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#&#x81EA;&#x65CB;&#x9501;&#x5B58;&#x5728;&#x7684;&#x610F;&#x4E49;&#x4E0E;&#x4F7F;&#x7528;&#x573A;&#x666F;">&#x81EA;&#x65CB;&#x9501;&#x5B58;&#x5728;&#x7684;&#x610F;&#x4E49;&#x4E0E;&#x4F7F;&#x7528;&#x573A;&#x666F;</a><i></i></div></li>
<li><div><a href="#atomicreference&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x516C;&#x5E73;&#x7684;&#x81EA;&#x65CB;&#x9501;">AtomicReference&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x516C;&#x5E73;&#x7684;&#x81EA;&#x65CB;&#x9501;</a><i></i></div></li>
<li><div><a href="#&#x5F97;&#x4E0D;&#x5230;&#x9501;&#x7684;&#x7EBF;&#x7A0B;&#x8BA9;&#x51FA;cpu">&#x5F97;&#x4E0D;&#x5230;&#x9501;&#x7684;&#x7EBF;&#x7A0B;&#x8BA9;&#x51FA;CPU</a><i></i></div></li>
<li><div><a href="#&#x5F97;&#x4E0D;&#x5230;&#x9501;&#xFF0C;&#x7EBF;&#x7A0B;sleep&#xFF0C;&#x7761;&#x7720;&#x65F6;&#x95F4;&#x4E0D;&#x786E;&#x5B9A;&#xFF1F;">&#x5F97;&#x4E0D;&#x5230;&#x9501;&#xFF0C;&#x7EBF;&#x7A0B;sleep&#xFF0C;&#x7761;&#x7720;&#x65F6;&#x95F4;&#x4E0D;&#x786E;&#x5B9A;&#xFF1F;</a><i></i></div></li>
<li><div><a href="#locksupportpark--unpark">LockSupport.park() &amp; unpark()</a><i></i></div></li>
<li><div><a href="#&#x9002;&#x5E94;&#x6027;&#x81EA;&#x65CB;&#x9501;">&#x9002;&#x5E94;&#x6027;&#x81EA;&#x65CB;&#x9501;</a><i></i></div></li>
</ul></li>
<li><div><a href="#reentrantlock-&#x53EF;&#x91CD;&#x5165;&#x9501;aqs&#x72EC;&#x5360;&#x9501;&#x9ED8;&#x8BA4;&#x975E;&#x516C;&#x5E73;&#xFF09;">ReentrantLock (&#x53EF;&#x91CD;&#x5165;&#x9501;,AQS&#x72EC;&#x5360;&#x9501;,&#x9ED8;&#x8BA4;&#x975E;&#x516C;&#x5E73;&#xFF09;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#&#x9501;&#x6F14;&#x53D8;&#x8FC7;&#x7A0B;">&#x9501;&#x6F14;&#x53D8;&#x8FC7;&#x7A0B;</a><i></i></div></li>
<li><div><a href="#&#x516C;&#x5E73;&#x975E;&#x516C;&#x5E73;&#x9501;">&#x516C;&#x5E73;&amp;&#x975E;&#x516C;&#x5E73;&#x9501;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#&#x516C;&#x5E73;&#x9501;">&#x516C;&#x5E73;&#x9501;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#&#x52A0;&#x9501;&#x8FC7;&#x7A0B;">&#x52A0;&#x9501;&#x8FC7;&#x7A0B;</a><i></i></div></li>
<li><div><a href="#&#x9501;&#x6392;&#x961F;debug&#x56FE;">&#x9501;&#x6392;&#x961F;debug&#x56FE;</a><i></i></div></li>
<li><div><a href="#&#x91CA;&#x653E;&#x9501;&#x8FC7;&#x7A0B;">&#x91CA;&#x653E;&#x9501;&#x8FC7;&#x7A0B;</a><i></i></div></li>
<li><div><a href="#&#x516C;&#x5E73;&#x9501;&#x4F18;&#x7F3A;&#x70B9;">&#x516C;&#x5E73;&#x9501;&#x4F18;&#x7F3A;&#x70B9;</a><i></i></div></li>
</ul></li>
<li><div><a href="#&#x975E;&#x516C;&#x5E73;&#x9501;&#xFF08;reentrantlock&#x9ED8;&#x8BA4;&#x975E;&#x516C;&#x5E73;&#xFF09;">&#x975E;&#x516C;&#x5E73;&#x9501;&#xFF08;ReentrantLock&#x9ED8;&#x8BA4;&#x975E;&#x516C;&#x5E73;&#xFF09;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#&#x83B7;&#x53D6;&#x9501;&#xFF08;&#x533A;&#x522B;&#x516C;&#x5E73;&#x9501;&#xFF09;">&#x83B7;&#x53D6;&#x9501;&#xFF08;&#x533A;&#x522B;&#x516C;&#x5E73;&#x9501;&#xFF09;</a><i></i></div></li>
</ul></li>
</ul></li>
</ul></li>
<li><div><a href="#&#x5206;&#x5E03;&#x5F0F;&#x9501;">&#x5206;&#x5E03;&#x5F0F;&#x9501;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#&#x4EC0;&#x4E48;&#x662F;&#x5206;&#x5E03;&#x5F0F;&#x9501;&#xFF1F;">&#x4EC0;&#x4E48;&#x662F;&#x5206;&#x5E03;&#x5F0F;&#x9501;&#xFF1F;</a><i></i></div></li>
<li><div><a href="#&#x5206;&#x5E03;&#x5F0F;&#x9501;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;">&#x5206;&#x5E03;&#x5F0F;&#x9501;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;</a><i></i></div></li>
</ul></li>
<li><div><a href="#&#x5171;&#x4EAB;&#x9501;&#x8BFB;&#x9501;-&#x548C;-&#x6392;&#x5B83;&#x9501;&#x5199;&#x9501;">&#x5171;&#x4EAB;&#x9501;(&#x8BFB;&#x9501;) &#x548C; &#x6392;&#x5B83;&#x9501;(&#x5199;&#x9501;)</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#exclusive-locks">Exclusive locks</a><i></i></div></li>
<li><div><a href="#shared-locks">Shared locks</a><i></i></div></li>
</ul></li>
<li><div><a href="#&#x504F;&#x5411;&#x9501;&#xFF08;biased-locking&#xFF09;">&#x504F;&#x5411;&#x9501;&#xFF08;Biased Locking&#xFF09;</a><i></i></div></li>
<li><div><a href="#&#x8F7B;&#x91CF;&#x7EA7;&#x9501;">&#x8F7B;&#x91CF;&#x7EA7;&#x9501;</a><i></i></div></li>
<li><div><a href="#&#x91CD;&#x91CF;&#x7EA7;&#x9501;&#xFF08;&#x5185;&#x6838;&#x63A7;&#x5236;&#xFF09;">&#x91CD;&#x91CF;&#x7EA7;&#x9501;&#xFF08;&#x5185;&#x6838;&#x63A7;&#x5236;&#xFF09;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#&#x4E3A;&#x4EC0;&#x4E48;&#x8BF4;&#x91CD;&#x91CF;&#x7EA7;&#x9501;&#x5F00;&#x9500;&#x5927;&#x5462;&#xFF1F;">&#x4E3A;&#x4EC0;&#x4E48;&#x8BF4;&#x91CD;&#x91CF;&#x7EA7;&#x9501;&#x5F00;&#x9500;&#x5927;&#x5462;&#xFF1F;</a><i></i></div></li>
</ul></li>
<li><div><a href="#aqs">AQS</a><i></i></div></li>
</ul></li>
</ul>
</div>


<p>[TOC]</p>
<h1 id="lock">Lock</h1>
<h2 id="lock&#x57FA;&#x672C;&#x7528;&#x6CD5;&#x4F8B;&#x5B50;">Lock&#x57FA;&#x672C;&#x7528;&#x6CD5;&#x4F8B;&#x5B50;</h2>
<p><code>Lock&#x662F;</code>Java&#x4E2D;&#x7684;&#x4E00;&#x4E2A;<code>interface</code></p>
<ul>
<li>lock, unlock</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">List</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent</span><span class="token punctuation">.</span><span class="token class-name">TimeUnit</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks</span><span class="token punctuation">.</span><span class="token class-name">ReentrantLock</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> <span class="token class-name">Mutex</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> num<span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>num<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">addSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">Mutex</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>num<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">addLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//&#x83B7;&#x53D6;&#x9501;</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>num<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">printNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;num:&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token class-name">Main</span> main <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        main<span class="token punctuation">.</span>num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Thread</span><span class="token punctuation">&gt;</span></span> threadList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment">//            Thread t = new Thread( ()-&gt; main.add(), &quot;myname&quot; + i);</span>
            <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span> main<span class="token punctuation">.</span><span class="token function">addLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;myname&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//            Thread t = new Thread(()-&gt; main.addSync());</span>
            threadList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        threadList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>t<span class="token operator">-&gt;</span>t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        threadList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>t<span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">try</span><span class="token punctuation">{</span>
                t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        main<span class="token punctuation">.</span><span class="token function">printNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>tryLock(long time, TimeUnit unit)</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>thread</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">List</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent</span><span class="token punctuation">.</span><span class="token class-name">TimeUnit</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks</span><span class="token punctuation">.</span><span class="token class-name">ReentrantLock</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> <span class="token class-name">Mutex</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> num<span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">addLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span><span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;&#x83B7;&#x5F97;&#x9501;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;&#x91CA;&#x653E;&#x9501;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">subLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>lock<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;&#x83B7;&#x5F97;&#x9501;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">--</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;&#x672A;&#x83B7;&#x5F97;&#x9501;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>lock<span class="token punctuation">.</span><span class="token function">isHeldByCurrentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">printNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;num:&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token class-name">Main</span> main <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        main<span class="token punctuation">.</span>num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Thread</span><span class="token punctuation">&gt;</span></span> threadList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> main<span class="token punctuation">.</span><span class="token function">addLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;myname&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                threadList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> main<span class="token punctuation">.</span><span class="token function">subLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;myname&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                threadList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        threadList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>t<span class="token operator">-&gt;</span>t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        threadList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>t<span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">try</span><span class="token punctuation">{</span>
                t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        main<span class="token punctuation">.</span><span class="token function">printNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="&#x7B49;&#x5F85;&#x901A;&#x77E5;&#x673A;&#x5236;lock--condition">&#x7B49;&#x5F85;/&#x901A;&#x77E5;&#x673A;&#x5236;(Lock &amp; Condition)</h2>
<p>&#x5728;Java&#x4E2D;&#xFF0C;&#x5BF9;&#x4E8E;&#x4EFB;&#x610F;&#x4E00;&#x4E2A;Java&#x5BF9;&#x8C61;&#xFF0C;&#x5B83;&#x90FD;&#x62E5;&#x6709;&#x4E00;&#x7EC4;&#x5B9A;&#x4E49;&#x5728;<code>java.lang.Object</code>&#x4E0A;&#x76D1;&#x89C6;&#x5668;&#x65B9;&#x6CD5;&#xFF0C;&#x5305;&#x62EC;<code>wait()</code>&#xFF0C;<code>wait(long timeout)</code>&#xFF0C;<code>notify()</code>&#xFF0C;<code>notifyAll()</code>&#xFF0C;&#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x914D;&#x5408;<code>synchronized</code>&#x5173;&#x952E;&#x5B57;&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x7B49;&#x5F85;/&#x901A;&#x77E5;&#x6A21;&#x5F0F;&#x3002;</p>
<p>&#x540C;&#x6837;&#xFF0C;<code>Condition</code>&#x63A5;&#x53E3;&#x4E5F;&#x63D0;&#x4F9B;&#x4E86;&#x7C7B;&#x4F3C;<code>Object</code>&#x76D1;&#x89C6;&#x5668;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x901A;&#x8FC7;&#x4E0E;<code>Lock</code>&#x914D;&#x5408;&#x6765;&#x5B9E;&#x73B0;&#x7B49;&#x5F85;/&#x901A;&#x77E5;&#x6A21;&#x5F0F;&#x3002;</p>
<ul>
<li>lock</li>
<li>condition.signal()</li>
<li>condition.await()</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>thread</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent</span><span class="token punctuation">.</span><span class="token class-name">TimeUnit</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks</span><span class="token punctuation">.</span><span class="token class-name">Condition</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks</span><span class="token punctuation">.</span><span class="token class-name">ReentrantLock</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Author mubi
 * @Date 2019/3/12 10:34 AM
 * lock &amp; condition &#x5BF9;&#x6BD4; synchronized wait notify
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Condition</span> condition <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span> threadA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;A start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;A notify&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    condition<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
                    lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;A end&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span> threadB <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;B start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// &#x4F7F;&#x5F97;&#x5F53;&#x524D;&#x6267;&#x884C;&#x7684;&#x7EBF;&#x7A0B;B&#x7B49;&#x5F85;</span>
                <span class="token comment">// &#x5373;&#xFF1A;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;B &#x8FDB;&#x5165;&#x5230; threadA&#x5BF9;&#x8C61;&#x7684;&#x7B49;&#x5F85;&#x96C6;&#x5408;&#x4E2D; &#x5E76;&#x7B49;&#x5F85;&#x5524;&#x9192;&#x3002;</span>
                <span class="token comment">// B &#x91CA;&#x653E;&#x5176;cpu&#x7ED9;&#x5176;&#x5B83;&#x7EBF;&#x7A0B;&#xFF0C;&#x81EA;&#x5DF1;&#x8BA9;&#x51FA;&#x8D44;&#x6E90;&#x8FDB;&#x5165;&#x7B49;&#x5F85;&#x6C60;(A&#x7684;&#x7B49;&#x5F85;&#x96C6;&#x5408;&#x4E2D;)&#x7B49;&#x5F85;</span>
                condition<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;B wait end, restart running&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;B Exception&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
                lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;B end&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        threadB<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// &#x786E;&#x4FDD;B &#x5148;&#x4E8E;A &#x8FD0;&#x884C;</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        threadA<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        threadA<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        threadB<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;main end&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>output</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token class-name">B</span> start
<span class="token class-name">A</span> start
<span class="token class-name">A</span> notify
<span class="token class-name">A</span> end
<span class="token class-name">B</span> wait end<span class="token punctuation">,</span> restart running
<span class="token class-name">B</span> end
main end
</code></pre>
<h2 id="lock&#x548C;synchronized&#x7684;&#x5BF9;&#x6BD4;">lock&#x548C;synchronized&#x7684;&#x5BF9;&#x6BD4;</h2>
<ul>
<li>Lock&#x662F;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;&#xFF0C;&#x800C;synchronized&#x662F;Java&#x4E2D;&#x7684;&#x5173;&#x952E;&#x5B57;&#xFF0C;synchronized&#x662F;&#x5185;&#x7F6E;&#x7684;&#x8BED;&#x8A00;&#x5B9E;&#x73B0;&#x3002;</li>
<li>synchronized&#x5728;&#x53D1;&#x751F;&#x5F02;&#x5E38;&#x65F6;&#xFF0C;&#x4F1A;&#x81EA;&#x52A8;&#x91CA;&#x653E;&#x7EBF;&#x7A0B;&#x5360;&#x6709;&#x7684;&#x9501;&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x4F1A;&#x5BFC;&#x81F4;&#x6B7B;&#x9501;&#x73B0;&#x8C61;&#x53D1;&#x751F;&#x3002;Lock&#x5728;&#x53D1;&#x751F;&#x5F02;&#x5E38;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x4E3B;&#x52A8;&#x901A;&#x8FC7;unLock()&#x65B9;&#x6CD5;&#x53BB;&#x91CA;&#x653E;&#x9501;&#xFF0C;&#x5219;&#x5F88;&#x53EF;&#x80FD;&#x9020;&#x6210;&#x6B7B;&#x9501;&#x7684;&#x73B0;&#x8C61;&#xFF0C;&#x56E0;&#x6B64;&#x4F7F;&#x7528;Lock&#x65F6;&#x9700;&#x8981;&#x5728;finally&#x5757;&#x4E2D;&#x91CA;&#x653E;&#x9501;&#x3002;</li>
<li>Lock&#x53EF;&#x4EE5;&#x8BA9;&#x7B49;&#x5F85;&#x9501;&#x7684;&#x7EBF;&#x7A0B;&#x54CD;&#x5E94;&#x4E2D;&#x65AD;&#xFF0C;&#x800C;synchronized&#x5374;&#x4E0D;&#x884C;&#xFF0C;&#x4F7F;&#x7528;synchronized&#x65F6;&#xFF0C;&#x7B49;&#x5F85;&#x7684;&#x7EBF;&#x7A0B;&#x4F1A;&#x4E00;&#x76F4;&#x7B49;&#x5F85;&#x4E0B;&#x53BB;&#xFF0C;&#x4E0D;&#x80FD;&#x591F;&#x54CD;&#x5E94;&#x4E2D;&#x65AD;&#x3002;</li>
<li>&#x901A;&#x8FC7;Lock&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#x6709;&#x6CA1;&#x6709;&#x6210;&#x529F;&#x83B7;&#x53D6;&#x9501;&#xFF0C;&#x800C;synchronized&#x5374;&#x65E0;&#x6CD5;&#x529E;&#x5230;&#x3002;</li>
<li>Lock&#x53EF;&#x4EE5;&#x63D0;&#x9AD8;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#x8BFB;&#x64CD;&#x4F5C;&#x7684;&#x6548;&#x7387;&#x3002;</li>
<li>synchronized&#x662F;&#x53EF;&#x91CD;&#x5165;,&#x4E0D;&#x53EF;&#x4E2D;&#x65AD;,&#x975E;&#x516C;&#x5E73;&#xFF1B;lock&#x5219;&#x53EF;&#x4EE5;&#x505A;&#x5230;</li>
</ul>
<h3 id="&#x9501;&#x53EF;&#x4EE5;&#x4E2D;&#x65AD;">&#x9501;&#x53EF;&#x4EE5;&#x4E2D;&#x65AD;</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent</span><span class="token punctuation">.</span><span class="token class-name">TimeUnit</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks</span><span class="token punctuation">.</span><span class="token class-name">Lock</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks</span><span class="token punctuation">.</span><span class="token class-name">ReentrantLock</span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Hello</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span><span class="token punctuation">{</span>

    <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">Lock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">lockInterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;thread start sleep&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// sleep&#xFF08;&#x53EF;&#x4E2D;&#x65AD;&#x65B9;&#x6CD5;&#xFF09;&#x4F7F;&#x5F97;&#x7EBF;&#x7A0B;&#x8FDB;&#x5165;&#x963B;&#x585E;&#x72B6;&#x6001;</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;thread sleep over&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// lock.lockInterruptibly(); &#x4F1A;&#x5224;&#x65AD;&#x662F;&#x5426;&#x53C8;&#x7EC8;&#x7AEF;</span>
            <span class="token comment">// lock.lock(); &#x4E0D;&#x4F1A;&#x5224;&#x65AD;&#x4E2D;&#x65AD;&#xFF0C;&#x62A2;&#x4E0D;&#x5230;&#x5C31;park&#x4E00;&#x76F4;&#x7B49;&#x5F85;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Interrupted&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token class-name">Hello</span> hello <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;====start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        hello<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            hello<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<h2 id="&#x7EBF;&#x7A0B;&#x540C;&#x6B65;&#x6982;&#x5FF5;">&#x7EBF;&#x7A0B;&#x540C;&#x6B65;&#x6982;&#x5FF5;</h2>
<p>&#x591A;&#x7EBF;&#x7A0B;&#x5BF9;&#x5171;&#x4EAB;&#x8D44;&#x6E90;&#x7684;&#x64CD;&#x4F5C;&#x6309;&#x7167;&#x4E00;&#x5B9A;&#x6B21;&#x5E8F;&#xFF0C;&#x907F;&#x514D;&#x51FA;&#x73B0;&#x4E0D;&#x53EF;&#x9884;&#x77E5;&#x7684;&#x7ED3;&#x5C40;</p>
<p><a href="https://en.wikipedia.org/wiki/Synchronization_(computer_science)" target="_blank">Synchronization_(computer_science)</a></p>
<h2 id="&#x4E50;&#x89C2;&#x9501;&#x60B2;&#x89C2;&#x9501;">&#x4E50;&#x89C2;&#x9501;&amp;&#x60B2;&#x89C2;&#x9501;</h2>
<h3 id="&#x4E50;&#x89C2;&#x9501;">&#x4E50;&#x89C2;&#x9501;</h3>
<p>&#x4E50;&#x89C2;&#x9501;&#x662F;&#x4E00;&#x79CD;&#x4E50;&#x89C2;&#x601D;&#x60F3;&#xFF0C;&#x5373;&#x8BA4;&#x4E3A;<code>&#x8BFB;&#x591A;&#x5199;&#x5C11;</code>&#xFF0C;&#x9047;&#x5230;&#x5E76;&#x53D1;&#x7ADE;&#x4E89;&#x5199;&#x7684;&#x53EF;&#x80FD;&#x6027;&#x5F88;&#x4F4E;&#xFF0C;&#x6BCF;&#x6B21;&#x53BB;<code>&#x8BFB;</code>&#x6570;&#x636E;&#x7684;&#x65F6;&#x5019;&#x90FD;&#x8BA4;&#x4E3A;&#x522B;&#x4EBA;&#x4E0D;&#x4F1A;&#x4FEE;&#x6539;&#xFF0C;&#x6240;&#x4EE5;<strong>&#x4E0D;&#x4F1A;&#x4E0A;&#x9501;</strong>&#xFF0C;&#x4F46;&#x662F;&#x5728;<code>&#x5199;</code>&#x64CD;&#x4F5C;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x5224;&#x65AD;&#x4E00;&#x4E0B;&#x5728;&#x6B64;&#x671F;&#x95F4;&#x522B;&#x4EBA;&#x6709;&#x6CA1;&#x6709;&#x53BB;&#x66F4;&#x65B0;(&#x5199;&#x64CD;&#x4F5C;)&#x8FD9;&#x4E2A;&#x6570;&#x636E;&#x3002;</p>
<ul>
<li><p>&#x5728;&#x6B64;&#x671F;&#x95F4;&#xFF1A;&#x662F;&#x6307; &#x62FF;&#x5230;&#x6570;&#x636E;&#x5230;&#x66F4;&#x65B0;&#x6570;&#x636E;&#x7684;&#x8FD9;&#x6BB5;&#x65F6;&#x95F4;&#x3002;&#x56E0;&#x4E3A;&#x6CA1;&#x6709;&#x52A0;&#x9501;&#xFF0C;&#x6240;&#x4EE5;&#x522B;&#x7684;&#x7EBF;&#x7A0B;&#x53EF;&#x80FD;&#x4F1A;&#x66F4;&#x6539;&#x3002;&#x8FD8;&#x6709;&#x5C31;&#x662F;&#x4E50;&#x89C2;&#x9501;&#x5176;&#x5B9E;&#x662F;&#x4E0D;&#x52A0;&#x9501;&#x7684;&#x3002;</p>
</li>
<li><p>&#x5982;&#x4F55;&#x5224;&#x65AD;&#xFF1A;&#x91C7;&#x53D6;&#x5728;&#x5199;&#x65F6;&#x5148;&#x8BFB;&#x51FA;&#x5F53;&#x524D;&#x7248;&#x672C;&#x53F7;&#xFF0C;&#x6BD4;&#x8F83;&#x8DDF;&#x4E0A;&#x4E00;&#x6B21;&#x7684;&#x7248;&#x672C;&#x53F7;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x6837;&#x5219;&#x8FDB;&#x884C;&#x5199;&#x64CD;&#x4F5C;&#xFF0C;&#x5982;&#x679C;&#x5931;&#x8D25;&#x5219;&#x8981;&#x91CD;&#x590D;<code>&#x8BFB;-&#x6BD4;&#x8F83;-&#x5199;</code>&#x7684;&#x64CD;&#x4F5C;(&#x4E0D;&#x65AD;CAS&#x64CD;&#x4F5C;&#xFF0C;CAS&#x5C31;&#x662F;&#x5178;&#x578B;&#x7684;&#x4E50;&#x89C2;&#x9501;)&#x3002;</p>
</li>
</ul>
<h3 id="&#x60B2;&#x89C2;&#x9501;">&#x60B2;&#x89C2;&#x9501;</h3>
<p>&#x60B2;&#x89C2;&#x9501;&#x662F;&#x5C31;&#x662F;&#x60B2;&#x89C2;&#x601D;&#x60F3;&#xFF0C;&#x5373;&#x8BA4;&#x4E3A;&#x5199;&#x591A;&#xFF0C;&#x9047;&#x5230;&#x5E76;&#x53D1;&#x5199;&#x7684;&#x53EF;&#x80FD;&#x6027;&#x5F88;&#x9AD8;&#xFF0C;&#x6BCF;&#x6B21;&#x53BB;&#x62FF;&#x6570;&#x636E;&#x7684;&#x65F6;&#x5019;&#x90FD;&#x8BA4;&#x4E3A;&#x522B;&#x4EBA;&#x4F1A;&#x4FEE;&#x6539;&#xFF0C;&#x6240;&#x4EE5;&#x6BCF;&#x6B21;&#x5728;<code>&#x8BFB;/&#x5199;</code>&#x6570;&#x636E;&#x7684;&#x65F6;&#x5019;<strong>&#x90FD;&#x4F1A;&#x4E0A;&#x9501;</strong>&#xFF0C;&#x8FD9;&#x6837;&#x522B;&#x4EBA;&#x60F3;&#x8BFB;/&#x5199;&#x8FD9;&#x4E2A;&#x6570;&#x636E;&#x5C31;&#x4F1A;&#x88AB;<code>Block</code>&#x4F4F;&#xFF0C;&#x76F4;&#x5230;&#x9501;&#x91CA;&#x653E;&#x4E14;&#x81EA;&#x5DF1;&#x62A2;&#x5230;&#x9501;&#x3002;Java&#x4E2D;&#x7684;&#x60B2;&#x89C2;&#x9501;&#x5982;<code>synchronized</code>&#xFF0C;AQS&#x6846;&#x67B6;&#x4E0B;&#x7684;&#x9501;&#x5219;&#x4E00;&#x822C;&#x662F;&#x5148;&#x5C1D;&#x8BD5;CAS&#x4E50;&#x89C2;&#x9501;&#x53BB;&#x83B7;&#x53D6;&#x9501;&#xFF0C;&#x83B7;&#x53D6;&#x4E0D;&#x5230;&#xFF0C;&#x624D;&#x4F1A;&#x8F6C;&#x6362;&#x4E3A;&#x60B2;&#x89C2;&#x9501;</p>
<p>&#x60B2;&#x89C2;&#x5E76;&#x53D1;&#x63A7;&#x5236;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&quot;&#x5148;&#x53D6;&#x9501;&#x518D;&#x8BBF;&#x95EE;&quot;&#x7684;&#x4FDD;&#x5B88;&#x7B56;&#x7565;&#xFF0C;&#x4E3A;&#x6570;&#x636E;&#x5904;&#x7406;&#x7684;&#x5B89;&#x5168;&#x63D0;&#x4F9B;&#x4E86;&#x4FDD;&#x8BC1;&#x3002;&#x6570;&#x636E;&#x5E93;&#x91CC;&#x9762;&#x4E5F;&#x7528;&#x5230;&#x4E86;&#x8FD9;&#x79CD;&#x60B2;&#x89C2;&#x9501;&#x7684;&#x673A;&#x5236;,&#x6BD4;&#x5982;&#x884C;&#x9501;&#xFF0C;&#x8868;&#x9501;&#x7B49;&#xFF0C;&#x8BFB;&#x9501;&#xFF0C;&#x5199;&#x9501;&#x7B49;&#xFF0C;&#x90FD;&#x662F;&#x5728;&#x505A;&#x64CD;&#x4F5C;&#x4E4B;&#x524D;&#x5148;&#x4E0A;&#x9501;&#x3002;&#x8FD9;&#x6837;&#x5176;&#x5B83;&#x7684;&#x7EBF;&#x7A0B;&#x5C31;&#x4E0D;&#x80FD;&#x540C;&#x6B65;&#x64CD;&#x4F5C;&#xFF0C;&#x5FC5;&#x987B;&#x8981;&#x7B49;&#x5230;&#x9501;&#x91CA;&#x653E;&#x624D;&#x53EF;&#x4EE5;&#x3002;</p>
<h2 id="&#x81EA;&#x65CB;&#x9501;">&#x81EA;&#x65CB;&#x9501;</h2>
<p><a href="https://en.wikipedia.org/wiki/Spinlock" target="_blank">Spinlock WikiPedia</a></p>
<p>&#x81EA;&#x65CB;&#x9501;&#x662F;&#x91C7;&#x7528;&#x8BA9;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x4E0D;&#x505C;&#x5730;&#x7684;&#x5728;&#x5FAA;&#x73AF;&#x4F53;&#x5185;&#x6267;&#x884C;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x53EA;&#x6709;&#x5F53;&#x5FAA;&#x73AF;&#x7684;&#x6761;&#x4EF6;&#x88AB;&#x5176;&#x5B83;&#x7EBF;&#x7A0B;&#x6539;&#x53D8;&#x65F6;&#xFF0C;&#x624D;&#x80FD;&#x8FDB;&#x5165;&#x4E34;&#x754C;&#x533A;&#xFF1B;&#x5426;&#x5219;&#x4E00;&#x76F4;&#x5224;&#x65AD;&#x6761;&#x4EF6;(&#x81EA;&#x65CB;&#xFF09;&#xFF0C;&#x6D88;&#x8017;CPU&#xFF0C;&#x4F46;&#x81EA;&#x8EAB;&#x7EBF;&#x7A0B;&#x72B6;&#x6001;&#x4E0D;&#x6539;&#x53D8;</p>
<h3 id="&#x81EA;&#x65CB;&#x9501;&#x5B58;&#x5728;&#x7684;&#x610F;&#x4E49;&#x4E0E;&#x4F7F;&#x7528;&#x573A;&#x666F;">&#x81EA;&#x65CB;&#x9501;&#x5B58;&#x5728;&#x7684;&#x610F;&#x4E49;&#x4E0E;&#x4F7F;&#x7528;&#x573A;&#x666F;</h3>
<p>&#x963B;&#x585E;&#x4E0E;&#x5524;&#x9192;&#x7EBF;&#x7A0B;&#x9700;&#x8981;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5207;&#x6362;CPU&#x72B6;&#x6001;&#xFF0C;&#x9700;&#x8981;&#x6D88;&#x8017;&#x4E00;&#x5B9A;&#x65F6;&#x95F4;&#xFF1B;&#x81EA;&#x65CB;&#x53EA;&#x662F;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x81EA;&#x5DF1;&#x5FAA;&#x73AF;&#xFF0C;&#x6CA1;&#x6709;&#x7EBF;&#x7A0B;&#x72B6;&#x6001;&#x7684;&#x6539;&#x53D8;&#xFF0C;&#x7A0D;&#x5FEB;</p>
<h3 id="atomicreference&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x516C;&#x5E73;&#x7684;&#x81EA;&#x65CB;&#x9501;">AtomicReference&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x516C;&#x5E73;&#x7684;&#x81EA;&#x65CB;&#x9501;</h3>
<pre class="language-"><code class="lang-java"><span class="token comment">/**
 * &#x4F7F;&#x7528;&#x4E86;CAS&#x539F;&#x5B50;&#x64CD;&#x4F5C;&#xFF0C;lock&#x51FD;&#x6570;&#x5C06;owner&#x8BBE;&#x7F6E;&#x4E3A;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#xFF0C;&#x5E76;&#x4E14;&#x9884;&#x6D4B;&#x539F;&#x6765;&#x7684;&#x503C;&#x4E3A;&#x7A7A;&#x3002;unlock&#x51FD;&#x6570;&#x5C06;owner&#x8BBE;&#x7F6E;&#x4E3A;null&#xFF0C;&#x5E76;&#x4E14;&#x9884;&#x6D4B;&#x503C;&#x4E3A;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;
 *
 * &#x8BE5;&#x4F8B;&#x5B50;&#x4E3A;&#x975E;&#x516C;&#x5E73;&#x9501;&#xFF0C;&#x83B7;&#x5F97;&#x9501;&#x7684;&#x5148;&#x540E;&#x987A;&#x5E8F;&#xFF0C;&#x4E0D;&#x4F1A;&#x6309;&#x7167;&#x8FDB;&#x5165;lock&#x7684;&#x5148;&#x540E;&#x987A;&#x5E8F;&#x8FDB;&#x884C;
 *
 */</span>
<span class="token keyword">class</span> <span class="token class-name">SpinLock</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Thread</span><span class="token punctuation">&gt;</span></span> sign <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> current <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// &#x5982;&#x679C;&#x662F;null&#xFF0C;&#x8BBE;&#x7F6E;&#x4E3A;current&#xFF1B;&#x8BBE;&#x7F6E;&#x5931;&#x8D25;&#xFF0C;&#x5C31;&#x4E00;&#x76F4;&#x81EA;&#x65CB;&#xFF0C;&#x76F4;&#x5230;&#x80FD;&#x8BBE;&#x7F6E;&#x6210;&#x529F;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>sign<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> current<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> unlock <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> current <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// &#x5982;&#x679C;&#x662F;current,&#x8BBE;&#x7F6E;&#x4E3A;null</span>
        sign<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">int</span> cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token class-name">SpinLock</span> spinLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpinLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">1000</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cnt<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">addSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        spinLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">1000</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cnt<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        spinLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Thread</span><span class="token punctuation">&gt;</span></span> threadList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span> <span class="token class-name">Solution</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;add&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            threadList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        threadList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>t<span class="token operator">-&gt;</span>t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        threadList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>t<span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">try</span><span class="token punctuation">{</span>
                t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Solution</span><span class="token punctuation">.</span>cnt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<p>&#x7531;&#x4E8E;&#x81EA;&#x65CB;&#x9501;<strong>&#x4E0D;&#x8FDB;&#x884C;&#x7EBF;&#x7A0B;&#x72B6;&#x6001;&#x7684;&#x6539;&#x53D8;</strong>&#xFF0C;&#x6240;&#x4EE5;&#x54CD;&#x5E94;&#x901F;&#x5EA6;&#x66F4;&#x5FEB;&#x3002;&#x4F46;&#x5F53;&#x7EBF;&#x7A0B;&#x6570;&#x4E0D;&#x505C;&#x589E;&#x52A0;&#x65F6;&#xFF0C;&#x6027;&#x80FD;&#x4E0B;&#x964D;&#x660E;&#x663E;&#xFF0C;&#x56E0;&#x4E3A;&#x6BCF;&#x4E2A;&#x7EBF;&#x7A0B;&#x90FD;&#x9700;&#x8981;&#x6267;&#x884C;&#x7C7B;&#x4F3C;&#x4E00;&#x4E2A;&#x7A7A;for&#x5FAA;&#x73AF;&#xFF0C;<strong>&#x5360;&#x7528;CPU&#x65F6;&#x95F4;</strong>&#x3002;&#x5982;&#x679C;&#x7EBF;&#x7A0B;&#x7ADE;&#x4E89;&#x4E0D;&#x6FC0;&#x70C8;&#xFF0C;&#x5E76;&#x4E14;&#x4FDD;&#x6301;&#x9501;&#x7684;&#x65F6;&#x95F4;&#x77ED;&#xFF0C;&#x5219;&#x9002;&#x5408;&#x4F7F;&#x7528;&#x81EA;&#x65CB;&#x9501;&#x3002;</p>
<p>In software engineering, a spinlock is a lock which causes a thread trying to acquire it to simply wait in a loop (&quot;spin&quot;) while repeatedly checking if the lock is available. Since the thread remains active but is not performing a useful task, the use of such a lock is a kind of busy waiting. Once acquired, spinlocks will usually be held until they are explicitly released, although in some implementations they may be automatically released if the thread being waited on (the one which holds the lock) blocks, or &quot;goes to sleep&quot;.</p>
<p>Because they avoid overhead from operating system process rescheduling or context switching, spinlocks are efficient if threads are likely to be blocked for only short periods. For this reason, operating-system kernels often use spinlocks. However, spinlocks become wasteful if held for longer durations, as they may prevent other threads from running and require rescheduling. The longer a thread holds a lock, the greater the risk that the thread will be interrupted by the OS scheduler while holding the lock. If this happens, other threads will be left &quot;spinning&quot; (repeatedly trying to acquire the lock), while the thread holding the lock is not making progress towards releasing it. The result is an indefinite postponement until the thread holding the lock can finish and release it. This is especially true on a single-processor system, where each waiting thread of the same priority is likely to waste its quantum (allocated time where a thread can run) spinning until the thread that holds the lock is finally finished.</p>
<ul>
<li>&#x7EBF;&#x7A0B;&#x72B6;&#x6001;&#x4E0D;&#x53D8;&#xFF0C;&#x4E0D;&#x5BFC;&#x81F4;&#x4E0A;&#x7EBF;&#x6587;&#x5207;&#x6362;&#xFF0C;&#x9002;&#x5408;&#x77ED;&#x65F6;&#x95F4;&#x81EA;&#x65CB;</li>
<li>&#x957F;&#x65F6;&#x95F4;&#x4F1A;&#x8017;CPU&#xFF0C;&#x5F71;&#x54CD;&#x5176;&#x5B83;&#x7EBF;&#x7A0B;&#x7684;&#x8C03;&#x5EA6;</li>
</ul>
<h3 id="&#x5F97;&#x4E0D;&#x5230;&#x9501;&#x7684;&#x7EBF;&#x7A0B;&#x8BA9;&#x51FA;cpu">&#x5F97;&#x4E0D;&#x5230;&#x9501;&#x7684;&#x7EBF;&#x7A0B;&#x8BA9;&#x51FA;CPU</h3>
<p>&#x7ADE;&#x4E89;&#x9501;&#x5931;&#x8D25;&#x7684;&#x7EBF;&#x7A0B;&#x8BA9;&#x51FA;CPU(&#x53EF;&#x4EE5;&#x4F7F;&#x7528;yield()&#x8BA9;&#x51FA;CPU,&#x8FD9;&#x662F;CPU&#x63A7;&#x5236;&#x7684;)&#xFF0C;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x6BCF;&#x6B21;&#x90FD;&#x662F;&#x67D0;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x8BA9;&#x51FA;CPU&#xFF0C;&#x5F97;&#x4E0D;&#x5230;&#x6267;&#x884C;</p>
<pre class="language-"><code class="lang-java"><span class="token keyword">class</span> <span class="token class-name">SpinLock</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> sign <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>sign<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token keyword">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// &#x89E3;&#x9501;&#x5C31;&#x662F;&#x8BBE;&#x7F6E;&#x4E3A;</span>
        sign<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="&#x5F97;&#x4E0D;&#x5230;&#x9501;&#xFF0C;&#x7EBF;&#x7A0B;sleep&#xFF0C;&#x7761;&#x7720;&#x65F6;&#x95F4;&#x4E0D;&#x786E;&#x5B9A;&#xFF1F;">&#x5F97;&#x4E0D;&#x5230;&#x9501;&#xFF0C;&#x7EBF;&#x7A0B;sleep&#xFF0C;&#x7761;&#x7720;&#x65F6;&#x95F4;&#x4E0D;&#x786E;&#x5B9A;&#xFF1F;</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">class</span> <span class="token class-name">SpinLock</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> sign <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>sign<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">try</span><span class="token punctuation">{</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// &#x89E3;&#x9501;&#x5C31;&#x662F;&#x8BBE;&#x7F6E;&#x4E3A;</span>
        sign<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="locksupportpark--unpark">LockSupport.park() &amp; unpark()</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">class</span> <span class="token class-name">SpinLock</span><span class="token punctuation">{</span>

    <span class="token class-name">Queue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Thread</span><span class="token punctuation">&gt;</span></span> parkQueue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Thread</span><span class="token punctuation">&gt;</span></span> sign <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>sign<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">park</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        sign<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// &#x540C;&#x65F6;&#x5524;&#x9192;&#x5176;&#x5B83;&#x7EBF;&#x7A0B;</span>
        <span class="token function">lockNotify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">park</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment">//        System.out.println(&quot;park thread:&quot; + Thread.currentThread().getName());</span>
        parkQueue<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">park</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">lockNotify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>parkQueue<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// &#x5148;&#x8FDB;&#x5148;&#x51FA;</span>
        <span class="token class-name">Thread</span> t <span class="token operator">=</span> parkQueue<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        System.out.println(&quot;unpark thread:&quot; + t.getName());</span>
        <span class="token function">unpark</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">unpark</span><span class="token punctuation">(</span><span class="token class-name">Thread</span> t<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">unpark</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<h3 id="&#x9002;&#x5E94;&#x6027;&#x81EA;&#x65CB;&#x9501;">&#x9002;&#x5E94;&#x6027;&#x81EA;&#x65CB;&#x9501;</h3>
<p>&#x81EA;&#x65CB;&#x9501;&#x7684;&#x76EE;&#x7684;&#x662F;&#x4E3A;&#x4E86;&#x5360;&#x7740;CPU&#x7684;&#x8D44;&#x6E90;&#x4E0D;&#x91CA;&#x653E;&#xFF0C;&#x7B49;&#x5230;&#x83B7;&#x53D6;&#x5230;&#x9501;&#x7ACB;&#x5373;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;&#x4F46;&#x662F;&#x5982;&#x4F55;&#x53BB;&#x9009;&#x62E9;&#x81EA;&#x65CB;&#x7684;&#x6267;&#x884C;&#x65F6;&#x95F4;&#x5462;&#xFF1F;&#x5982;&#x679C;&#x81EA;&#x65CB;&#x6267;&#x884C;&#x65F6;&#x95F4;&#x592A;&#x957F;&#xFF0C;&#x4F1A;&#x6709;&#x5927;&#x91CF;&#x7684;&#x7EBF;&#x7A0B;&#x5904;&#x4E8E;&#x81EA;&#x65CB;&#x72B6;&#x6001;&#x5360;&#x7528;CPU&#x8D44;&#x6E90;&#xFF0C;&#x8FDB;&#x800C;&#x4F1A;&#x5F71;&#x54CD;&#x6574;&#x4F53;&#x7CFB;&#x7EDF;&#x7684;&#x6027;&#x80FD;&#x3002;</p>
<p>&#x81EA;&#x65CB;&#x7684;&#x65F6;&#x95F4;&#x4E0D;&#x5728;&#x662F;&#x56FA;&#x5B9A;&#x7684;&#x4E86;&#xFF0C;&#x800C;&#x662F;&#x7531;&#x524D;&#x4E00;&#x6B21;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x9501;&#x4E0A;&#x7684;&#x81EA;&#x65CB;&#x65F6;&#x95F4;&#x4EE5;&#x53CA;&#x9501;&#x7684;&#x62E5;&#x6709;&#x8005;&#x7684;&#x72B6;&#x6001;&#x6765;&#x51B3;&#x5B9A;&#xFF0C;&#x57FA;&#x672C;&#x8BA4;&#x4E3A;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x4E0A;&#x4E0B;&#x6587;&#x5207;&#x6362;&#x7684;&#x65F6;&#x95F4;&#x662F;&#x6700;&#x4F73;&#x7684;&#x4E00;&#x4E2A;&#x65F6;&#x95F4;&#xFF0C;&#x540C;&#x65F6;JVM&#x8FD8;&#x9488;&#x5BF9;&#x5F53;&#x524D;CPU&#x7684;&#x8D1F;&#x8377;&#x60C5;&#x51B5;&#x505A;&#x4E86;&#x8F83;&#x591A;&#x7684;&#x4F18;&#x5316;:</p>
<ul>
<li><p>&#x5982;&#x679C;&#x5E73;&#x5747;&#x8D1F;&#x8F7D;&#x5C0F;&#x4E8E;CPUs&#x5219;&#x4E00;&#x76F4;&#x81EA;&#x65CB;</p>
</li>
<li><p>&#x5982;&#x679C;&#x6709;&#x8D85;&#x8FC7;(CPUs/2)&#x4E2A;&#x7EBF;&#x7A0B;&#x6B63;&#x5728;&#x81EA;&#x65CB;&#xFF0C;&#x5219;&#x540E;&#x6765;&#x7EBF;&#x7A0B;&#x76F4;&#x63A5;&#x963B;&#x585E;</p>
</li>
<li><p>&#x5982;&#x679C;&#x6B63;&#x5728;&#x81EA;&#x65CB;&#x7684;&#x7EBF;&#x7A0B;&#x53D1;&#x73B0;Owner&#x53D1;&#x751F;&#x4E86;&#x53D8;&#x5316;&#x5219;&#x5EF6;&#x8FDF;&#x81EA;&#x65CB;&#x65F6;&#x95F4;&#xFF08;&#x81EA;&#x65CB;&#x8BA1;&#x6570;&#xFF09;&#x6216;&#x8FDB;&#x5165;&#x963B;&#x585E;</p>
</li>
<li><p>&#x5982;&#x679C;CPU&#x5904;&#x4E8E;&#x8282;&#x7535;&#x6A21;&#x5F0F;&#x5219;&#x505C;&#x6B62;&#x81EA;&#x65CB;</p>
</li>
<li><p>&#x81EA;&#x65CB;&#x65F6;&#x95F4;&#x7684;&#x6700;&#x574F;&#x60C5;&#x51B5;&#x662F;CPU&#x7684;&#x5B58;&#x50A8;&#x5EF6;&#x8FDF;&#xFF08;CPU A&#x5B58;&#x50A8;&#x4E86;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#xFF0C;&#x5230;CPU B&#x5F97;&#x77E5;&#x8FD9;&#x4E2A;&#x6570;&#x636E;&#x76F4;&#x63A5;&#x7684;&#x65F6;&#x95F4;&#x5DEE;&#xFF09;</p>
</li>
<li><p>&#x81EA;&#x65CB;&#x65F6;&#x4F1A;&#x9002;&#x5F53;&#x653E;&#x5F03;&#x7EBF;&#x7A0B;&#x4F18;&#x5148;&#x7EA7;&#x4E4B;&#x95F4;&#x7684;&#x5DEE;&#x5F02;</p>
</li>
</ul>
<h2 id="reentrantlock-&#x53EF;&#x91CD;&#x5165;&#x9501;aqs&#x72EC;&#x5360;&#x9501;&#x9ED8;&#x8BA4;&#x975E;&#x516C;&#x5E73;&#xFF09;">ReentrantLock (&#x53EF;&#x91CD;&#x5165;&#x9501;,AQS&#x72EC;&#x5360;&#x9501;,&#x9ED8;&#x8BA4;&#x975E;&#x516C;&#x5E73;&#xFF09;</h2>
<p>&#x9644;&#xFF1A;<strong>&#x72EC;&#x5360;&#x9501;</strong>&#x88AB;&#x67D0;&#x4E2A;&#x7EBF;&#x7A0B;&#x6301;&#x6709;&#x65F6;&#xFF0C;&#x5176;&#x5B83;&#x7EBF;&#x7A0B;&#x53EA;&#x80FD;&#x7B49;&#x5F85;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x91CA;&#x653E;&#x540E;&#x624D;&#x80FD;&#x53BB;&#x7ADE;&#x4E89;&#x9501;&#xFF0C;&#x800C;&#x4E14;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x80FD;&#x7ADE;&#x4E89;&#x9501;&#x6210;&#x529F;&#x3002;</p>
<h3 id="&#x9501;&#x6F14;&#x53D8;&#x8FC7;&#x7A0B;">&#x9501;&#x6F14;&#x53D8;&#x8FC7;&#x7A0B;</h3>
<p>&#x53C2;&#x8003;&#xFF1A;<a href="https://blog.csdn.net/qq_23864697/article/details/104052712" target="_blank">ReentrantLock&#x6E90;&#x7801;&#x89E3;&#x6790;</a></p>
<ol>
<li>&#x81EA;&#x65CB;&#xFF08;&#x7A7A;&#x8F6C;&#xFF0C;&#x8017;&#x8D39;CPU&#xFF09;</li>
<li>&#x81EA;&#x65CB; + yield&#xFF08;&#x653E;&#x5F03;CPU&#xFF0C;&#x968F;&#x673A;&#xFF09;</li>
<li>&#x81EA;&#x65CB; + sleep&#xFF08;&#x963B;&#x585E;&#xFF0C;&#x8BA9;&#x51FA;CPU&#xFF09;&#xFF0C;sleep&#x65F6;&#x95F4;&#x4E0D;&#x786E;&#x5B9A;&#xFF1F;</li>
<li>&#x81EA;&#x65CB; + park/unpark&#xFF0C;&#x83B7;&#x53D6;&#x4E0D;&#x5230;&#x9501;&#x5219;park&#x8FDB;&#x5165;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x91CA;&#x653E;CPU&#xFF1B;&#x83B7;&#x53D6;&#x5230;&#x9501;&#x518D;&#x91CA;&#x653E;&#x7684;&#x65F6;&#x5019;&#x8FDB;&#x884C;unpark&#x64CD;&#x4F5C;&#x5524;&#x9192;&#x961F;&#x5217;&#x4E2D;&#x7684;&#x7EBF;&#x7A0B;&#xFF08;park&#x662F;&#x7B49;&#x5F85;&#x4E00;&#x4E2A;&#x8BB8;&#x53EF;&#xFF0C;unpark&#x662F;&#x4E3A;&#x67D0;&#x7EBF;&#x7A0B;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x8BB8;&#x53EF;&#xFF09;</li>
</ol>
<h3 id="&#x516C;&#x5E73;&#x975E;&#x516C;&#x5E73;&#x9501;">&#x516C;&#x5E73;&amp;&#x975E;&#x516C;&#x5E73;&#x9501;</h3>
<ul>
<li><p>&#x516C;&#x5E73;&#x9501;&#x6BCF;&#x6B21;&#x83B7;&#x53D6;&#x5230;&#x9501;&#x4E3A;&#x540C;&#x6B65;&#x961F;&#x5217;&#x4E2D;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#xFF0C;&#x4FDD;&#x8BC1;&#x8BF7;&#x6C42;&#x8D44;&#x6E90;&#x65F6;&#x95F4;&#x4E0A;&#x7684;&#x7EDD;&#x5BF9;&#x987A;&#x5E8F;&#xFF0C;&#x800C;&#x975E;&#x516C;&#x5E73;&#x9501;&#x6709;&#x53EF;&#x80FD;&#x521A;&#x91CA;&#x653E;&#x9501;&#x7684;&#x7EBF;&#x7A0B;&#x4E0B;&#x6B21;&#x7EE7;&#x7EED;&#x83B7;&#x53D6;&#x8BE5;&#x9501;&#xFF0C;&#x5219;&#x6709;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x6C38;&#x8FDC;&#x65E0;&#x6CD5;&#x83B7;&#x53D6;&#x5230;&#x9501;&#xFF0C;&#x9020;&#x6210;<code>&#x9965;&#x997F;</code>&#x73B0;&#x8C61;&#x3002;</p>
</li>
<li><p>&#x516C;&#x5E73;&#x9501;&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x65F6;&#x95F4;&#x4E0A;&#x7684;&#x7EDD;&#x5BF9;&#x987A;&#x5E8F;&#xFF0C;&#x9700;&#x8981;&#x9891;&#x7E41;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x5207;&#x6362;&#xFF0C;&#x800C;&#x975E;&#x516C;&#x5E73;&#x9501;&#x4F1A;&#x964D;&#x4F4E;&#x4E86;&#x4E00;&#x5B9A;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x5207;&#x6362;&#xFF0C;&#x964D;&#x4F4E;&#x6027;&#x80FD;&#x5F00;&#x9500;&#x3002;</p>
</li>
</ul>
<h4 id="&#x516C;&#x5E73;&#x9501;">&#x516C;&#x5E73;&#x9501;</h4>
<p>&#x8868;&#x793A;&#x7EBF;&#x7A0B;&#x83B7;&#x53D6;&#x9501;&#x7684;&#x987A;&#x5E8F;&#x662F;&#x6309;&#x7167;&#x7EBF;&#x7A0B;&#x7533;&#x8BF7;&#x9501;&#x7684;&#x987A;&#x5E8F;&#x6765;&#x5206;&#x914D;&#x7684;&#xFF0C;&#x5373;<code>FIFO</code>, &#x961F;&#x5217;&#x7ED3;&#x6784;&#xFF1B;&#x4F1A;&#x5148;&#x5224;&#x65AD;&#x662F;&#x5426;&#x6709;&#x524D;&#x9A71;Node&#xFF0C;&#x6CA1;&#x6709;&#x624D;&#x8FDB;&#x884C;CAS&#x64CD;&#x4F5C;&#xFF0C;&#x4E0D;&#x662F;&#x4E00;&#x4E0A;&#x6765;&#x5C31;CAS&#x5F00;&#x59CB;&#x62A2;&#x5360;&#x9501;</p>
<h5 id="&#x52A0;&#x9501;&#x8FC7;&#x7A0B;">&#x52A0;&#x9501;&#x8FC7;&#x7A0B;</h5>
<pre class="language-"><code class="lang-java"> <span class="token comment">/**
    * Sync object for fair locks
    */</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">FairSync</span> <span class="token keyword">extends</span> <span class="token class-name">Sync</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">3000897897090466540L</span><span class="token punctuation">;</span>

    <span class="token comment">// &#x516C;&#x5E73;&#x9501; lock &#x65B9;&#x6CD5;&#xFF1A;acquire(1)</span>
    <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">acquire</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
        * Fair version of tryAcquire.  Don&apos;t grant access unless
        * recursive call or no waiters or is first.
        */</span>
    <span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">tryAcquire</span><span class="token punctuation">(</span><span class="token keyword">int</span> acquires<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// &#x83B7;&#x53D6;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;</span>
        <span class="token keyword">final</span> <span class="token class-name">Thread</span> current <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// &#x83B7;&#x53D6;state&#x7684;&#x503C;,state&#x662F;volatie&#x4FEE;&#x9970;&#x7684;,&#x7EBF;&#x7A0B;&#x4E4B;&#x95F4;&#x53EF;&#x89C1;</span>
        <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// &#x5982;&#x679C;state==0&#xFF0C;&#x5219;&#x8BF4;&#x660E;&#x8FD8;&#x6CA1;&#x6709;&#x7EBF;&#x7A0B;&#x83B7;&#x53D6;&#x5230;&#x8D44;&#x6E90;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// &#x7EE7;&#x7EED;&#x5224;&#x65AD;&#x662F;&#x5426;&#x6709;&#x7EBF;&#x7A0B;&#x6392;&#x961F;,&#x5E76;&#x5C1D;&#x8BD5;&#x7740;&#x901A;&#x8FC7;CAS&#x4FEE;&#x6539;state&#x7684;&#x503C;&#x4E3A;acquires,&#x7136;&#x540E;&#x5C06;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x8BBE;&#x7F6E;&#x5230;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x4FDD;&#x5B58;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">hasQueuedPredecessors</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                <span class="token function">compareAndSetState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> acquires<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">setExclusiveOwnerThread</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// &#x5982;&#x679C;state!=0,&#x8BF4;&#x660E;&#x6709;&#x7EBF;&#x7A0B;&#x5360;&#x7528;&#x3002;&#x5219;&#x5224;&#x65AD;&#x8BE5;&#x7EBF;&#x7A0B;&#x662F;&#x5426;&#x4E3A;&#x81EA;&#x8EAB;,&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x505A;&#x7EBF;&#x7A0B;&#x7684;&#x91CD;&#x5165;&#x3002;&#x5982;&#x679C;&#x662F;&#x81EA;&#x8EAB;,&#x5219;&#x5C06;state&#x52A0;1</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">==</span> <span class="token function">getExclusiveOwnerThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> nextc <span class="token operator">=</span> c <span class="token operator">+</span> acquires<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>nextc <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Maximum lock count exceeded&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">setState</span><span class="token punctuation">(</span>nextc<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// &#x6700;&#x540E;&#x5931;&#x8D25;&#x8FD4;&#x56DE; false</span>
        <span class="token comment">// &#x5931;&#x8D25;&#x540E;&#xFF0C;&#x4F1A;&#x901A;&#x8FC7;addwaitor&#x5C06;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x4EE5;&#x6392;&#x5B83;&#x6027;&#x8282;&#x70B9;&#x7684;&#x65B9;&#x5F0F;&#x52A0;&#x5230;CLH&#x961F;&#x5217;&#x7684;&#x672B;&#x5C3E;&#xFF08;&#x901A;&#x8FC7;CAS&#xFF09;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;acquireQueued&#x5F00;&#x59CB;&#x6392;&#x961F;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li><p>Aqs&#x7684;acquire&#x65B9;&#x6CD5;&#xFF1A;</p>
</li>
<li><p>&#x5C1D;&#x8BD5;&#x83B7;&#x53D6;&#x9501;<code>tryAcquire(arg)</code>&#x8FD4;&#x56DE;true&#xFF0C;&#x4EE3;&#x8868;&#x83B7;&#x53D6;&#x6210;&#x529F;&#xFF0C;&#x5219;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;</p>
</li>
<li>&#x5426;&#x5219;&#x6267;&#x884C;<code>acquireQueued(addWaiter(Node.EXCLUSIVE), arg)</code>, <code>addWaiter</code>&#x65B9;&#x6CD5;&#x72EC;&#x5360;(exclusive)&#x6A21;&#x5F0F;&#x6DFB;&#x52A0;&#x5230;CLH&#x961F;&#x5217;&#x5230;&#x672B;&#x5C3E;</li>
<li>addWaiter&#x5E95;&#x5C42;&#x662F;CAS&#x64CD;&#x4F5C;&#xFF0C;&#x5982;&#x679C;&#x64CD;&#x4F5C;&#x6210;&#x529F;&#x8FD4;&#x56DE;CLH&#x4E2D;&#x7684;&#x8BE5;<code>Node</code>&#x8282;&#x70B9;,&#x5E76;&#x6267;&#x884C; acquireQueued(node, arg) &#x65B9;&#x6CD5;</li>
<li>acquireQueued&#x65B9;&#x6CD5;&#x5224;&#x65AD; node &#x7684;&#x524D;&#x7F6E;&#x8282;&#x70B9;&#x662F;&#x4E0D;&#x662F;CLH&#x7684;head&#xFF0C;&#x5982;&#x679C;&#x662F;&#x5219;&#x5C1D;&#x8BD5;&#x83B7;&#x53D6;&#x9501;<code>tryAcquire(arg)</code>(&#x8FD9;&#x662F;&#x4E2A;while(true)&#x64CD;&#x4F5C;)</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">acquire</span><span class="token punctuation">(</span><span class="token keyword">int</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">tryAcquire</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        <span class="token function">acquireQueued</span><span class="token punctuation">(</span><span class="token function">addWaiter</span><span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token punctuation">.</span>EXCLUSIVE<span class="token punctuation">)</span><span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">selfInterrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x7B2C;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x6267;&#x884C;<code>lock()</code>&#x65B9;&#x6CD5;&#xFF0C;tryAcquire&#x6267;&#x884C;&#x7684;&#x65F6;&#x5019;&#xFF0C;hasQueuedPredecessors()&#x8FD4;&#x56DE;false,&#x90A3;&#x4E48;&#x76F4;&#x63A5;&#x6267;&#x884C;&#x5982;&#x4E0B;&#x8BED;&#x53E5;&#x5E76;&#x8FD4;&#x56DE;&#xFF0C;lock()&#x8FD4;&#x56DE;,&#x5219;&#x8868;&#x793A;&#x83B7;&#x53D6;&#x9501;&#x6210;&#x529F;&#xFF0C;&#x8FD9;&#x6837;&#x7EBF;&#x7A0B;&#x80FD;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x83B7;&#x53D6;&#x9501;&#x4E4B;&#x540E;&#x7684;&#x4EE3;&#x7801;&#x4E86;</p>
<pre class="language-"><code class="lang-java"><span class="token comment">// unsafe.compareAndSwapInt&#x64CD;&#x4F5C;&#x8BBE;&#x7F6E;state&#x53D8;&#x91CF;&#x4E3A;1</span>
<span class="token function">compareAndSetState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> acquires<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// &#x8BBE;&#x7F6E;aqs&#x4E2D;&#x7684; exclusiveOwnerThread &#x4E3A; &#x5F53;&#x524D;&#x7EBF;&#x7A0B;</span>
<span class="token function">setExclusiveOwnerThread</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// &#x8FD4;&#x56DE;&#xFF0C;&#x4EE3;&#x8868;&#x83B7;&#x53D6;&#x9501;&#x6210;&#x529F;</span>
<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre>
<ul>
<li>&#x83B7;&#x53D6;&#x9501;&#x524D;</li>
</ul>
<p><img src="imgs/reentrant01.png" alt=""></p>
<ul>
<li>&#x83B7;&#x53D6;&#x9501;&#x4E4B;&#x540E;(&#x672A;&#x91CA;&#x653E;&#x4E4B;&#x524D;)</li>
</ul>
<p><img src="imgs/reentrant02.png" alt=""></p>
<h5 id="&#x9501;&#x6392;&#x961F;debug&#x56FE;">&#x9501;&#x6392;&#x961F;debug&#x56FE;</h5>
<p>&#x5982;&#x4E0B;&#x56FE;&#xFF0C;threadB&#x6301;&#x6709;&#x9501;&#xFF0C;&#x7136;&#x540E;threadC&#x662F;&#x5728;&#x6392;&#x961F;&#x4E2D;&#xFF0C;&#x7136;&#x540E;&#x53C8;&#x6765;&#x4E86;&#x4E2A;threadA&#xFF0C;&#x90A3;&#x4E48;threadA&#x5C31;&#x7EE7;&#x7EED;&#x6392;&#x961F;&#x7740;</p>
<p><img src="imgs/reentrant03.png" alt=""></p>
<p>&#x9644;&#xFF1A;debug&#x4EE3;&#x7801;</p>
<pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
    <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Thread</span> threadA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;A start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
                lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;A end&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;threadA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Thread</span> threadB <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;B start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;B Exception&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;B end&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;threadB&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Thread</span> threadC <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;C start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;C Exception&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;C end&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;threadC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    threadB<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    threadA<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    threadC<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    threadA<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    threadB<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    threadC<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;main end&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h5 id="&#x91CA;&#x653E;&#x9501;&#x8FC7;&#x7A0B;">&#x91CA;&#x653E;&#x9501;&#x8FC7;&#x7A0B;</h5>
<p>ReentranctLock&#x5185;&#x90E8;&#x7C7B;Sync&#x7684;<code>tryRelease</code>&#x65B9;&#x6CD5;</p>
<pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sync<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">tryRelease</span><span class="token punctuation">(</span><span class="token keyword">int</span> releases<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// statue&#x53D8;&#x91CF;&#x51CF;&#x5C11;release&#x6570;&#x91CF;&#xFF0C;&#x540C;&#x65F6;&#x8BBE;&#x7F6E; exclusiveOwnerThread &#x4E3A;null</span>
    <span class="token comment">// &#x8FD9;&#x91CC;&#x5224;&#x65AD;&#x4E86; exclusiveOwnerThread &#x5FC5;&#x987B;&#x662F;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x624D;&#x80FD;&#x6267;&#x884C;&#x6210;&#x529F;</span>
    <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> releases<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token function">getExclusiveOwnerThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalMonitorStateException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> free <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        free <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token function">setExclusiveOwnerThread</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">setState</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> free<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>aqs release&#x65B9;&#x6CD5;</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token comment">/**
* Releases in exclusive mode.  Implemented by unblocking one or
* more threads if {@link #tryRelease} returns true.
* This method can be used to implement method {@link Lock#unlock}.
*
* @param arg the release argument.  This value is conveyed to
*        {@link #tryRelease} but is otherwise uninterpreted and
*        can represent anything you like.
* @return the value returned from {@link #tryRelease}
*/</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">release</span><span class="token punctuation">(</span><span class="token keyword">int</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">tryRelease</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// &#x91CA;&#x653E;&#x6210;&#x529F;&#xFF0C;&#x5982;&#x679C;CLH&#x961F;&#x5217;&#x4E2D;&#x6709;&#x7B49;&#x5F85;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x8FDB;&#x884C;unpark&#x5524;&#x9192;CLH&#x961F;&#x5217;&#x5934;&#x90E8;Node</span>
        <span class="token class-name">Node</span> h <span class="token operator">=</span> head<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>h <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> h<span class="token punctuation">.</span>waitStatus <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token function">unparkSuccessor</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h5 id="&#x516C;&#x5E73;&#x9501;&#x4F18;&#x7F3A;&#x70B9;">&#x516C;&#x5E73;&#x9501;&#x4F18;&#x7F3A;&#x70B9;</h5>
<ul>
<li><p>&#x516C;&#x5E73;&#x9501;&#x6BCF;&#x6B21;&#x83B7;&#x53D6;&#x5230;&#x9501;&#x4E3A;&#x540C;&#x6B65;&#x961F;&#x5217;&#x4E2D;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#xFF0C;&#x4FDD;&#x8BC1;&#x8BF7;&#x6C42;&#x8D44;&#x6E90;&#x65F6;&#x95F4;&#x4E0A;&#x7684;&#x7EDD;&#x5BF9;&#x987A;&#x5E8F;&#xFF0C;&#x800C;&#x975E;&#x516C;&#x5E73;&#x9501;&#x6709;&#x53EF;&#x80FD;&#x521A;&#x91CA;&#x653E;&#x9501;&#x7684;&#x7EBF;&#x7A0B;&#x4E0B;&#x6B21;&#x7EE7;&#x7EED;&#x83B7;&#x53D6;&#x8BE5;&#x9501;&#xFF0C;&#x5219;&#x6709;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x5176;&#x5B83;&#x7EBF;&#x7A0B;&#x6C38;&#x8FDC;&#x65E0;&#x6CD5;&#x83B7;&#x53D6;&#x5230;&#x9501;&#xFF0C;&#x9020;&#x6210;<code>&#x9965;&#x997F;</code>&#x73B0;&#x8C61;&#x3002;</p>
</li>
<li><p>&#x516C;&#x5E73;&#x9501;&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x65F6;&#x95F4;&#x4E0A;&#x7684;&#x7EDD;&#x5BF9;&#x987A;&#x5E8F;&#xFF0C;&#x9700;&#x8981;<strong>&#x9891;&#x7E41;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x5207;&#x6362;</strong>&#xFF1B;&#x800C;&#x975E;&#x516C;&#x5E73;&#x9501;&#x4F1A;&#x964D;&#x4F4E;&#x4E86;&#x4E00;&#x5B9A;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x5207;&#x6362;&#xFF0C;&#x964D;&#x4F4E;&#x6027;&#x80FD;&#x5F00;&#x9500;&#x3002;</p>
</li>
</ul>
<h4 id="&#x975E;&#x516C;&#x5E73;&#x9501;&#xFF08;reentrantlock&#x9ED8;&#x8BA4;&#x975E;&#x516C;&#x5E73;&#xFF09;">&#x975E;&#x516C;&#x5E73;&#x9501;&#xFF08;ReentrantLock&#x9ED8;&#x8BA4;&#x975E;&#x516C;&#x5E73;&#xFF09;</h4>
<p>&#x5C31;&#x662F;&#x4E00;&#x79CD;&#x83B7;&#x53D6;&#x9501;&#x7684;<code>&#x62A2;&#x5360;</code>&#x673A;&#x5236;&#xFF0C;&#x662F;&#x968F;&#x673A;&#x83B7;&#x5F97;&#x9501;&#x7684;&#xFF0C;&#x548C;&#x516C;&#x5E73;&#x9501;&#x4E0D;&#x4E00;&#x6837;&#x7684;&#x5C31;&#x662F;&#x5148;&#x6765;&#x7684;&#x4E0D;&#x4E00;&#x5B9A;&#x5148;&#x5F97;&#x5230;&#x9501;&#xFF0C;&#x8FD9;&#x4E2A;&#x65B9;&#x5F0F;&#x53EF;&#x80FD;&#x9020;&#x6210;&#x67D0;&#x4E9B;&#x7EBF;&#x7A0B;&#x4E00;&#x76F4;&#x62FF;&#x4E0D;&#x5230;&#x9501;&#xFF0C;&#x7ED3;&#x679C;&#x4E5F;&#x5C31;&#x662F;&#x4E0D;&#x516C;&#x5E73;&#x3002;&#x5C1D;&#x8BD5;&#x62A2;&#x5360;&#x5931;&#x8D25;&#xFF0C;&#x5C31;&#x518D;&#x91C7;&#x7528;&#x516C;&#x5E73;&#x9501;&#x7684;&#x90A3;&#x79CD;&#x65B9;&#x5F0F;&#xFF0C;<code>&#x541E;&#x5410;&#x91CF;</code>&#x5927;&#x4E8E;&#x516C;&#x5E73;&#x9501;</p>
<h5 id="&#x83B7;&#x53D6;&#x9501;&#xFF08;&#x533A;&#x522B;&#x516C;&#x5E73;&#x9501;&#xFF09;">&#x83B7;&#x53D6;&#x9501;&#xFF08;&#x533A;&#x522B;&#x516C;&#x5E73;&#x9501;&#xFF09;</h5>
<ol>
<li>&#x975E;&#x516C;&#x5E73;&#x76F4;&#x63A5;&#x5148;&#x8FDB;&#x884C;&#x7684;&#x662F;CAS&#x64CD;&#x4F5C;:<code>compareAndSetState(0, 1)</code>(&#x5373;&#x662F;&#x53EF;&#x62A2;&#x5360;&#x9501;&#x7684;)&#xFF0C;&#x83B7;&#x53D6;&#x5230;&#x5C31;&#x8BBE;&#x7F6E;<code>exclusiveOwnerThread</code></li>
<li>&#x5982;&#x679C;CAS&#x64CD;&#x4F5C;&#x5931;&#x8D25;&#xFF0C;&#x518D;&#x8FDB;&#x884C;<code>acquire(1)</code>&#x64CD;&#x4F5C;</li>
</ol>
<p>&#x53EA;&#x8981;state=0(&#x5373;&#x9501;&#x662F;&#x7A7A;&#x95F2;&#x7684;&#x4E86;)&#xFF0C;&#x5C31;&#x76F4;&#x63A5;CAS&#x5C1D;&#x8BD5;&#x83B7;&#x53D6;&#xFF0C;&#x800C;&#x4E0D;&#x9700;&#x8981;&#x5224;&#x65AD;&#x662F;&#x5426;CLH&#x961F;&#x5217;&#x4E2D;&#x524D;&#x9A71;&#x8282;&#x70B9;</p>
<pre class="language-"><code class="lang-java"><span class="token comment">/**
* Sync object for non-fair locks
*/</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">NonfairSync</span> <span class="token keyword">extends</span> <span class="token class-name">Sync</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">7316153563782823691L</span><span class="token punctuation">;</span>

    <span class="token comment">/**
        * Performs lock.  Try immediate barge, backing up to normal
        * acquire on failure.
        */</span>
    <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">compareAndSetState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token function">setExclusiveOwnerThread</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            <span class="token function">acquire</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">tryAcquire</span><span class="token punctuation">(</span><span class="token keyword">int</span> acquires<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">nonfairTryAcquire</span><span class="token punctuation">(</span>acquires<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token operator">*</span> AQS&#x7684;`acquire`&#x65B9;&#x6CD5;

```java
<span class="token comment">/**
* Acquires in exclusive mode, ignoring interrupts.  Implemented
* by invoking at least once {@link #tryAcquire},
* returning on success.  Otherwise the thread is queued, possibly
* repeatedly blocking and unblocking, invoking {@link
* #tryAcquire} until success.  This method can be used
* to implement method {@link Lock#lock}.
*
* @param arg the acquire argument.  This value is conveyed to
*        {@link #tryAcquire} but is otherwise uninterpreted and
*        can represent anything you like.
*/</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">acquire</span><span class="token punctuation">(</span><span class="token keyword">int</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">tryAcquire</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        <span class="token function">acquireQueued</span><span class="token punctuation">(</span><span class="token function">addWaiter</span><span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token punctuation">.</span>EXCLUSIVE<span class="token punctuation">)</span><span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">selfInterrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>NonfairSync&#x7684;<code>tryAcquire</code>&#x65B9;&#x6CD5;</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token comment">/**
* Performs non-fair tryLock.  tryAcquire is implemented in
* subclasses, but both need nonfair try for trylock method.
*/</span>
<span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">nonfairTryAcquire</span><span class="token punctuation">(</span><span class="token keyword">int</span> acquires<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">Thread</span> current <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// &#x5982;&#x679C;&#x8BE5;&#x9501;&#x672A;&#x88AB;&#x4EFB;&#x4F55;&#x7EBF;&#x7A0B;&#x5360;&#x6709;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// &#x4E0D;&#x7BA1;&#x5BF9;&#x5217;&#x662F;&#x5426;&#x6709;&#x6392;&#x961F;&#x7EBF;&#x7A0B;&#xFF0C;&#x76F4;&#x63A5;cas&#x5C1D;&#x8BD5;&#x83B7;&#x53D6;&#xFF0C;&#x4E0D;&#x8003;&#x8651;&#x5F53;&#x524D;&#x540C;&#x6B65;&#x961F;&#x5217;&#x4E2D;&#x7EBF;&#x7A0B;&#x7B49;&#x5F85;&#x7684;&#x60C5;&#x51B5;&#xFF08;&#x533A;&#x522B;&#x4E8E;&#x516C;&#x5E73;&#x65B9;&#x5F0F;&#xFF09;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">compareAndSetState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> acquires<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">setExclusiveOwnerThread</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// &#x5982;&#x679C;state!=0,&#x8BF4;&#x660E;&#x6709;&#x7EBF;&#x7A0B;&#x5360;&#x7528;&#x3002;&#x5219;&#x5224;&#x65AD;&#x8BE5;&#x7EBF;&#x7A0B;&#x662F;&#x5426;&#x4E3A;&#x81EA;&#x8EAB;,&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x505A;&#x7EBF;&#x7A0B;&#x7684;&#x91CD;&#x5165;&#x3002;&#x5982;&#x679C;&#x662F;&#x81EA;&#x8EAB;,&#x5219;&#x5C06;state&#x52A0;1</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">==</span> <span class="token function">getExclusiveOwnerThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> nextc <span class="token operator">=</span> c <span class="token operator">+</span> acquires<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>nextc <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// overflow</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Maximum lock count exceeded&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setState</span><span class="token punctuation">(</span>nextc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="&#x4EC0;&#x4E48;&#x662F;&#x53EF;&#x91CD;&#x5165;&#xFF1F;">&#x4EC0;&#x4E48;&#x662F;&#x53EF;&#x91CD;&#x5165;&#xFF1F;</h3>
<p>&#x540C;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x53EF;&#x4EE5;&#x53CD;&#x590D;&#x83B7;&#x53D6;&#x9501;&#x591A;&#x6B21;&#xFF0C;&#x7136;&#x540E;&#x9700;&#x8981;&#x91CA;&#x653E;&#x591A;&#x6B21;</p>
<p>&#x540C;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x5728;&#x5916;&#x5C42;&#x51FD;&#x6570;&#x83B7;&#x5F97;&#x9501;&#x4E4B;&#x540E;&#xFF0C;&#x5185;&#x5C42;&#x9012;&#x5F52;&#x51FD;&#x6570;&#x4ECD;&#x80FD;&#x83B7;&#x53D6;&#x8BE5;&#x9501;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x5728;&#x5916;&#x5C42;&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x9501;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5728;&#x8FDB;&#x5165;&#x5185;&#x5C42;&#x65B9;&#x6CD5;&#x4F1A;&#x81EA;&#x52A8;&#x83B7;&#x53D6;&#x9501;&#xFF0C;&#x5373;&#xFF1A;<strong>&#x7EBF;&#x7A0B;&#x53EF;&#x4EE5;&#x8FDB;&#x5165;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x5B83;&#x5DF2;&#x7ECF;&#x62E5;&#x6709;&#x7684;&#x9501;&#x6240;&#x540C;&#x6B65;&#x7684;&#x4EE3;&#x7801;&#x5757;</strong>&#xFF0C;&#x9632;&#x6B62;&#x6B7B;&#x9501;</p>
<p>&#x91CD;&#x5165;&#x9501;&#x5B9E;&#x73B0;&#x53EF;&#x91CD;&#x5165;&#x6027;&#x539F;&#x7406;&#x6216;&#x673A;&#x5236;&#x662F;&#xFF1A;&#x6BCF;&#x4E00;&#x4E2A;&#x9501;&#x5173;&#x8054;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x6301;&#x6709;&#x8005;&#x548C;&#x8BA1;&#x6570;&#x5668;&#xFF0C;&#x5F53;&#x8BA1;&#x6570;&#x5668;&#x4E3A; 0 &#x65F6;&#x8868;&#x793A;&#x8BE5;&#x9501;&#x6CA1;&#x6709;&#x88AB;&#x4EFB;&#x4F55;&#x7EBF;&#x7A0B;&#x6301;&#x6709;&#xFF0C;&#x90A3;&#x4E48;&#x4EFB;&#x4F55;&#x7EBF;&#x7A0B;&#x90FD;&#x53EF;&#x80FD;&#x83B7;&#x5F97;&#x8BE5;&#x9501;&#x800C;&#x8C03;&#x7528;&#x76F8;&#x5E94;&#x7684;&#x65B9;&#x6CD5;&#xFF1B;&#x5F53;&#x67D0;&#x4E00;&#x7EBF;&#x7A0B;&#x8BF7;&#x6C42;&#x6210;&#x529F;&#x540E;&#xFF0C;JVM&#x4F1A;&#x8BB0;&#x4E0B;&#x9501;&#x7684;&#x6301;&#x6709;&#x7EBF;&#x7A0B;&#xFF0C;&#x5E76;&#x4E14;&#x5C06;&#x8BA1;&#x6570;&#x5668;&#x7F6E;&#x4E3A; 1&#xFF1B;&#x6B64;&#x65F6;&#x5176;&#x5B83;&#x7EBF;&#x7A0B;&#x8BF7;&#x6C42;&#x8BE5;&#x9501;&#xFF0C;&#x5219;&#x5FC5;&#x987B;&#x7B49;&#x5F85;&#xFF1B;&#x800C;&#x8BE5;&#x6301;&#x6709;&#x9501;&#x7684;&#x7EBF;&#x7A0B;&#x5982;&#x679C;&#x518D;&#x6B21;&#x8BF7;&#x6C42;&#x8FD9;&#x4E2A;&#x9501;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x518D;&#x6B21;&#x62FF;&#x5230;&#x8FD9;&#x4E2A;&#x9501;&#xFF0C;&#x540C;&#x65F6;&#x8BA1;&#x6570;&#x5668;&#x4F1A;&#x9012;&#x589E;&#xFF1B;&#x5F53;&#x7EBF;&#x7A0B;&#x9000;&#x51FA;&#x540C;&#x6B65;&#x4EE3;&#x7801;&#x5757;&#x65F6;&#xFF0C;&#x8BA1;&#x6570;&#x5668;&#x4F1A;&#x9012;&#x51CF;&#xFF0C;&#x5982;&#x679C;&#x8BA1;&#x6570;&#x5668;&#x4E3A; 0&#xFF0C;&#x5219;&#x91CA;&#x653E;&#x8BE5;&#x9501;&#x3002;</p>
<ul>
<li>synchronized&#x662F;&#x53EF;&#x91CD;&#x5165;&#x9501;</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent</span><span class="token punctuation">.</span><span class="token class-name">TimeUnit</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks</span><span class="token punctuation">.</span><span class="token class-name">Lock</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks</span><span class="token punctuation">.</span><span class="token class-name">ReentrantLock</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Phone</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">sendSMS</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span> <span class="token string">&quot;\t invoked sendSMS()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">sendEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">sendEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span> <span class="token string">&quot;\t #####invoked sendEmail()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ==============================================================</span>
    <span class="token comment">/**
     *  &#x53EF;&#x91CD;&#x5165;&#x9501;&#x5E95;&#x5C42;&#x539F;&#x7406;&#xFF1A;&#x516C;&#x5E73;&#x9501;&#x548C;&#x975E;&#x516C;&#x5E73;&#x9501;(&#x9ED8;&#x8BA4;)
     *  &#x516C;&#x5E73;&#x9501;&#xFF1A;&#x662F;&#x6307;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x6309;&#x7167;&#x7533;&#x8BF7;&#x9501;&#x7684;&#x987A;&#x5E8F;&#x6765;&#x83B7;&#x53D6;&#x9501;&#xFF0C;&#x7C7B;&#x4F3C;&#x6392;&#x961F;&#x6253;&#x996D;&#xFF0C;&#x5148;&#x6765;&#x540E;&#x5230;&#x3002;
     *  &#x975E;&#x516C;&#x5E73;&#x9501;&#xFF1A;&#x662F;&#x6307;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x83B7;&#x53D6;&#x9501;&#x7684;&#x987A;&#x5E8F;&#x5E76;&#x4E0D;&#x662F;&#x6309;&#x7167;&#x7533;&#x8BF7;&#x9501;&#x7684;&#x987A;&#x5E8F;&#xFF0C;&#x6709;&#x53EF;&#x80FD;&#x540E;&#x7533;&#x8BF7;&#x7684;&#x7EBF;&#x7A0B;&#x6BD4;&#x5148;&#x7533;&#x8BF7;&#x7684;&#x7EBF;&#x7A0B;&#x4F18;&#x5148;&#x83B7;&#x53D6;&#x9501;
     *            &#x5728;&#x9AD8;&#x5E76;&#x53D1;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6709;&#x53EF;&#x80FD;&#x4F1A;&#x9020;&#x6210;&#x4F18;&#x5148;&#x7EA7;&#x53CD;&#x8F6C;&#x6216;&#x8005;&#x9965;&#x997F;&#x73B0;&#x8C61;&#x3002;&#x4F18;&#x70B9;&#xFF1A;&#x541E;&#x5410;&#x91CF;&#x6BD4;&#x516C;&#x5E73;&#x9501;&#x5927;&#x3002;
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Lock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">getd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">getd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span> <span class="token string">&quot;\t invoked getd()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">setd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">setd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#x8FD9;&#x91CC;&#x6CE8;&#x91CA;&#x6389;&#x4F1A;&#x51FA;&#x73B0;&#xFF1A;java.lang.IllegalMonitorStateException&#xFF0C;&#x6240;&#x4EE5;&#x9501;&#x4E00;&#x5B9A;&#x8981;&#x914D;&#x5BF9;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span> <span class="token string">&quot;\t ### invoked setd()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * @author doinb
 * &#x53EF;&#x91CD;&#x5165;&#x9501;&#xFF08;&#x4E5F;&#x53EB;&#x505A;&#x9012;&#x5F52;&#x9501;&#xFF09; &#x4F5C;&#x7528;&#xFF1A;&#x907F;&#x514D;&#x6B7B;&#x9501;
 *
 * &#x6307;&#x7684;&#x662F;&#x540C;&#x4E00;&#x7EBF;&#x7A0B;&#x5916;&#x5C42;&#x51FD;&#x6570;&#x83B7;&#x5F97;&#x9501;&#x4E4B;&#x540E;&#xFF0C;&#x5185;&#x5C42;&#x51FD;&#x6570;&#x4ECD;&#x7136;&#x80FD;&#x83B7;&#x53D6;&#x8BE5;&#x9501;&#x4EE3;&#x7801;&#xFF0C;
 * &#x5728;&#x540C;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x5728;&#x5916;&#x5C42;&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x9501;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5728;&#x8FDB;&#x5165;&#x5185;&#x5C42;&#x65B9;&#x6CD5;&#x4F1A;&#x81EA;&#x52A8;&#x83B7;&#x53D6;&#x9501;
 *
 * &#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x7EBF;&#x7A0B;&#x53EF;&#x4EE5;&#x8FDB;&#x5165;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x5B83;&#x5DF2;&#x7ECF;&#x62E5;&#x6709;&#x7684;&#x9501;&#x6240;&#x540C;&#x6B65;&#x7684;&#x4EE3;&#x7801;&#x5757;&#x3002;
 *
 *  case 1 Synchronized&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x5178;&#x578B;&#x7684;&#x53EF;&#x91CD;&#x5165;&#x9501;
 * t1     invoked sendSMS()          t1&#x7EBF;&#x7A0B;&#x5728;&#x5916;&#x5C42;&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x9501;&#x7684;&#x65F6;&#x5019;
 * t1     #####invoked sendEmail()   t1&#x5728;&#x8FDB;&#x5165;&#x5185;&#x5C42;&#x65B9;&#x6CD5;&#x4F1A;&#x81EA;&#x52A8;&#x83B7;&#x53D6;&#x9501;
 * t2     invoked sendSMS()
 * t2     #####invoked sendEmail()
 *
 *  case 2 ReentrantLock&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x5178;&#x578B;&#x7684;&#x53EF;&#x91CD;&#x5165;&#x9501;
 * t3     invoked getd()
 * t3     ### invoked setd()
 * t4     invoked getd()
 * t4     ### invoked setd()
 *
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Phone</span> phone <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                phone<span class="token punctuation">.</span><span class="token function">sendSMS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                phone<span class="token punctuation">.</span><span class="token function">sendSMS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// &#x6682;&#x505C;&#x4E00;&#x4F1A;</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;### lock&#x7684;&#x542F;&#x52A8;&#x65B9;&#x5F0F;&#xFF0C;&#x56E0;&#x4E3A;&#x5B9E;&#x73B0;&#x4E86;Runnable&#x63A5;&#x53E3; ###&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// lock&#x7684;&#x542F;&#x52A8;&#x65B9;&#x5F0F;&#xFF0C;&#x56E0;&#x4E3A;&#x5B9E;&#x73B0;&#x4E86;Runnable&#x63A5;&#x53E3;</span>
        <span class="token class-name">Thread</span> t3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>phone<span class="token punctuation">,</span> <span class="token string">&quot;t3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>phone<span class="token punctuation">,</span> <span class="token string">&quot;t4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t4<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<p>ReentrantLock&#x7EE7;&#x627F;&#x7236;&#x7C7B;AQS&#xFF08;AQS&#x5185;&#x90E8;&#x7EF4;&#x62A4;&#x4E86;&#x4E00;&#x4E2A;&#x540C;&#x6B65;&#x72B6;&#x6001;status&#x6765;&#x8BA1;&#x6570;&#x91CD;&#x5165;&#x6B21;&#x6570;&#xFF0C;&#x521D;&#x59CB;&#x4E3A;0&#xFF09;</p>
<ul>
<li>&#x5F53;&#x7EBF;&#x7A0B;&#x5C1D;&#x8BD5;&#x83B7;&#x53D6;&#x9501;&#x65F6;&#xFF0C;&#x53EF;&#x91CD;&#x5165;&#x9501;&#x5148;&#x5C1D;&#x8BD5;&#x83B7;&#x53D6;&#x5E76;&#x66F4;&#x65B0;<code>state</code>&#x503C;&#xFF0C;&#x5982;&#x679C;<code>state == 0</code>&#x8868;&#x793A;&#x6CA1;&#x6709;&#x5176;&#x5B83;&#x7EBF;&#x7A0B;&#x5728;&#x6267;&#x884C;&#x540C;&#x6B65;&#x4EE3;&#x7801;&#xFF0C;&#x5219;&#x5C06;<code>state</code>&#x8BBE;&#x7F6E;&#x4E3A;1,&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x5F00;&#x59CB;&#x6267;&#x884C;&#xFF1B;&#x975E;&#x53EF;&#x91CD;&#x5165;&#x9501;&#x540C;</li>
<li><p>&#x5982;&#x679C;<code>state &gt; 0</code>&#xFF0C;&#x5219;&#x5224;&#x65AD;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x662F;&#x5426;&#x662F;&#x83B7;&#x53D6;&#x5230;&#x8FD9;&#x4E2A;&#x9501;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x5219;<code>state = state + 1</code>&#xFF1B;&#x5982;&#x679C;&#x662F;&#x975E;&#x91CD;&#x5165;&#x9501;&#xFF0C;&#x5219;&#x76F4;&#x63A5;&#x53BB;&#x83B7;&#x53D6;&#x5E76;&#x66F4;&#x65B0;&#x5F53;&#x524D;status&#xFF0C;&#x6B64;&#x65F6;&#x5982;&#x679C;<code>state &gt; 0</code>&#x5219;&#x4F1A;&#x5BFC;&#x81F4;&#x5176;&#x83B7;&#x53D6;&#x9501;&#x5931;&#x8D25;&#xFF0C;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x4F1A;&#x963B;&#x585E;</p>
</li>
<li><p>&#x53EF;&#x91CD;&#x524D;<code>state == 1</code></p>
</li>
</ul>
<p><img src="imgs/lock_sync_state.png" alt=""></p>
<ul>
<li>&#x53EF;&#x91CD;&#x5165;&#x64CD;&#x4F5C;&#xFF0C;<code>state = state + 1</code></li>
</ul>
<p><img src="imgs/lock_sync_state_2.png" alt=""></p>
<ul>
<li>&#x53EF;&#x91CD;&#x5165;&#x4E4B;&#x540E;&#x518D; <code>state = state - 1</code></li>
</ul>
<p><img src="imgs/lock_sync_state_3.png" alt=""></p>
<h3 id="&#x5BF9;&#x6BD4;synchronized-reentrantlock&#x7684;&#x4E00;&#x4E9B;&#x9AD8;&#x7EA7;&#x529F;&#x80FD;">&#x5BF9;&#x6BD4;synchronized, ReentrantLock&#x7684;&#x4E00;&#x4E9B;&#x9AD8;&#x7EA7;&#x529F;&#x80FD;</h3>
<ul>
<li>&#x7B49;&#x5F85;&#x53EF;&#x4E2D;&#x65AD;&#xFF0C;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x7B49;&#x5F85;&#x8D85;&#x65F6;</li>
</ul>
<p>&#x6301;&#x6709;&#x9501;&#x7684;&#x7EBF;&#x7A0B;&#x957F;&#x671F;&#x4E0D;&#x91CA;&#x653E;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6B63;&#x5728;&#x7B49;&#x5F85;&#x7684;&#x7EBF;&#x7A0B;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x653E;&#x5F03;&#x7B49;&#x5F85;&#xFF0C;&#x8FD9;&#x76F8;&#x5F53;&#x4E8E;Synchronized&#x6765;&#x8BF4;&#x53EF;&#x4EE5;&#x907F;&#x514D;&#x51FA;&#x73B0;&#x6B7B;&#x9501;&#x7684;&#x60C5;&#x51B5;&#x3002;</p>
<ul>
<li>&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x516C;&#x5E73;&#x9501;</li>
</ul>
<p><code>ReentrantLock</code>&#x9ED8;&#x8BA4;&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x662F;&#x521B;&#x5EFA;&#x7684;<code>&#x975E;&#x516C;&#x5E73;&#x9501;</code>&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x53C2;&#x6570;<code>true</code>&#x8BBE;&#x4E3A;<code>&#x516C;&#x5E73;&#x9501;</code>&#xFF0C;&#x4F46;&#x516C;&#x5E73;&#x9501;&#x8868;&#x73B0;&#x7684;&#x6027;&#x80FD;&#x4E0D;&#x662F;&#x5F88;&#x597D;&#x3002;</p>
<p><code>synchronized</code>&#x662F;&#x975E;&#x516C;&#x5E73;&#x9501;&#xFF08;&#x56E0;&#x4E3A;<code>synchronized</code>&#x662F;&#x4E0D;&#x516C;&#x5E73;&#x7ADE;&#x4E89;&#xFF0C;&#x540E;&#x6765;&#x7684;&#x7EBF;&#x7A0B;&#x53EF;&#x80FD;&#x5148;&#x5F97;&#x5230;&#x9501;&#xFF0C;&#x8FDB;&#x800C;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x5148;&#x5230;&#x7684;&#x7EBF;&#x7A0B;&#x6301;&#x7EED;&#x9965;&#x997F;&#xFF0C;&#x975E;&#x516C;&#x5E73;&#x7ADE;&#x4E89;&#x5728;&#x5F88;&#x5927;&#x7A0B;&#x5EA6;&#x4E0A;&#x63D0;&#x5347;&#x4E86;<code>synchronized</code>&#x541E;&#x5410;&#x7387;&#xFF09;&#xFF1B;<code>synchronized</code>&#x662F;&#x53EF;&#x4EE5;&#x91CD;&#x5165;&#x7684;&#x3002;</p>
<ul>
<li>&#x9501;&#x7ED1;&#x5B9A;&#x591A;&#x4E2A;&#x6761;&#x4EF6;&#xFF0C;<code>Condition</code>&#x66F4;&#x52A0;&#x7684;&#x7075;&#x6D3B;</li>
</ul>
<p>&#x4E00;&#x4E2A;<code>ReentrantLock</code>&#x5BF9;&#x8C61;&#x53EF;&#x4EE5;&#x540C;&#x65F6;&#x7ED1;&#x5B9A;&#x5BF9;&#x4E2A;&#x5BF9;&#x8C61;&#x3002;</p>
<h3 id="&#x9501;&#x7533;&#x8BF7;&#x7B49;&#x5F85;&#x9650;&#x65F6;&#x5B9E;&#x9645;&#x4F8B;&#x5B50;">&#x9501;&#x7533;&#x8BF7;&#x7B49;&#x5F85;&#x9650;&#x65F6;&#x5B9E;&#x9645;&#x4F8B;&#x5B50;</h3>
<p>&#x7533;&#x8BF7;&#x9501;&#xFF0C;&#x4E00;&#x5B9A;&#x65F6;&#x95F4;&#x5185;&#x83B7;&#x53D6;&#x4E0D;&#x5230;&#xFF0C;&#x9009;&#x62E9;&#x653E;&#x5F03;</p>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>thread</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent</span><span class="token punctuation">.</span><span class="token class-name">TimeUnit</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks</span><span class="token punctuation">.</span><span class="token class-name">Condition</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks</span><span class="token punctuation">.</span><span class="token class-name">Lock</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks</span><span class="token punctuation">.</span><span class="token class-name">ReentrantLock</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Author mubi
 * @Date 2019/3/15 7:24 AM
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token class-name">Lock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Condition</span> condition <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span> threadA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;A start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
                    lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span> threadB <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>lock<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;B get lock start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; tryLock error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;B Exception&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ReentrantLock</span><span class="token punctuation">)</span> lock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isHeldByCurrentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        threadA<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// &#x8BA9;A &#x5148;&#x4E8E;B &#x8FD0;&#x884C;</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        threadB<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        threadA<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        threadB<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;main end&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="&#x8BFB;&#x5199;&#x9501;&#x4F8B;reentrantreadwritelock&#xFF0C;aqs&#x5171;&#x4EAB;">&#x8BFB;&#x5199;&#x9501;(&#x4F8B;:ReentrantReadWriteLock&#xFF0C;Aqs&#x5171;&#x4EAB;)</h2>
<p>&#x8BFB;&#x5199;&#x9501;&#x5B9E;&#x9645;&#x662F;&#x4E00;&#x79CD;&#x7279;&#x6B8A;&#x7684;<code>&#x81EA;&#x65CB;&#x9501;</code>&#xFF0C;&#x5B83;&#x628A;&#x5BF9;&#x5171;&#x4EAB;&#x8D44;&#x6E90;&#x7684;&#x8BBF;&#x95EE;&#x8005;&#x5212;&#x5206;&#x6210;&#x8BFB;&#x8005;&#x548C;&#x5199;&#x8005;&#xFF0C;&#x8BFB;&#x8005;&#x53EA;&#x5BF9;&#x5171;&#x4EAB;&#x8D44;&#x6E90;&#x8FDB;&#x884C;&#x8BFB;&#x8BBF;&#x95EE;&#xFF0C;&#x5199;&#x8005;&#x5219;&#x9700;&#x8981;&#x5BF9;&#x5171;&#x4EAB;&#x8D44;&#x6E90;&#x8FDB;&#x884C;&#x5199;&#x64CD;&#x4F5C;&#x3002;</p>
<p>&#x4E00;&#x6B21;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x53EF;&#x4EE5;&#x5360;&#x6709;<code>&#x5199;&#x6A21;&#x5F0F;</code>&#x7684;&#x8BFB;&#x5199;&#x9501;, &#x4F46;&#x662F;&#x53EF;&#x4EE5;&#x6709;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x540C;&#x65F6;&#x5360;&#x6709;<code>&#x8BFB;&#x6A21;&#x5F0F;</code>&#x7684;&#x8BFB;&#x5199;&#x9501;.</p>
<h3 id="reentrantreadwritelock&#xFF08;&#x9ED8;&#x8BA4;&#xFF0C;&#x975E;&#x516C;&#x5E73;&#xFF09;">ReentrantReadWriteLock&#xFF08;&#x9ED8;&#x8BA4;&#xFF0C;&#x975E;&#x516C;&#x5E73;&#xFF09;</h3>
<ul>
<li>ReentrantReadWriteLock &#x7684;&#x6784;&#x9020;&#xFF0C;&#x5185;&#x90E8;&#x6709;&#xFF1A;readerLock &#x548C; writerLock&#xFF0C;&#x90FD;&#x662F;&#x4F7F;&#x7528;&#x7684;<code>NonfairSync</code>&#x6216;&#x8005;<code>FairSync</code></li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token comment">/**
* Creates a new {@code ReentrantReadWriteLock} with
* the given fairness policy.
*
* @param fair {@code true} if this lock should use a fair ordering policy
*/</span>
<span class="token keyword">public</span> <span class="token class-name">ReentrantReadWriteLock</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> fair<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sync <span class="token operator">=</span> fair <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">FairSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">NonfairSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    readerLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReadLock</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    writerLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WriteLock</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
* Fair version of Sync
*/</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">FairSync</span> <span class="token keyword">extends</span> <span class="token class-name">Sync</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2274990926593161451L</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">writerShouldBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">hasQueuedPredecessors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">readerShouldBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">hasQueuedPredecessors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="&#x8BFB;&#x5199;&#x9501;&#x4F2A;&#x4EE3;&#x7801;">&#x8BFB;&#x5199;&#x9501;&#x4F2A;&#x4EE3;&#x7801;</h3>
<pre class="language-"><code class="lang-cpp">count_mutex <span class="token operator">=</span> <span class="token function">mutex_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
write_mutex <span class="token operator">=</span> <span class="token function">mutex_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
read_count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> read_lock<span class="token punctuation">{</span>
    <span class="token function">lock</span><span class="token punctuation">(</span>count_mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    read_count<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>read_count <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// &#x7B2C;&#x4E00;&#x4E2A;&#x8BFB;&#x8005;&#x5F00;&#x59CB;&#x8BFB;&#x65F6;&#x83B7;&#x5F97;&#x5199;&#x9501;</span>
        <span class="token function">lock</span><span class="token punctuation">(</span>write_mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">unlock</span><span class="token punctuation">(</span>count_mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> read_unlock<span class="token punctuation">{</span>
    <span class="token function">lock</span><span class="token punctuation">(</span>count_mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    read_count<span class="token operator">--</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>read_count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//  &#x6700;&#x540E;&#x4E00;&#x4E2A;&#x8BFB;&#x8005;&#x79BB;&#x5F00;&#x65F6;&#x91CA;&#x653E;&#x5199;&#x9501;</span>
        <span class="token function">unlock</span><span class="token punctuation">(</span>write_mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">unlock</span><span class="token punctuation">(</span>count_mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> write_lock<span class="token punctuation">{</span>
    <span class="token function">lock</span><span class="token punctuation">(</span>write_mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> write_unlock<span class="token punctuation">{</span>
    <span class="token function">unlock</span><span class="token punctuation">(</span>write_mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="&#x5B9E;&#x9645;&#x4F8B;&#x5B50;">&#x5B9E;&#x9645;&#x4F8B;&#x5B50;</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>thread</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>text</span><span class="token punctuation">.</span><span class="token class-name">SimpleDateFormat</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">Date</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">Random</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent</span><span class="token punctuation">.</span><span class="token class-name">ArrayBlockingQueue</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent</span><span class="token punctuation">.</span><span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent</span><span class="token punctuation">.</span><span class="token class-name">TimeUnit</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks</span><span class="token punctuation">.</span><span class="token class-name">Lock</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks</span><span class="token punctuation">.</span><span class="token class-name">ReentrantReadWriteLock</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Author mubi
 * @Date 2019/3/17 7:56 PM
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ReentrantReadWriteLock</span> rwLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantReadWriteLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Lock</span> readLock <span class="token operator">=</span> rwLock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Lock</span> writeLock <span class="token operator">=</span> rwLock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">double</span> data <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        readLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;&#x8BFB;&#x6570;&#x636E;&#xFF1A;&quot;</span> <span class="token operator">+</span> data
                    <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span>  <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            readLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        writeLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; ........&#x5199;&#x5165;&#x6570;&#x636E;: &quot;</span> <span class="token operator">+</span> data
                    <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span>  <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            writeLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Main</span> main <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ThreadPoolExecutor</span> pool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span>
                <span class="token number">10</span><span class="token punctuation">,</span>
                <span class="token number">200</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">.</span><span class="token class-name">DiscardOldestPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            pool<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span> main<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            pool<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span> main<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        pool<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>output</li>
</ul>
<p><strong>&#x67D0;&#x4E2A;&#x65F6;&#x523B;&#x53EF;&#x4EE5;&#x6709;&#x591A;&#x4E2A;&#x8BFB;&#xFF0C;&#x4F46;&#x53EA;&#x80FD;&#x6709;&#x4E00;&#x4E2A;&#x5199;&#xFF0C;&#x5199;&#x7684;&#x65F6;&#x5019;&#x4E0D;&#x80FD;&#x8BFB;&#xFF0C;&#x8BFB;&#x7684;&#x65F6;&#x5019;&#x4E0D;&#x80FD;&#x5199;</strong></p>
<pre class="language-"><code class="lang-java">pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">1</span>&#x8BFB;&#x6570;&#x636E;&#xFF1A;<span class="token number">0.0</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">53</span><span class="token operator">:</span><span class="token number">43</span>
pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">3</span>&#x8BFB;&#x6570;&#x636E;&#xFF1A;<span class="token number">0.0</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">53</span><span class="token operator">:</span><span class="token number">43</span>
pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>&#x5199;&#x5165;&#x6570;&#x636E;<span class="token operator">:</span> <span class="token number">0.14383955312719565</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">53</span><span class="token operator">:</span><span class="token number">48</span>
pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">2</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>&#x5199;&#x5165;&#x6570;&#x636E;<span class="token operator">:</span> <span class="token number">0.36604507657651075</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">53</span><span class="token operator">:</span><span class="token number">57</span>
pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">4</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>&#x5199;&#x5165;&#x6570;&#x636E;<span class="token operator">:</span> <span class="token number">0.24110141917904238</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">54</span><span class="token operator">:</span><span class="token number">03</span>
pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">4</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>&#x5199;&#x5165;&#x6570;&#x636E;<span class="token operator">:</span> <span class="token number">0.6412197875946629</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">54</span><span class="token operator">:</span><span class="token number">08</span>
pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">6</span>&#x8BFB;&#x6570;&#x636E;&#xFF1A;<span class="token number">0.6412197875946629</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">54</span><span class="token operator">:</span><span class="token number">09</span>
pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">5</span>&#x8BFB;&#x6570;&#x636E;&#xFF1A;<span class="token number">0.6412197875946629</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">54</span><span class="token operator">:</span><span class="token number">09</span>
pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">7</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>&#x5199;&#x5165;&#x6570;&#x636E;<span class="token operator">:</span> <span class="token number">0.3115143131633106</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">54</span><span class="token operator">:</span><span class="token number">12</span>
pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">8</span>&#x8BFB;&#x6570;&#x636E;&#xFF1A;<span class="token number">0.3115143131633106</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">54</span><span class="token operator">:</span><span class="token number">13</span>
pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">9</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>&#x5199;&#x5165;&#x6570;&#x636E;<span class="token operator">:</span> <span class="token number">0.08244939010952534</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">54</span><span class="token operator">:</span><span class="token number">21</span>
pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">3</span>&#x8BFB;&#x6570;&#x636E;&#xFF1A;<span class="token number">0.08244939010952534</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">54</span><span class="token operator">:</span><span class="token number">22</span>
pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">10</span>&#x8BFB;&#x6570;&#x636E;&#xFF1A;<span class="token number">0.08244939010952534</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">54</span><span class="token operator">:</span><span class="token number">22</span>
pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>&#x5199;&#x5165;&#x6570;&#x636E;<span class="token operator">:</span> <span class="token number">0.7060105583988802</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">54</span><span class="token operator">:</span><span class="token number">31</span>
pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">2</span>&#x8BFB;&#x6570;&#x636E;&#xFF1A;<span class="token number">0.7060105583988802</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">54</span><span class="token operator">:</span><span class="token number">32</span>
</code></pre>
<h2 id="&#x5206;&#x5E03;&#x5F0F;&#x9501;">&#x5206;&#x5E03;&#x5F0F;&#x9501;</h2>
<p>&#x5F88;&#x591A;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4FDD;&#x8BC1;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x5728;&#x540C;&#x4E00;&#x65F6;&#x95F4;&#x5185;&#x53EA;&#x80FD;&#x88AB;&#x540C;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x3002;&#x5728;&#x5355;&#x673A;&#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x901A;&#x8FC7; Java &#x63D0;&#x4F9B;&#x7684;&#x5E76;&#x53D1; API &#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x89E3;&#x51B3;&#xFF0C;&#x5206;&#x5E03;&#x5F0F;&#x73AF;&#x5883;&#x4E0B;</p>
<ol>
<li>&#x5206;&#x5E03;&#x5F0F;&#x4E0E;&#x5355;&#x673A;&#x60C5;&#x51B5;&#x4E0B;&#x6700;&#x5927;&#x7684;&#x4E0D;&#x540C;&#x5728;&#x4E8E;&#x5176;&#x4E0D;&#x662F;&#x591A;&#x7EBF;&#x7A0B;&#x800C;&#x662F;&#x591A;&#x8FDB;&#x7A0B;</li>
<li><code>&#x591A;&#x7EBF;&#x7A0B;</code>&#x7531;&#x4E8E;&#x53EF;&#x4EE5;<code>&#x5171;&#x4EAB;&#x5806;&#x5185;&#x5B58;</code>&#xFF0C;&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x7B80;&#x5355;&#x7684;&#x91C7;&#x53D6;&#x5185;&#x5B58;&#x4F5C;&#x4E3A;&#x6807;&#x8BB0;&#x5B58;&#x50A8;&#x4F4D;&#x7F6E;&#x3002;&#x800C;&#x8FDB;&#x7A0B;&#x4E4B;&#x95F4;&#x751A;&#x81F3;&#x53EF;&#x80FD;&#x90FD;&#x4E0D;&#x5728;&#x540C;&#x4E00;&#x53F0;&#x7269;&#x7406;&#x673A;&#x4E0A;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x5C06;<code>&#x6807;&#x8BB0;</code>&#x5B58;&#x50A8;&#x5728;&#x4E00;&#x4E2A;<code>&#x6240;&#x6709;&#x8FDB;&#x7A0B;</code>&#x90FD;&#x80FD;&#x770B;&#x5230;&#x7684;&#x5730;&#x65B9;</li>
</ol>
<p><a target="_blank" href="https://www.cnblogs.com/seesun2012/p/9214653.html">&#x53C2;&#x8003;</a></p>
<h3 id="&#x4EC0;&#x4E48;&#x662F;&#x5206;&#x5E03;&#x5F0F;&#x9501;&#xFF1F;">&#x4EC0;&#x4E48;&#x662F;&#x5206;&#x5E03;&#x5F0F;&#x9501;&#xFF1F;</h3>
<p>&#x5728;&#x5206;&#x5E03;&#x5F0F;&#x7684;&#x90E8;&#x7F72;&#x73AF;&#x5883;&#x4E0B;&#xFF0C;&#x901A;&#x8FC7;&#x9501;&#x673A;&#x5236;&#x6765;&#x8BA9;&#x591A;&#x5BA2;&#x6237;&#x7AEF;&#x4E92;&#x65A5;&#x7684;&#x5BF9;&#x5171;&#x4EAB;&#x8D44;&#x6E90;&#x8FDB;&#x884C;&#x8BBF;&#x95EE;</p>
<ul>
<li><p>&#x6392;&#x5B83;&#x6027;&#xFF1A;&#x5728;&#x540C;&#x4E00;&#x65F6;&#x95F4;&#x53EA;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x80FD;&#x83B7;&#x53D6;&#x5230;&#x9501;&#xFF0C;&#x5176;&#x5B83;&#x5BA2;&#x6237;&#x7AEF;&#x65E0;&#x6CD5;&#x540C;&#x65F6;&#x83B7;&#x53D6;</p>
</li>
<li><p>&#x907F;&#x514D;&#x6B7B;&#x9501;&#xFF1A;&#x8FD9;&#x628A;&#x9501;&#x5728;&#x4E00;&#x6BB5;&#x6709;&#x9650;&#x7684;&#x65F6;&#x95F4;&#x4E4B;&#x540E;&#xFF0C;&#x4E00;&#x5B9A;&#x4F1A;&#x88AB;&#x91CA;&#x653E;&#xFF08;&#x6B63;&#x5E38;&#x91CA;&#x653E;&#x6216;&#x5F02;&#x5E38;&#x91CA;&#x653E;&#xFF09;</p>
</li>
<li><p>&#x9AD8;&#x53EF;&#x7528;&#xFF1A;&#x83B7;&#x53D6;&#x6216;&#x91CA;&#x653E;&#x9501;&#x7684;&#x673A;&#x5236;&#x5FC5;&#x987B;&#x9AD8;&#x53EF;&#x7528;&#x4E14;&#x6027;&#x80FD;&#x4F73;</p>
</li>
</ul>
<h3 id="&#x5206;&#x5E03;&#x5F0F;&#x9501;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;">&#x5206;&#x5E03;&#x5F0F;&#x9501;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;</h3>
<ol>
<li><p>&#x57FA;&#x4E8E;&#x6570;&#x636E;&#x5E93;&#x5B9E;&#x73B0;</p>
</li>
<li><p>&#x57FA;&#x4E8E;&#x7F13;&#x5B58;</p>
</li>
<li><p>&#x57FA;&#x4E8E;ZooKeeper&#x5B9E;&#x73B0;</p>
</li>
</ol>
<h2 id="&#x5171;&#x4EAB;&#x9501;&#x8BFB;&#x9501;-&#x548C;-&#x6392;&#x5B83;&#x9501;&#x5199;&#x9501;">&#x5171;&#x4EAB;&#x9501;(&#x8BFB;&#x9501;) &#x548C; &#x6392;&#x5B83;&#x9501;(&#x5199;&#x9501;)</h2>
<h3 id="exclusive-locks">Exclusive locks</h3>
<p>Exclusive locks protect updates to file resources, both recoverable and non-recoverable. They can be owned by only one transaction at a time. Any transaction that requires an exclusive lock must wait if another task currently owns an exclusive lock or a shared lock against the requested resource.</p>
<p>&#x72EC;&#x5360;&#x9501;&#x4FDD;&#x62A4;&#x6587;&#x4EF6;&#x8D44;&#x6E90;(&#x5305;&#x62EC;&#x53EF;&#x6062;&#x590D;&#x548C;&#x4E0D;&#x53EF;&#x6062;&#x590D;&#x7684;&#x6587;&#x4EF6;&#x8D44;&#x6E90;)&#x7684;&#x66F4;&#x65B0;&#x3002;&#x5B83;&#x4EEC;&#x4E00;&#x6B21;&#x53EA;&#x80FD;&#x7531;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x62E5;&#x6709;&#x3002;&#x5982;&#x679C;&#x53E6;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x5F53;&#x524D;&#x62E5;&#x6709;&#x5BF9;&#x6240;&#x8BF7;&#x6C42;&#x8D44;&#x6E90;&#x7684;&#x72EC;&#x5360;&#x9501;&#x6216;&#x5171;&#x4EAB;&#x9501;&#xFF0C;&#x5219;&#x4EFB;&#x4F55;&#x9700;&#x8981;&#x5BF9;&#x8BE5;&#x8D44;&#x6E90;&#x7533;&#x8BF7;&#x72EC;&#x5360;&#x9501;&#x7684;&#x4E8B;&#x52A1;&#x90FD;&#x5FC5;&#x987B;&#x7B49;&#x5F85;&#x3002;</p>
<h3 id="shared-locks">Shared locks</h3>
<p>Shared locks support read integrity. They ensure that a record is not in the process of being updated during a read-only request. Shared locks can also be used to prevent updates of a record between the time that a record is read and the next syncpoint.</p>
<p>&#x5171;&#x4EAB;&#x9501;&#x652F;&#x6301;&#x8BFB;&#x5B8C;&#x6574;&#x6027;&#x3002;&#x5B83;&#x4EEC;&#x786E;&#x4FDD;&#x5728;&#x53EA;&#x8BFB;&#x8BF7;&#x6C42;&#x671F;&#x95F4;&#x4E0D;&#x4F1A;&#x66F4;&#x65B0;&#x8BB0;&#x5F55;&#x3002;&#x5171;&#x4EAB;&#x9501;&#x8FD8;&#x53EF;&#x7528;&#x4E8E;&#x9632;&#x6B62;&#x5728;&#x8BFB;&#x53D6;&#x8BB0;&#x5F55;&#x548C;&#x4E0B;&#x4E00;&#x4E2A;&#x540C;&#x6B65;&#x70B9;&#x4E4B;&#x95F4;&#x8FDB;&#x884C;&#x66F4;&#x65B0;&#x64CD;&#x4F5C;&#x3002;</p>
<p>A shared lock on a resource can be owned by several tasks at the same time. However, although several tasks can own shared locks, there are some circumstances in which tasks can be forced to wait for a lock:</p>
<p>&#x8D44;&#x6E90;&#x4E0A;&#x7684;&#x5171;&#x4EAB;&#x9501;&#x53EF;&#x4EE5;&#x540C;&#x65F6;&#x7531;&#x591A;&#x4E2A;&#x4EFB;&#x52A1;&#x62E5;&#x6709;&#x3002; &#x4F46;&#x662F;&#xFF0C;&#x5C3D;&#x7BA1;&#x6709;&#x51E0;&#x4E2A;&#x4EFB;&#x52A1;&#x53EF;&#x4EE5;&#x62E5;&#x6709;&#x5171;&#x4EAB;&#x9501;&#xFF0C;&#x4F46;&#x5728;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#x53EF;&#x4EE5;&#x5F3A;&#x5236;&#x4EFB;&#x52A1;&#x7B49;&#x5F85;&#x9501;&#xFF1A;</p>
<ul>
<li>A request for a shared lock must wait if another task currently owns an exclusive lock on the resource.</li>
<li>A request for an exclusive lock must wait if other tasks currently own shared locks on this resource.</li>
<li>A new request for a shared lock must wait if another task is waiting for an exclusive lock on a resource that already has a shared lock.</li>
</ul>
<p>&#x5373;&#xFF1A;</p>
<ul>
<li>&#x5982;&#x679C;&#x53E6;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x5F53;&#x524D;&#x62E5;&#x6709;&#x8D44;&#x6E90;&#x4E0A;&#x7684;&#x72EC;&#x5360;&#x9501;&#xFF0C;&#x5219;&#x5BF9;&#x5171;&#x4EAB;&#x9501;&#x7684;&#x8BF7;&#x6C42;&#x5FC5;&#x987B;&#x7B49;&#x5F85;&#x3002;</li>
<li>&#x5982;&#x679C;&#x5176;&#x4ED6;&#x4EFB;&#x52A1;&#x5F53;&#x524D;&#x62E5;&#x6709;&#x6B64;&#x8D44;&#x6E90;&#x4E0A;&#x7684;&#x5171;&#x4EAB;&#x9501;&#xFF0C;&#x5219;&#x5FC5;&#x987B;&#x7B49;&#x5F85;&#x5BF9;&#x72EC;&#x5360;&#x9501;&#x7684;&#x8BF7;&#x6C42;&#x3002;</li>
<li>&#x5982;&#x679C;&#x53E6;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x6B63;&#x5728;&#x7B49;&#x5F85;&#x5DF2;&#x7ECF;&#x5177;&#x6709;&#x5171;&#x4EAB;&#x9501;&#x7684;&#x8D44;&#x6E90;&#x7684;&#x72EC;&#x5360;&#x9501;&#xFF0C;&#x5219;&#x5BF9;&#x5171;&#x4EAB;&#x9501;&#x7684;&#x65B0;&#x8BF7;&#x6C42;&#x5FC5;&#x987B;&#x7B49;&#x5F85;&#x3002;</li>
</ul>
<h2 id="&#x504F;&#x5411;&#x9501;&#xFF08;biased-locking&#xFF09;">&#x504F;&#x5411;&#x9501;&#xFF08;Biased Locking&#xFF09;</h2>
<p>&#x9501;&#x7684;&#x5B9E;&#x73B0;&#x673A;&#x5236;&#x4E0E;Java&#x5BF9;&#x8C61;&#x5934;&#x606F;&#x606F;&#x76F8;&#x5173;&#xFF0C;<strong>&#x9501;&#x7684;&#x6240;&#x6709;&#x4FE1;&#x606F;&#xFF0C;&#x90FD;&#x8BB0;&#x5F55;&#x5728;Java&#x7684;&#x5BF9;&#x8C61;&#x5934;&#x4E2D;</strong>&#x3002;</p>
<p>&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x9501;&#x4E0D;&#x4EC5;<strong>&#x4E0D;&#x5B58;&#x5728;&#x591A;&#x7EBF;&#x7A0B;&#x7ADE;&#x4E89;</strong>&#xFF0C;&#x800C;&#x4E14;<strong>&#x603B;&#x662F;&#x7531;&#x540C;&#x4E00;&#x7EBF;&#x7A0B;&#x591A;&#x6B21;&#x83B7;&#x5F97;</strong>&#xFF0C;&#x8FD9;&#x4E2A;&#x7EBF;&#x7A0B;&#x5C31;&#x662F;&#x9501;&#x7684;&#x504F;&#x5411;&#x7EBF;&#x7A0B;&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x8BA9;&#x7EBF;&#x7A0B;&#x83B7;&#x5F97;&#x9501;&#x7684;&#x4EE3;&#x4EF7;&#x66F4;&#x4F4E;&#x800C;&#x5F15;&#x5165;&#x504F;&#x5411;&#x9501;&#x3002;&#x90A3;&#x4E48;&#x53EA;&#x9700;&#x8981;<strong>&#x5728;&#x9501;&#x7B2C;&#x4E00;&#x6B21;&#x88AB;&#x62E5;&#x6709;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8BB0;&#x5F55;&#x4E0B;&#x504F;&#x5411;&#x7EBF;&#x7A0B;ID&#x3002;&#x8FD9;&#x6837;&#x504F;&#x5411;&#x7EBF;&#x7A0B;&#x5C31;&#x4E00;&#x76F4;&#x6301;&#x6709;&#x7740;&#x9501;&#xFF0C;&#x76F4;&#x5230;&#x7ADE;&#x4E89;&#x53D1;&#x751F;&#x624D;&#x91CA;&#x653E;&#x9501;</strong>&#x3002;&#x4EE5;&#x540E;&#x6BCF;&#x6B21;&#x540C;&#x6B65;&#xFF0C;&#x68C0;&#x67E5;&#x9501;&#x7684;&#x504F;&#x5411;&#x7EBF;&#x7A0B;ID&#x4E0E;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;ID&#x662F;&#x5426;&#x4E00;&#x81F4;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x81F4;&#x5219;&#x76F4;&#x63A5;&#x8FDB;&#x5165;&#x540C;&#x6B65;/&#x9000;&#x51FA;&#x540C;&#x6B65;;<strong>&#x65E0;&#x9700;&#x6BCF;&#x6B21;&#x52A0;&#x9501;/&#x89E3;&#x9501;</strong>&#x90FD;&#x53BB;CAS&#x66F4;&#x65B0;&#x5BF9;&#x8C61;&#x5934;&#xFF1B;&#x5982;&#x679C;&#x4E0D;&#x4E00;&#x81F4;&#x610F;&#x5473;&#x7740;&#x53D1;&#x751F;&#x4E86;&#x7ADE;&#x4E89;&#xFF0C;&#x9501;&#x5DF2;&#x7ECF;&#x4E0D;&#x662F;&#x603B;&#x662F;&#x504F;&#x5411;&#x4E8E;&#x540C;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x4E86;&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#x9700;&#x8981;&#x9501;&#x81A8;&#x80C0;&#x4E3A;&#x8F7B;&#x91CF;&#x7EA7;&#x9501;&#xFF0C;&#x624D;&#x80FD;&#x4FDD;&#x8BC1;&#x7EBF;&#x7A0B;&#x95F4;&#x516C;&#x5E73;&#x7ADE;&#x4E89;&#x9501;&#x3002;</p>
<h2 id="&#x8F7B;&#x91CF;&#x7EA7;&#x9501;">&#x8F7B;&#x91CF;&#x7EA7;&#x9501;</h2>
<p>&#x8F7B;&#x91CF;&#x7EA7;&#x9501;&#x662F;&#x7531;&#x504F;&#x5411;&#x9501;&#x5347;&#x7EA7;&#x6765;&#x7684;&#xFF0C;&#x504F;&#x5411;&#x9501;&#x8FD0;&#x884C;&#x5728;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x8FDB;&#x5165;&#x540C;&#x6B65;&#x5757;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5F53;&#x7B2C;&#x4E8C;&#x4E2A;&#x7EBF;&#x7A0B;&#x52A0;&#x5165;&#x9501;&#x7ADE;&#x4E89;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x504F;&#x5411;&#x9501;&#x5C31;&#x4F1A;&#x5347;&#x7EA7;&#x4E3A;&#x8F7B;&#x91CF;&#x7EA7;&#x9501;&#x3002;&#xFF08;&#x8F7B;&#x91CF;&#x7EA7;&#x9501;&#x662F;&#x7528;&#x6237;&#x6001;&#x7684;&#xFF0C;&#x901A;&#x5E38;&#x4F1A;&#x81EA;&#x65CB;&#x5360;&#x7528;CPU&#xFF09;</p>
<p>&#x8F7B;&#x91CF;&#x9501;&#x4E0E;&#x504F;&#x5411;&#x9501;&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF1A;</p>
<pre class="language-"><code>1. &#x8F7B;&#x91CF;&#x7EA7;&#x9501;&#x6BCF;&#x6B21;&#x9000;&#x51FA;&#x540C;&#x6B65;&#x5757;&#x90FD;&#x9700;&#x8981;&#x91CA;&#x653E;&#x9501;&#xFF0C;&#x800C;&#x504F;&#x5411;&#x9501;&#x662F;&#x5728;&#x7ADE;&#x4E89;&#x53D1;&#x751F;&#x65F6;&#x624D;&#x91CA;&#x653E;&#x9501;
2. &#x6BCF;&#x6B21;&#x8FDB;&#x5165;/&#x9000;&#x51FA;&#x540C;&#x6B65;&#x5757;&#x90FD;&#x9700;&#x8981;CAS&#x66F4;&#x65B0;&#x5BF9;&#x8C61;&#x5934;
3. &#x4E89;&#x593A;&#x8F7B;&#x91CF;&#x7EA7;&#x9501;&#x5931;&#x8D25;&#x65F6;&#xFF0C;&#x81EA;&#x65CB;&#x5C1D;&#x8BD5;&#x62A2;&#x5360;&#x9501;
</code></pre><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8F7B;&#x91CF;&#x9501;&#x9002;&#x5408;&#x5728;&#x7ADE;&#x4E89;&#x60C5;&#x51B5;&#x4E0B;&#x4F7F;&#x7528;&#xFF0C;&#x5176;&#x81EA;&#x65CB;&#x9501;&#x53EF;&#x4EE5;&#x4FDD;&#x8BC1;&#x54CD;&#x5E94;&#x901F;&#x5EA6;&#x5FEB;&#xFF0C;&#x4F46;&#x81EA;&#x65CB;&#x64CD;&#x4F5C;&#x4F1A;&#x5360;&#x7528;CPU&#xFF0C;&#x6240;&#x4EE5;&#x4E00;&#x4E9B;&#x8BA1;&#x7B97;&#x65F6;&#x95F4;&#x957F;&#x7684;&#x64CD;&#x4F5C;&#x4E0D;&#x9002;&#x5408;&#x4F7F;&#x7528;&#x8F7B;&#x91CF;&#x7EA7;&#x9501;&#x3002;&#x5F53;&#x7ADE;&#x4E89;&#x7EBF;&#x7A0B;&#x5C1D;&#x8BD5;&#x5360;&#x7528;&#x8F7B;&#x91CF;&#x7EA7;&#x9501;&#x5931;&#x8D25;&#x591A;&#x6B21;&#x4E4B;&#x540E;&#xFF0C;&#x8F7B;&#x91CF;&#x7EA7;&#x9501;&#x5C31;&#x4F1A;&#x81A8;&#x80C0;&#x4E3A;&#x91CD;&#x91CF;&#x7EA7;&#x9501;&#xFF0C;&#x91CD;&#x91CF;&#x7EA7;&#x7EBF;&#x7A0B;&#x6307;&#x9488;&#x6307;&#x5411;&#x7ADE;&#x4E89;&#x7EBF;&#x7A0B;&#xFF0C;&#x7ADE;&#x4E89;&#x7EBF;&#x7A0B;&#x4E5F;&#x4F1A;&#x963B;&#x585E;&#xFF0C;&#x7B49;&#x5F85;&#x8F7B;&#x91CF;&#x7EA7;&#x7EBF;&#x7A0B;&#x91CA;&#x653E;&#x9501;&#x540E;&#x5524;&#x9192;&#x4ED6;&#x3002;</p>
<h2 id="&#x91CD;&#x91CF;&#x7EA7;&#x9501;&#xFF08;&#x5185;&#x6838;&#x63A7;&#x5236;&#xFF09;">&#x91CD;&#x91CF;&#x7EA7;&#x9501;&#xFF08;&#x5185;&#x6838;&#x63A7;&#x5236;&#xFF09;</h2>
<p>&#x5F53;&#x7ADE;&#x4E89;&#x7EBF;&#x7A0B;&#x5C1D;&#x8BD5;&#x5360;&#x7528;&#x8F7B;&#x91CF;&#x7EA7;&#x9501;&#x5931;&#x8D25;&#x591A;&#x6B21;&#x4E4B;&#x540E;&#xFF0C;&#x8F7B;&#x91CF;&#x7EA7;&#x9501;&#x5C31;&#x4F1A;&#x81A8;&#x80C0;&#x4E3A;&#x91CD;&#x91CF;&#x7EA7;&#x9501;&#xFF0C;&#x91CD;&#x91CF;&#x7EA7;&#x7EBF;&#x7A0B;&#x6307;&#x9488;&#x6307;&#x5411;&#x7ADE;&#x4E89;&#x7EBF;&#x7A0B;&#xFF0C;&#x7ADE;&#x4E89;&#x7EBF;&#x7A0B;&#x4E5F;&#x4F1A;&#x963B;&#x585E;&#xFF0C;&#x7B49;&#x5F85;&#x8F7B;&#x91CF;&#x7EA7;&#x7EBF;&#x7A0B;&#x91CA;&#x653E;&#x9501;&#x540E;&#x5524;&#x9192;&#x4ED6;&#x3002;</p>
<p>&#x91CD;&#x91CF;&#x7EA7;&#x9501;&#x662F;&#x4F9D;&#x8D56;&#x5BF9;&#x8C61;&#x5185;&#x90E8;&#x7684;monitor&#x9501;&#x6765;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x800C;monitor&#x53C8;&#x4F9D;&#x8D56;<strong>&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;MutexLock(&#x4E92;&#x65A5;&#x9501;)</strong>&#x6765;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x91CD;&#x91CF;&#x7EA7;&#x9501;&#x4E5F;&#x88AB;&#x6210;&#x4E3A;&#x4E92;&#x65A5;&#x9501;&#x3002;&#xFF08;&#x5E26;wait&#x961F;&#x5217;&#xFF0C;&#x628A;&#x6CA1;&#x6709;&#x83B7;&#x53D6;&#x9501;&#x7684;&#x7EBF;&#x7A0B;&#x653E;&#x961F;&#x5217;&#xFF0C;&#x51B7;&#x51BB;&#x7740;&#xFF0C;&#x4E0D;&#x5360;&#x7528;CPU&#xFF1B;&#x5185;&#x6838;&#x8BA9;&#x6267;&#x884C;&#x4E86;&#xFF0C;&#x7528;&#x6237;&#x6001;/&#x5185;&#x6838;&#x6001;&#x5207;&#x6362;&#xFF0C;&#x7136;&#x540E;&#x6267;&#x884C;&#xFF09;</p>
<h3 id="&#x4E3A;&#x4EC0;&#x4E48;&#x8BF4;&#x91CD;&#x91CF;&#x7EA7;&#x9501;&#x5F00;&#x9500;&#x5927;&#x5462;&#xFF1F;">&#x4E3A;&#x4EC0;&#x4E48;&#x8BF4;&#x91CD;&#x91CF;&#x7EA7;&#x9501;&#x5F00;&#x9500;&#x5927;&#x5462;&#xFF1F;</h3>
<p>&#x4E3B;&#x8981;&#x662F;&#xFF1A;&#x5F53;&#x7CFB;&#x7EDF;&#x68C0;&#x67E5;&#x5230;&#x9501;&#x662F;&#x91CD;&#x91CF;&#x7EA7;&#x9501;&#x4E4B;&#x540E;&#xFF0C;&#x4F1A;&#x628A;&#x7B49;&#x5F85;&#x60F3;&#x8981;&#x83B7;&#x5F97;&#x9501;&#x7684;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#x963B;&#x585E;&#xFF0C;&#x88AB;<strong>&#x963B;&#x585E;&#x7684;&#x7EBF;&#x7A0B;&#x4E0D;&#x4F1A;&#x6D88;&#x8017;cpu</strong>&#x3002;&#x4F46;&#x662F;&#x963B;&#x585E;&#x6216;&#x8005;&#x5524;&#x9192;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x65F6;&#xFF0C;&#x90FD;&#x9700;&#x8981;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x6765;&#x5E2E;&#x5FD9;&#xFF0C;&#x8FD9;&#x9700;&#x8981;&#x628A;&#x7EBF;&#x7A0B;&#x4ECE;<strong>&#x7528;&#x6237;&#x6001;</strong>&#x8F6C;&#x6362;&#x5230;<strong>&#x5185;&#x6838;&#x6001;</strong>&#xFF0C;&#x800C;&#x8F6C;&#x6362;&#x72B6;&#x6001;&#x662F;&#x9700;&#x8981;&#x6D88;&#x8017;&#x5F88;&#x591A;&#x65F6;&#x95F4;&#x7684;&#xFF0C;&#x6709;&#x53EF;&#x80FD;&#x6BD4;&#x7528;&#x6237;&#x6267;&#x884C;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x95F4;&#x8FD8;&#x8981;&#x957F;&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x8BF4;&#x4E3A;&#x4EC0;&#x4E48;&#x91CD;&#x91CF;&#x7EA7;&#x7EBF;&#x7A0B;&#x5F00;&#x9500;&#x5F88;&#x5927;&#x7684;&#x3002;</p>
<h2 id="aqs">AQS</h2>
<p><code>AbstractQuenedSynchronizer</code>&#x62BD;&#x8C61;&#x7684;&#x961F;&#x5217;&#x5F0F;&#x540C;&#x6B65;&#x5668;,&#x662F;&#x9664;&#x4E86;Java&#x81EA;&#x5E26;&#x7684;<code>synchronized</code>&#x5173;&#x952E;&#x5B57;&#x4E4B;&#x5916;&#x7684;&#x9501;&#x673A;&#x5236;</p>
<p>AQS&#x6280;&#x672F;&#x6808;&#xFF1A;&#x81EA;&#x65CB;&#xFF0C;park/unpark&#xFF0C;CAS</p>
<table>
<thead>
<tr>
<th>&#x540C;&#x6B65;&#x5DE5;&#x5177;</th>
<th>&#x540C;&#x6B65;&#x5DE5;&#x5177;&#x4E0E;AQS&#x7684;&#x5173;&#x8054;</th>
</tr>
</thead>
<tbody>
<tr>
<td>ReentrantLock</td>
<td>&#x4F7F;&#x7528;AQS&#x4FDD;&#x5B58;&#x9501;&#x91CD;&#x590D;&#x6301;&#x6709;&#x7684;&#x6B21;&#x6570;&#x3002;&#x5F53;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x83B7;&#x53D6;&#x9501;&#x65F6;&#xFF0C;ReentrantLock&#x8BB0;&#x5F55;&#x5F53;&#x524D;&#x83B7;&#x5F97;&#x9501;&#x7684;&#x7EBF;&#x7A0B;&#x6807;&#x8BC6;&#xFF0C;&#x7528;&#x4E8E;&#x68C0;&#x6D4B;&#x662F;&#x5426;&#x91CD;&#x590D;&#x83B7;&#x53D6;&#xFF0C;&#x4EE5;&#x53CA;&#x9519;&#x8BEF;&#x7EBF;&#x7A0B;&#x8BD5;&#x56FE;&#x89E3;&#x9501;&#x64CD;&#x4F5C;&#x65F6;&#x5F02;&#x5E38;&#x60C5;&#x51B5;&#x7684;&#x5904;&#x7406;&#x3002;</td>
</tr>
<tr>
<td>Semaphore</td>
<td>&#x4F7F;&#x7528;AQS&#x540C;&#x6B65;&#x72B6;&#x6001;&#x6765;&#x4FDD;&#x5B58;&#x4FE1;&#x53F7;&#x91CF;&#x7684;&#x5F53;&#x524D;&#x8BA1;&#x6570;&#x3002;tryRelease&#x4F1A;&#x589E;&#x52A0;&#x8BA1;&#x6570;&#xFF0C;acquireShared&#x4F1A;&#x51CF;&#x5C11;&#x8BA1;&#x6570;&#x3002;</td>
</tr>
<tr>
<td>CountDownLatch</td>
<td>&#x4F7F;&#x7528;AQS&#x540C;&#x6B65;&#x72B6;&#x6001;&#x6765;&#x8868;&#x793A;&#x8BA1;&#x6570;&#x3002;&#x8BA1;&#x6570;&#x4E3A;0&#x65F6;&#xFF0C;&#x6240;&#x6709;&#x7684;Acquire&#x64CD;&#x4F5C;&#xFF08;CountDownLatch&#x7684;await&#x65B9;&#x6CD5;&#xFF09;&#x624D;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x3002;</td>
</tr>
<tr>
<td>ReentrantReadWriteLock</td>
<td>&#x4F7F;&#x7528;AQS&#x540C;&#x6B65;&#x72B6;&#x6001;&#x4E2D;&#x7684;16&#x4F4D;&#x4FDD;&#x5B58;&#x5199;&#x9501;&#x6301;&#x6709;&#x7684;&#x6B21;&#x6570;&#xFF0C;&#x5269;&#x4E0B;&#x7684;16&#x4F4D;&#x7528;&#x4E8E;&#x4FDD;&#x5B58;&#x8BFB;&#x9501;&#x7684;&#x6301;&#x6709;&#x6B21;&#x6570;&#x3002;</td>
</tr>
<tr>
<td>ThreadPoolExecutor</td>
<td>Worker&#x5229;&#x7528;AQS&#x540C;&#x6B65;&#x72B6;&#x6001;&#x5B9E;&#x73B0;&#x5BF9;&#x72EC;&#x5360;&#x7EBF;&#x7A0B;&#x53D8;&#x91CF;&#x7684;&#x8BBE;&#x7F6E;&#xFF08;tryAcquire&#x548C;tryRelease&#xFF09;&#x3002;</td>
</tr>
</tbody>
</table>
<p><footer class="page-footer"><span class="copyright">Copyright @doctording all right reserved&#xFF0C;powered by Gitbook</span><span class="footer-modification">&#x8BE5;&#x6587;&#x4EF6;&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;
2021-01-05 23:48:42
</span></footer><div id="gitalk-container"></div><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://cdn.bootcss.com/blueimp-md5/2.12.0/js/md5.min.js"></script><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="linux_lock.html" class="navigation navigation-prev " aria-label="Previous page: Linux spin lock & mutex">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="thread_deadlock.html" class="navigation navigation-next " aria-label="Next page: 死锁问题">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Java Lock","layout":"page","date":"2019-03-15 00:00","level":"1.11.8","depth":2,"next":{"title":"死锁问题","level":"1.11.9","depth":2,"path":"content/java_thread_concurrent/thread_deadlock.md","ref":"./content/java_thread_concurrent/thread_deadlock.md","articles":[]},"previous":{"title":"Linux spin lock & mutex","level":"1.11.7","depth":2,"path":"content/java_thread_concurrent/linux_lock.md","ref":"./content/java_thread_concurrent/linux_lock.md","articles":[]},"dir":"ltr"},"config":{"plugins":["prism","-highlight","-lunr","-search","-sharing","ace","codeblock-filename","search-plus","sectionx","splitter","tbfed-pagefooter","expandable-chapters","back-to-top-button","code","copy-code-button","uml","page-treeview","gittalk","advanced-emoji","todo","github"],"styles":{"website":"styles/website.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright @doctording","modify_label":"该文件修改时间：","modify_format":"YYYY-MM-DD HH:mm:ss"},"page-treeview":{"collapsed":false,"copyright":"Copyright @doctording","minHeaderCount":"2","minHeaderDeep":"2"},"prism":{},"ace":{},"github":{"url":"https://github.com/doctording"},"todo":{},"splitter":{},"code":{"copyButtons":true},"fontsettings":{"theme":"white","family":"sans","size":2},"sectionx":{},"uml":{"format":"svg"},"codeblock-filename":{},"back-to-top-button":{},"copy-code-button":{},"advanced-emoji":{"embedEmojis":false},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"gittalk":{"clientID":"094729e19245d3fe84aa","clientSecret":"6c4cf7b48e7ae41c20d453c24eb9d5469e4d19fb","repo":"sword_at_offer","owner":"doctording","admin":["doctording"],"distractionFreeMode":false},"expandable-chapters":{},"search-plus":{}},"theme":"default","author":"doctording","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"java-note","language":"zh-hans","gitbook":"*","description":"Java开发"},"file":{"path":"content/java_thread_concurrent/thread_lock.md","mtime":"2021-01-05T15:48:42.658Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-10-21T13:29:18.172Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-ace/ace/ace.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-ace/ace.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sectionx/sectionx.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-gittalk/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

