
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>AQS · java-note</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="doctording">
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-prism/prism.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-ace/ace.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-codeblock-filename/block.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-sectionx/sectionx.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-page-treeview/style.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../../styles/website.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="cas.html" />
    
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    [计算机组成]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../computer/cpu_cache.html">
            
                <a href="../computer/cpu_cache.html">
            
                    
                    CPU,缓存
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../computer/process_thread.html">
            
                <a href="../computer/process_thread.html">
            
                    
                    进程和线程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../computer/mem_management.html">
            
                <a href="../computer/mem_management.html">
            
                    
                    内存管理
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    [I/O & 网络]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../java_io_net/io_interrupte.html">
            
                <a href="../java_io_net/io_interrupte.html">
            
                    
                    IO和中断
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" >
            
                <span>
            
                    
                    [IO基础]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="../java_io_net/io_basic.html">
            
                <a href="../java_io_net/io_basic.html">
            
                    
                    Java IO基础
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1.1" data-path="../java_io_net/io_basic_pro.html">
            
                <a href="../java_io_net/io_basic_pro.html">
            
                    
                    Java IO面试题
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="../java_io_net/nio_basic.html">
            
                <a href="../java_io_net/nio_basic.html">
            
                    
                    BIO到NIO
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3" data-path="../java_io_net/from_io_to_epoll.html">
            
                <a href="../java_io_net/from_io_to_epoll.html">
            
                    
                    再谈select & epoll
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.4" data-path="../java_io_net/server_socket_channel.html">
            
                <a href="../java_io_net/server_socket_channel.html">
            
                    
                    ServerSocketChannel
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../distributed_design/design.html">
            
                <a href="../distributed_design/design.html">
            
                    
                    网络设计模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../java_io_net/http_tcp.html">
            
                <a href="../java_io_net/http_tcp.html">
            
                    
                    http & tcp
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.4.1" data-path="../java_io_net/http_tcp_pro.html">
            
                <a href="../java_io_net/http_tcp_pro.html">
            
                    
                    http & tcp面试题
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../distributed_design/nginx.html">
            
                <a href="../distributed_design/nginx.html">
            
                    
                    nginx基础
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    [数据库]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../db_cache/io.html">
            
                <a href="../db_cache/io.html">
            
                    
                    局部性原理&磁盘IO
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../db_cache/mysql.html">
            
                <a href="../db_cache/mysql.html">
            
                    
                    MySQL
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    [分布式]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../distributed_design/distribute.html">
            
                <a href="../distributed_design/distribute.html">
            
                    
                    分布式基础
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1" data-path="../distributed_design/distribute_tx.html">
            
                <a href="../distributed_design/distribute_tx.html">
            
                    
                    分布式事务
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.2" data-path="../distributed_design/distribute_lock.html">
            
                <a href="../distributed_design/distribute_lock.html">
            
                    
                    分布式锁
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.3" data-path="../distributed_design/distribute_id.html">
            
                <a href="../distributed_design/distribute_id.html">
            
                    
                    分布式ID
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../distributed_design/rpc.html">
            
                <a href="../distributed_design/rpc.html">
            
                    
                    rpc
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../distributed_design/zk.html">
            
                <a href="../distributed_design/zk.html">
            
                    
                    zookeeper
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../distributed_design/soa.html">
            
                <a href="../distributed_design/soa.html">
            
                    
                    微服务
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    [缓存 & 限流]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../db_cache/LFU.html">
            
                <a href="../db_cache/LFU.html">
            
                    
                    LFU
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../db_cache/LRU.html">
            
                <a href="../db_cache/LRU.html">
            
                    
                    LRU
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../db_cache/consistent_hash.html">
            
                <a href="../db_cache/consistent_hash.html">
            
                    
                    一致性Hash
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../db_cache/bloom.html">
            
                <a href="../db_cache/bloom.html">
            
                    
                    布隆过滤器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../db_cache/cache.html">
            
                <a href="../db_cache/cache.html">
            
                    
                    缓存
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../distributed_design/flow_limit.html">
            
                <a href="../distributed_design/flow_limit.html">
            
                    
                    限流
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                    [常见设计模式]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../design_pattern/proxy.html">
            
                <a href="../design_pattern/proxy.html">
            
                    
                    代理模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../design_pattern/singleton.html">
            
                <a href="../design_pattern/singleton.html">
            
                    
                    单例模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../design_pattern/factory.html">
            
                <a href="../design_pattern/factory.html">
            
                    
                    工厂模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../design_pattern/template.html">
            
                <a href="../design_pattern/template.html">
            
                    
                    模板方法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../design_pattern/strategy.html">
            
                <a href="../design_pattern/strategy.html">
            
                    
                    策略模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="../design_pattern/decorator.html">
            
                <a href="../design_pattern/decorator.html">
            
                    
                    装饰器模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7" data-path="../design_pattern/observer.html">
            
                <a href="../design_pattern/observer.html">
            
                    
                    观察者模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8" data-path="../design_pattern/visitor.html">
            
                <a href="../design_pattern/visitor.html">
            
                    
                    访问者模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.9" data-path="../design_pattern/iterator.html">
            
                <a href="../design_pattern/iterator.html">
            
                    
                    迭代器模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.10" data-path="../design_pattern/facade.html">
            
                <a href="../design_pattern/facade.html">
            
                    
                    门面模式
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                    [数据结构和算法基础]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../java_data_structure/java_basic_datastructure.html">
            
                <a href="../java_data_structure/java_basic_datastructure.html">
            
                    
                    常见基础数据结构
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1.1" data-path="../java_data_structure/array_list.html">
            
                <a href="../java_data_structure/array_list.html">
            
                    
                    ArrayList & LinkedList & Vector
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.2" data-path="../java_data_structure/hash_map.html">
            
                <a href="../java_data_structure/hash_map.html">
            
                    
                    HashMap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.3" data-path="../java_data_structure/hash_table.html">
            
                <a href="../java_data_structure/hash_table.html">
            
                    
                    HashTable
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.4" data-path="../java_data_structure/linked_hash_map.html">
            
                <a href="../java_data_structure/linked_hash_map.html">
            
                    
                    LinkedHashMap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.5" data-path="../java_data_structure/tree_map.html">
            
                <a href="../java_data_structure/tree_map.html">
            
                    
                    TreeMap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.6" data-path="../java_data_structure/fail_fast.html">
            
                <a href="../java_data_structure/fail_fast.html">
            
                    
                    fail-fast,ConcurrentModificationException
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.7" data-path="../java_utils/quick_sort.html">
            
                <a href="../java_utils/quick_sort.html">
            
                    
                    快排(没事手写写)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.8" data-path="../java_data_structure/concurrent_datastructure.html">
            
                <a href="../java_data_structure/concurrent_datastructure.html">
            
                    
                    concurrent数据结构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.9" data-path="../java_data_structure/Map.html">
            
                <a href="../java_data_structure/Map.html">
            
                    
                    HashMap,HashTable,ConcurrentHashMap 对比
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../java_data_structure/advanced_structure.html">
            
                <a href="../java_data_structure/advanced_structure.html">
            
                    
                    高级数据结构
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.2.1" data-path="../java_data_structure/b_tree.html">
            
                <a href="../java_data_structure/b_tree.html">
            
                    
                    B/B+ Tree
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" >
            
                <span>
            
                    
                    [Java基础问题]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../java_data_structure/System_arraycopy.html">
            
                <a href="../java_data_structure/System_arraycopy.html">
            
                    
                    System.arraycopy, Array.copyOf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../java_utils/equals_hashcode.html">
            
                <a href="../java_utils/equals_hashcode.html">
            
                    
                    == & equals方法 & hashcode方法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../java_utils/Calendar.html">
            
                <a href="../java_utils/Calendar.html">
            
                    
                    Calendar & Date
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="../java_utils/Compare.html">
            
                <a href="../java_utils/Compare.html">
            
                    
                    Comparison method violates its general contract
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="../java_utils/int_Integer.html">
            
                <a href="../java_utils/int_Integer.html">
            
                    
                    int(基本类型) & Integer(包装类类型)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="../java_utils/exception.html">
            
                <a href="../java_utils/exception.html">
            
                    
                    Java异常&错误
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="../java_utils/String.html">
            
                <a href="../java_utils/String.html">
            
                    
                    String,StringBuffer,StringBuilder
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.8" data-path="../java_utils/reflect.html">
            
                <a href="../java_utils/reflect.html">
            
                    
                    反射机制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.9" data-path="../java_utils/call_back.html">
            
                <a href="../java_utils/call_back.html">
            
                    
                    回调 & 事件机制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.10" data-path="../java_utils/array_collection.html">
            
                <a href="../java_utils/array_collection.html">
            
                    
                    数组，集合转换等问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.11" data-path="../java_utils/annotation.html">
            
                <a href="../java_utils/annotation.html">
            
                    
                    注解 Annotation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.12" data-path="../java_jvm/jvm_runtime.html">
            
                <a href="../java_jvm/jvm_runtime.html">
            
                    
                    Runtime类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.13" data-path="../java_data_structure/unsafe.html">
            
                <a href="../java_data_structure/unsafe.html">
            
                    
                    unsafe
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.14" data-path="../java_thinking_in_Java/basic.html">
            
                <a href="../java_thinking_in_Java/basic.html">
            
                    
                    《Java编程思想》第3章：操作符，第4章：控制执行流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.15" data-path="../java_thinking_in_Java/constructor.html">
            
                <a href="../java_thinking_in_Java/constructor.html">
            
                    
                    《Java编程思想》第5章：初始化和清理(重点)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.16" data-path="../java_thinking_in_Java/public_private_protect.html">
            
                <a href="../java_thinking_in_Java/public_private_protect.html">
            
                    
                    《Java编程思想》第6章：访问权限控制(重要)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.17" data-path="../java_thinking_in_Java/class_final.html">
            
                <a href="../java_thinking_in_Java/class_final.html">
            
                    
                    《Java编程思想》第7章：复用类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.18" data-path="../java_thinking_in_Java/polymorphism.html">
            
                <a href="../java_thinking_in_Java/polymorphism.html">
            
                    
                    《Java编程思想》第8章：多态
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.19" data-path="../java_thinking_in_Java/class_final.html">
            
                <a href="../java_thinking_in_Java/class_final.html">
            
                    
                    《Java编程思想》第9章：接口 补充：抽象类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.20" data-path="../java_thinking_in_Java/innner_class.html">
            
                <a href="../java_thinking_in_Java/innner_class.html">
            
                    
                    《Java编程思想》第10章：内部类
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" >
            
                <span>
            
                    
                    [Java多线程 & 并发基础]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.10.1" data-path="aqs.html">
            
                <a href="aqs.html">
            
                    
                    AQS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="cas.html">
            
                <a href="cas.html">
            
                    
                    CAS(Conmpare And Swap/Exchange) & unsafe
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="volatile.html">
            
                <a href="volatile.html">
            
                    
                    volatile 关键字
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="synchronized.html">
            
                <a href="synchronized.html">
            
                    
                    synchronized 关键字
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="thread_basic.html">
            
                <a href="thread_basic.html">
            
                    
                    线程基础
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.5.1" data-path="thread_condition.html">
            
                <a href="thread_condition.html">
            
                    
                    Condition
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5.2" data-path="semaphore.html">
            
                <a href="semaphore.html">
            
                    
                    Semaphore
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5.3" data-path="hook_thread.html">
            
                <a href="hook_thread.html">
            
                    
                    Hook线程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5.4" data-path="countdownlatch_cyclicBarrier.html">
            
                <a href="countdownlatch_cyclicBarrier.html">
            
                    
                    CountDownLatch & CyclicBarrier
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5.5" data-path="longAdder.html">
            
                <a href="longAdder.html">
            
                    
                    LongAdder
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5.6" data-path="thread_design.html">
            
                <a href="thread_design.html">
            
                    
                    多线程设计模式
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.6" >
            
                <span>
            
                    
                    [线程池]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.6.1" data-path="thread_pool.html">
            
                <a href="thread_pool.html">
            
                    
                    Java线程池
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.6.2" data-path="concurrency_problems.html">
            
                <a href="concurrency_problems.html">
            
                    
                    常见的多线程题目
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.6.3" data-path="thread_pool_self.html">
            
                <a href="thread_pool_self.html">
            
                    
                    自定义线程池
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.7" data-path="thread_lock.html">
            
                <a href="thread_lock.html">
            
                    
                    Java Lock
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8" data-path="thread_deadlock.html">
            
                <a href="thread_deadlock.html">
            
                    
                    死锁问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9" data-path="threadLocal.html">
            
                <a href="threadLocal.html">
            
                    
                    ThreadLocal对象
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" >
            
                <span>
            
                    
                    [Java8]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="../java8/java8_future.html">
            
                <a href="../java8/java8_future.html">
            
                    
                    Future
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2" data-path="../java8/java8_completableFuture.html">
            
                <a href="../java8/java8_completableFuture.html">
            
                    
                    CompletableFuture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.3" data-path="../java8/interface_default.html">
            
                <a href="../java8/interface_default.html">
            
                    
                    interface defalt static
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.4" data-path="../java8/java8_mem.html">
            
                <a href="../java8/java8_mem.html">
            
                    
                    Java8 jvm内存结构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.5" data-path="../java8/lambda.html">
            
                <a href="../java8/lambda.html">
            
                    
                    Java8 lambda表达式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.6" data-path="../java8/java8_optional.html">
            
                <a href="../java8/java8_optional.html">
            
                    
                    Java8 Optional
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.7" data-path="../java8/streams.html">
            
                <a href="../java8/streams.html">
            
                    
                    Java8 Streams
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.8" data-path="../java8/streams_parallel.html">
            
                <a href="../java8/streams_parallel.html">
            
                    
                    Java8 并行数据处理与性能
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" >
            
                <span>
            
                    
                    [JVM]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="../java_jvm/jvm_mem_model.html">
            
                <a href="../java_jvm/jvm_mem_model.html">
            
                    
                    内存模型与线程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="../java_jvm/jvm_class_load.html">
            
                <a href="../java_jvm/jvm_class_load.html">
            
                    
                    类加载机制,类加载器,内存布局
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3" data-path="../java_jvm/jvm_mem_gc.html">
            
                <a href="../java_jvm/jvm_mem_gc.html">
            
                    
                    堆栈 & 各种GC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.4" data-path="../java_jvm/jvm_params.html">
            
                <a href="../java_jvm/jvm_params.html">
            
                    
                    JVM参数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.5" data-path="../java_jvm/jvm_tools.html">
            
                <a href="../java_jvm/jvm_tools.html">
            
                    
                    JVM命令工具(jstack,jmap,jcmd...)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13" >
            
                <span>
            
                    
                    [系统设计]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1" data-path="../system_design/seckill.html">
            
                <a href="../system_design/seckill.html">
            
                    
                    秒杀系统
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14" >
            
                <span>
            
                    
                    [剑指Offer]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.1" data-path="../thought_of_solve/thought.html">
            
                <a href="../thought_of_solve/thought.html">
            
                    
                    剑指Offer解题思路(全)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >AQS</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div class="treeview__container"><div class="treeview__container-title"><span class="treeview__main-title">Treeview</span><span class="treeview__copyright">Copyright @doctording all right reserved, powered by <a href="https://github.com/aleen42" target="_blank">aleen42</a></span></div><ul>
<li><div><a href="#abstractqueuedsynchronizer">AbstractQueuedSynchronizer</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#aqs&#x6838;&#x5FC3;&#x601D;&#x60F3;&#x5F52;&#x7EB3;">Aqs&#x6838;&#x5FC3;&#x601D;&#x60F3;&#x5F52;&#x7EB3;</a><i></i></div></li>
<li><div><a href="#&#x540C;&#x6B65;&#x5668;">&#x540C;&#x6B65;&#x5668;</a><i></i></div></li>
<li><div><a href="#abstractqueuedsynchronizer-&#x76F8;&#x5173;&#x6982;&#x5FF5;">AbstractQueuedSynchronizer &#x76F8;&#x5173;&#x6982;&#x5FF5;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#&#x963B;&#x585E;">&#x963B;&#x585E;</a><i></i></div></li>
<li><div><a href="#&#x540C;&#x6B65;&#x64CD;&#x4F5C;">&#x540C;&#x6B65;&#x64CD;&#x4F5C;</a><i></i></div></li>
<li><div><a href="#fifo&#x961F;&#x5217;clh-&#x961F;&#x5217;&#xFF0C;&#x53CC;&#x5411;&#x94FE;&#x8868;">FIFO&#x961F;&#x5217;(CLH &#x961F;&#x5217;&#xFF0C;&#x53CC;&#x5411;&#x94FE;&#x8868;)</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#acquirequeued&#x65B9;&#x6CD5;&#x4E2D;&#x4F1A;&#x4F7F;&#x7EBF;&#x7A0B;&#x81EA;&#x65CB;&#x963B;&#x585E;&#xFF0C;&#x76F4;&#x5230;&#x83B7;&#x53D6;&#x5230;&#x9501;">acquireQueued&#x65B9;&#x6CD5;&#x4E2D;&#x4F1A;&#x4F7F;&#x7EBF;&#x7A0B;&#x81EA;&#x65CB;&#x963B;&#x585E;&#xFF0C;&#x76F4;&#x5230;&#x83B7;&#x53D6;&#x5230;&#x9501;</a><i></i></div></li>
<li><div><a href="#addwaiter&#x65B9;&#x6CD5;&#x4F1A;&#x5C06;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x5C01;&#x88C5;&#x6210;node&#x8282;&#x70B9;&#xFF0C;cas&#x64CD;&#x4F5C;&#x8FFD;&#x52A0;&#x5728;&#x961F;&#x5C3E;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;&#x8BE5;&#x8282;&#x70B9;">addWaiter&#x65B9;&#x6CD5;&#x4F1A;&#x5C06;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x5C01;&#x88C5;&#x6210;Node&#x8282;&#x70B9;&#xFF0C;CAS&#x64CD;&#x4F5C;&#x8FFD;&#x52A0;&#x5728;&#x961F;&#x5C3E;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;&#x8BE5;&#x8282;&#x70B9;</a><i></i></div></li>
</ul></li>
<li><div><a href="#&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;abstractqueuedsynchronizer&#x62BD;&#x8C61;&#x7C7B;&#x548C;lock&#x63A5;&#x53E3;">&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;AbstractQueuedSynchronizer&#x62BD;&#x8C61;&#x7C7B;&#x548C;Lock&#x63A5;&#x53E3;</a><i></i></div></li>
</ul></li>
</ul></li>
</ul>
</div>


<p>[TOC]</p>
<h1 id="abstractqueuedsynchronizer">AbstractQueuedSynchronizer</h1>
<ul>
<li>&#x9501;&#x7684;&#x5B9E;&#x73B0;&#x6846;&#x67B6;</li>
</ul>
<p>&#x53C2;&#x8003;&#xFF1A;<a href="https://tech.meituan.com/2019/12/05/aqs-theory-and-apply.html" target="_blank">&#x7F8E;&#x56E2;&#x6280;&#x672F;&#x6587;&#x7AE0;&#xFF1A;&#x4ECE;ReentrantLock&#x7684;&#x5B9E;&#x73B0;&#x770B;AQS&#x7684;&#x539F;&#x7406;&#x53CA;&#x5E94;&#x7528;</a></p>
<p>&#x53C2;&#x8003;&#xFF1A;<a href="https://www.cnblogs.com/dennyzhangdd/p/7218510.html" target="_blank">&#x300A;The java.util.concurrent Synchronizer Framework&#x300B; JUC&#x540C;&#x6B65;&#x5668;&#x6846;&#x67B6;&#xFF08;AQS&#x6846;&#x67B6;&#xFF09;&#x539F;&#x6587;&#x7FFB;&#x8BD1;</a></p>
<p><a href="http://gee.cs.oswego.edu/dl/papers/aqs.pdf" target="_blank">&#x8BBA;&#x6587;&#x5730;&#x5740;</a></p>
<p><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/AbstractQueuedSynchronizer.html" target="_blank">docs api</a></p>
<p>Provides a framework for implementing blocking locks and related synchronizers (semaphores, events, etc) that rely on first-in-first-out (FIFO) wait queues. This class is designed to be a useful basis for most kinds of synchronizers that rely on a single atomic int value to represent state. Subclasses must define the protected methods that change this state, and which define what that state means in terms of this object being acquired or released. Given these, the other methods in this class carry out all queuing and blocking mechanics. Subclasses can maintain other state fields, but only the atomically updated int value manipulated using methods getState(), setState(int) and compareAndSetState(int, int) is tracked with respect to synchronization.</p>
<h2 id="aqs&#x6838;&#x5FC3;&#x601D;&#x60F3;&#x5F52;&#x7EB3;">Aqs&#x6838;&#x5FC3;&#x601D;&#x60F3;&#x5F52;&#x7EB3;</h2>
<p>AQS&#x6838;&#x5FC3;&#x601D;&#x60F3;&#x662F;&#xFF1A;<font color="red">&#x5982;&#x679C;&#x88AB;&#x8BF7;&#x6C42;&#x7684;&#x5171;&#x4EAB;&#x8D44;&#x6E90;&#x7A7A;&#x95F2;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x5C06;&#x5F53;&#x524D;&#x8BF7;&#x6C42;&#x8D44;&#x6E90;&#x7684;&#x7EBF;&#x7A0B;&#x8BBE;&#x7F6E;&#x4E3A;&#x6709;&#x6548;&#x7684;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#xFF0C;&#x5C06;&#x5171;&#x4EAB;&#x8D44;&#x6E90;&#x8BBE;&#x7F6E;&#x4E3A;&#x9501;&#x5B9A;&#x72B6;&#x6001;&#xFF1B;&#x5982;&#x679C;&#x5171;&#x4EAB;&#x8D44;&#x6E90;&#x88AB;&#x5360;&#x7528;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x4E00;&#x5B9A;&#x7684;&#x963B;&#x585E;&#x7B49;&#x5F85;&#x5524;&#x9192;&#x673A;&#x5236;&#x6765;&#x4FDD;&#x8BC1;&#x9501;&#x5206;&#x914D;&#x3002;&#x8FD9;&#x4E2A;&#x673A;&#x5236;&#x4E3B;&#x8981;&#x7528;&#x7684;&#x662F;CLH&#x961F;&#x5217;&#x7684;&#x53D8;&#x4F53;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x5C06;&#x6682;&#x65F6;&#x83B7;&#x53D6;&#x4E0D;&#x5230;&#x9501;&#x7684;&#x7EBF;&#x7A0B;&#x52A0;&#x5165;&#x5230;&#x961F;&#x5217;&#x4E2D;</font></p>
<p>CLH&#xFF1A;Craig&#x3001;Landin and Hagersten&#x961F;&#x5217;&#xFF0C;&#x94FE;&#x8868;&#x7ED3;&#x6784;&#xFF0C;AQS&#x4E2D;&#x7684;&#x961F;&#x5217;&#x662F;CLH&#x53D8;&#x4F53;&#x7684;&#x865A;&#x62DF;&#x53CC;&#x5411;&#x961F;&#x5217;&#xFF08;FIFO&#xFF09;&#xFF0C;AQS&#x662F;&#x901A;&#x8FC7;&#x5C06;&#x6BCF;&#x6761;&#x8BF7;&#x6C42;&#x5171;&#x4EAB;&#x8D44;&#x6E90;&#x7684;&#x7EBF;&#x7A0B;&#x5C01;&#x88C5;&#x6210;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x6765;&#x5B9E;&#x73B0;&#x9501;&#x7684;&#x5206;&#x914D;&#x3002;</p>
<p><img src="imgs/aqs-2.png" alt=""></p>
<p>AQS&#x4F7F;&#x7528;&#x4E00;&#x4E2A;<code>volatile</code>&#x7684;int&#x7C7B;&#x578B;&#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x6765;&#x8868;&#x793A;&#x540C;&#x6B65;&#x72B6;&#x6001;&#xFF0C;&#x901A;&#x8FC7;&#x5185;&#x7F6E;&#x7684;FIFO&#x961F;&#x5217;&#x6765;&#x5B8C;&#x6210;&#x8D44;&#x6E90;&#x83B7;&#x53D6;&#x7684;&#x6392;&#x961F;&#x5DE5;&#x4F5C;&#xFF0C;&#x901A;&#x8FC7;CAS&#x5B8C;&#x6210;&#x5BF9;State&#x503C;&#x7684;&#x4FEE;&#x6539;&#x3002;</p>
<h2 id="&#x540C;&#x6B65;&#x5668;">&#x540C;&#x6B65;&#x5668;</h2>
<p>&#x4E24;&#x4E2A;&#x64CD;&#x4F5C;</p>
<ol>
<li><code>acquire</code>&#x64CD;&#x4F5C;&#xFF1A;&#x963B;&#x585E;&#x8C03;&#x7528;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x76F4;&#x5230;&#x6216;&#x9664;&#x975E;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x5141;&#x8BB8;&#x5176;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x3002;</li>
<li><code>release</code>&#x64CD;&#x4F5C;&#xFF1A;&#x5219;&#x662F;&#x901A;&#x8FC7;&#x67D0;&#x79CD;&#x65B9;&#x5F0F;&#x6539;&#x53D8;&#x540C;&#x6B65;&#x72B6;&#x6001;&#xFF0C;&#x4F7F;&#x5F97;&#x4E00;&#x6216;&#x591A;&#x4E2A;&#x88AB;acquire&#x963B;&#x585E;&#x7684;&#x7EBF;&#x7A0B;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x3002;</li>
</ol>
<p>&#x540C;&#x6B65;&#x5668;&#x9700;&#x8981;&#x652F;&#x6301;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>&#x963B;&#x585E;&#x548C;&#x975E;&#x963B;&#x585E;&#xFF08;&#x4F8B;&#x5982;tryLock&#xFF09;&#x7684;&#x540C;&#x6B65;</li>
<li>&#x53EF;&#x9009;&#x7684;&#x8D85;&#x65F6;&#x8BBE;&#x7F6E;&#xFF0C;&#x8BA9;&#x8C03;&#x7528;&#x8005;&#x53EF;&#x4EE5;&#x653E;&#x5F03;&#x7B49;&#x5F85;</li>
<li>&#x901A;&#x8FC7;&#x4E2D;&#x65AD;&#x5B9E;&#x73B0;&#x7684;&#x4EFB;&#x52A1;&#x53D6;&#x6D88;&#xFF0C;&#x901A;&#x5E38;&#x662F;&#x5206;&#x4E3A;&#x4E24;&#x4E2A;&#x7248;&#x672C;&#xFF0C;&#x4E00;&#x4E2A;acquire&#x53EF;&#x53D6;&#x6D88;&#xFF0C;&#x800C;&#x53E6;&#x4E00;&#x4E2A;&#x4E0D;&#x53EF;&#x4EE5;</li>
</ul>
<p>&#x540C;&#x6B65;&#x5668;&#x7684;&#x5B9E;&#x73B0;&#x6839;&#x636E;&#x5176;&#x72B6;&#x6001;&#x662F;&#x5426;<strong>&#x72EC;&#x5360;</strong>&#x800C;&#x6709;&#x6240;&#x4E0D;&#x540C;&#x3002;&#x72EC;&#x5360;&#x72B6;&#x6001;&#x7684;&#x540C;&#x6B65;&#x5668;&#xFF0C;&#x5728;&#x540C;&#x4E00;&#x65F6;&#x95F4;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x963B;&#x585E;&#x70B9;&#xFF0C;&#x800C;<strong>&#x5171;&#x4EAB;</strong>&#x72B6;&#x6001;&#x7684;&#x540C;&#x6B65;&#x5668;&#x53EF;&#x4EE5;&#x540C;&#x65F6;&#x6709;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x5728;&#x6267;&#x884C;&#x3002;&#x4E00;&#x822C;&#x9501;&#x7684;&#x5B9E;&#x73B0;&#x7C7B;&#x5F80;&#x5F80;&#x53EA;&#x7EF4;&#x62A4;&#x72EC;&#x5360;&#x72B6;&#x6001;&#xFF0C;&#x4F46;&#x662F;&#xFF0C;&#x4F8B;&#x5982;&#x8BA1;&#x6570;&#x4FE1;&#x53F7;&#x91CF;&#x5728;&#x6570;&#x91CF;&#x8BB8;&#x53EF;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5141;&#x8BB8;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x540C;&#x65F6;&#x6267;&#x884C;&#x3002;&#x4E3A;&#x4E86;&#x4F7F;&#x6846;&#x67B6;&#x80FD;&#x5F97;&#x5230;&#x5E7F;&#x6CDB;&#x5E94;&#x7528;&#xFF0C;&#x8FD9;&#x4E24;&#x79CD;&#x6A21;&#x5F0F;&#x90FD;&#x8981;&#x652F;&#x6301;&#x3002;</p>
<p>j.u.c&#x5305;&#x91CC;&#x8FD8;&#x5B9A;&#x4E49;&#x4E86;Condition&#x63A5;&#x53E3;&#xFF0C;&#x7528;&#x4E8E;&#x652F;&#x6301;&#x76D1;&#x63A7;&#x5F62;&#x5F0F;&#x7684;await/signal&#x64CD;&#x4F5C;&#xFF0C;&#x8FD9;&#x4E9B;&#x64CD;&#x4F5C;&#x4E0E;&#x72EC;&#x5360;&#x6A21;&#x5F0F;&#x7684;Lock&#x7C7B;&#x6709;&#x5173;&#xFF0C;&#x4E14;Condition&#x7684;&#x5B9E;&#x73B0;&#x5929;&#x751F;&#x5C31;&#x548C;&#x4E0E;&#x5176;&#x5173;&#x8054;&#x7684;Lock&#x7C7B;&#x7D27;&#x5BC6;&#x76F8;&#x5173;</p>
<h2 id="abstractqueuedsynchronizer-&#x76F8;&#x5173;&#x6982;&#x5FF5;">AbstractQueuedSynchronizer &#x76F8;&#x5173;&#x6982;&#x5FF5;</h2>
<p>AbstractQueuedSynchronizer &#x62BD;&#x8C61;&#x7C7B;&#x7684;&#x6CE8;&#x91CA;&#x8BF4;&#x660E;</p>
<ol>
<li>AbstractQueuedSynchronizer &#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x6846;&#x67B6;&#xFF0C;&#x7528;&#x6765;&#x5B9E;&#x73B0;blocking locks &#x548C; &#x4E00;&#x4E9B;&#x540C;&#x6B65;&#x5668;&#xFF0C;&#x4E14;&#x662F;&#x57FA;&#x4E8E;&#x4E00;&#x4E2A;FIFO&#x961F;&#x5217;&#x7684;</li>
<li>AbstractQueuedSynchronizer &#x88AB;&#x8BBE;&#x8BA1;&#x4E3A;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;<code>single atomic {@code int} value</code>&#x6765;&#x8868;&#x793A;&#x72B6;&#x6001;</li>
<li>AbstractQueuedSynchronizer&#x7684;&#x5B50;&#x7C7B;&#x5FC5;&#x987B;&#x53BB;&#x5B9A;&#x4E49;&#x72B6;&#x6001;&#xFF0C;&#x5E76;&#x63D0;&#x4F9B;protected&#x65B9;&#x6CD5;&#x53BB;&#x64CD;&#x4F5C;&#x72B6;&#x6001;&#xFF1A;getState&#x3001;setState&#x4EE5;&#x53CA;compareAndSet</li>
<li>&#x57FA;&#x4E8E;AQS&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x7C7B;&#x5FC5;&#x987B;&#x6839;&#x636E;&#x66B4;&#x9732;&#x51FA;&#x7684;&#x72B6;&#x6001;&#x76F8;&#x5173;&#x7684;&#x65B9;&#x6CD5;&#x5B9A;&#x4E49;tryAcquire&#x548C;tryRelease&#x65B9;&#x6CD5;&#xFF0C;&#x4EE5;&#x63A7;&#x5236;acquire&#x548C;release&#x64CD;&#x4F5C;&#x3002;&#x5F53;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x6EE1;&#x8DB3;&#x65F6;&#xFF0C;tryAcquire&#x65B9;&#x6CD5;&#x5FC5;&#x987B;&#x8FD4;&#x56DE;true&#xFF0C;&#x800C;&#x5F53;&#x65B0;&#x7684;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x5141;&#x8BB8;&#x540E;&#x7EED;acquire&#x65F6;&#xFF0C;tryRelease&#x65B9;&#x6CD5;&#x4E5F;&#x5FC5;&#x987B;&#x8FD4;&#x56DE;true&#x3002;&#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x90FD;&#x63A5;&#x53D7;&#x4E00;&#x4E2A;int&#x7C7B;&#x578B;&#x7684;&#x53C2;&#x6570;&#x7528;&#x4E8E;&#x4F20;&#x9012;&#x60F3;&#x8981;&#x7684;&#x72B6;&#x6001;</li>
</ol>
<h3 id="&#x963B;&#x585E;">&#x963B;&#x585E;</h3>
<p>j.u.c&#x5305;&#x6709;&#x4E00;&#x4E2A;LockSuport&#x7C7B;&#xFF0C;&#x8FD9;&#x4E2A;&#x7C7B;&#x4E2D;&#x5305;&#x542B;&#x4E86;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x65B9;&#x6CD5;<code>LockSupport.park</code>&#x963B;&#x585E;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x9664;&#x975E;/&#x76F4;&#x5230;&#x6709;&#x4E2A;<code>LockSupport.unpark</code>&#x65B9;&#x6CD5;&#x88AB;&#x8C03;&#x7528;&#xFF08;unpark&#x65B9;&#x6CD5;&#x88AB;&#x63D0;&#x524D;&#x8C03;&#x7528;&#x4E5F;&#x662F;&#x53EF;&#x4EE5;&#x7684;&#xFF09;&#x3002;unpark&#x7684;&#x8C03;&#x7528;&#x662F;&#x6CA1;&#x6709;&#x88AB;&#x8BA1;&#x6570;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x5728;&#x4E00;&#x4E2A;park&#x8C03;&#x7528;&#x524D;&#x591A;&#x6B21;&#x8C03;&#x7528;unpark&#x65B9;&#x6CD5;&#x53EA;&#x4F1A;&#x89E3;&#x9664;&#x4E00;&#x4E2A;park&#x64CD;&#x4F5C;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x5B83;&#x4EEC;&#x4F5C;&#x7528;&#x4E8E;&#x6BCF;&#x4E2A;&#x7EBF;&#x7A0B;&#x800C;&#x4E0D;&#x662F;&#x6BCF;&#x4E2A;&#x540C;&#x6B65;&#x5668;&#x3002;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x5728;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x540C;&#x6B65;&#x5668;&#x4E0A;&#x8C03;&#x7528;park&#x64CD;&#x4F5C;&#x53EF;&#x80FD;&#x4F1A;&#x7ACB;&#x5373;&#x8FD4;&#x56DE;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;&#x6B64;&#x4E4B;&#x524D;&#x53EF;&#x80FD;&#x6709;&#x201C;&#x5269;&#x4F59;&#x7684;&#x201D;unpark&#x64CD;&#x4F5C;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x5728;&#x7F3A;&#x5C11;&#x4E00;&#x4E2A;unpark&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x4E0B;&#x4E00;&#x6B21;&#x8C03;&#x7528;park&#x5C31;&#x4F1A;&#x963B;&#x585E;&#x3002;&#x867D;&#x7136;&#x53EF;&#x4EE5;&#x663E;&#x5F0F;&#x5730;&#x6D88;&#x9664;&#x8FD9;&#x4E2A;&#x72B6;&#x6001;&#x4F46;&#x5E76;&#x4E0D;&#x503C;&#x5F97;&#x8FD9;&#x6837;&#x505A;&#x3002;&#x5728;&#x9700;&#x8981;&#x7684;&#x65F6;&#x5019;&#x591A;&#x6B21;&#x8C03;&#x7528;park&#x4F1A;&#x66F4;&#x9AD8;&#x6548;&#x3002;</p>
<p><strong>park</strong>: n. &#x516C;&#x56ED;; &#x4E13;&#x7528;&#x533A;; &#x56ED;&#x533A;; (&#x82F1;&#x56FD;) &#x5E84;&#x56ED;&#xFF0C;&#x5EAD;&#x9662;; v. &#x505C;(&#x8F66;); &#x6CCA;(&#x8F66;); &#x5750;&#x4E0B;(&#x6216;&#x7AD9;&#x7740;); &#x628A;&#x2026;&#x6401;&#x7F6E;&#xFF0C;&#x63A8;&#x8FDF;(&#x5728;&#x4EE5;&#x540E;&#x7684;&#x4F1A;&#x8BAE;&#x4E0A;&#x8BA8;&#x8BBA;&#x6216;&#x5904;&#x7406;);</p>
<h3 id="&#x540C;&#x6B65;&#x64CD;&#x4F5C;">&#x540C;&#x6B65;&#x64CD;&#x4F5C;</h3>
<ul>
<li>&#x72EC;&#x5360;&#x6A21;&#x5F0F;</li>
</ul>
<p><img src="imgs/aqs.png" alt=""></p>
<ul>
<li>&#x5171;&#x4EAB;&#x6A21;&#x5F0F;</li>
</ul>
<p><img src="imgs/aqs-3.png" alt=""></p>
<ul>
<li>AbstractQueuedSynchronizer &#x7684;&#x53D8;&#x91CF;&#xFF1A; &#x6709;CLH&#x961F;&#x5217;&#x7684;&#x5934;&#x90E8;&#xFF0C;&#x5C3E;&#x90E8;&#xFF0C;&#x4EE5;&#x53CA;&#x540C;&#x6B65;&#x5668;&#x72B6;&#x6001;&#x7684;int&#x53D8;&#x91CF;</li>
</ul>
<pre class="language-"><code class="lang-java"><span class="token comment">//&#x7528;&#x4E8E;&#x6807;&#x8BC6;&#x5171;&#x4EAB;&#x9501;</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Node</span> SHARED <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//&#x7528;&#x4E8E;&#x6807;&#x8BC6;&#x72EC;&#x5360;&#x9501;</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Node</span> EXCLUSIVE <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token comment">/**
* &#x56E0;&#x4E3A;&#x8D85;&#x65F6;&#x6216;&#x8005;&#x4E2D;&#x65AD;&#xFF0C;&#x8282;&#x70B9;&#x4F1A;&#x88AB;&#x8BBE;&#x7F6E;&#x4E3A;&#x53D6;&#x6D88;&#x72B6;&#x6001;&#xFF0C;&#x88AB;&#x53D6;&#x6D88;&#x7684;&#x8282;&#x70B9;&#x65F6;&#x4E0D;&#x4F1A;&#x53C2;&#x4E0E;&#x5230;&#x7ADE;&#x4E89;&#x4E2D;&#x7684;&#xFF0C;&#x4ED6;&#x4F1A;&#x4E00;&#x76F4;&#x4FDD;&#x6301;&#x53D6;&#x6D88;&#x72B6;&#x6001;&#x4E0D;&#x4F1A;&#x8F6C;&#x53D8;&#x4E3A;&#x5176;&#x4ED6;&#x72B6;&#x6001;&#xFF1B;
*/</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> CANCELLED <span class="token operator">=</span>  <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">/**
* &#x5F53;&#x524D;&#x8282;&#x70B9;&#x91CA;&#x653E;&#x9501;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9700;&#x8981;&#x5524;&#x9192;&#x4E0B;&#x4E00;&#x4E2A;&#x8282;&#x70B9;
*/</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> SIGNAL    <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">/**
* &#x8282;&#x70B9;&#x5728;&#x7B49;&#x5F85;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x8282;&#x70B9;&#x7EBF;&#x7A0B;&#x7B49;&#x5F85;Condition&#x5524;&#x9192;
*/</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> CONDITION <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">;</span>

<span class="token comment">/**
* &#x8868;&#x793A;&#x4E0B;&#x4E00;&#x6B21;&#x5171;&#x4EAB;&#x5F0F;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x83B7;&#x53D6;&#x5C06;&#x4F1A;&#x65E0;&#x6761;&#x4EF6;&#x5730;&#x4F20;&#x64AD;&#x4E0B;&#x53BB;
*/</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> PROPAGATE <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">;</span>

<span class="token comment">/** &#x7B49;&#x5F85;&#x72B6;&#x6001; */</span>
<span class="token keyword">volatile</span> <span class="token keyword">int</span> waitStatus<span class="token punctuation">;</span>

<span class="token comment">/** &#x524D;&#x9A71;&#x8282;&#x70B9; */</span>
<span class="token keyword">volatile</span> <span class="token class-name">Node</span> prev<span class="token punctuation">;</span>

<span class="token comment">/** &#x540E;&#x7EE7;&#x8282;&#x70B9; */</span>
<span class="token keyword">volatile</span> <span class="token class-name">Node</span> next<span class="token punctuation">;</span>

<span class="token comment">/** &#x8282;&#x70B9;&#x7EBF;&#x7A0B; */</span>
<span class="token keyword">volatile</span> <span class="token class-name">Thread</span> thread<span class="token punctuation">;</span>

<span class="token comment">//</span>
<span class="token class-name">Node</span> nextWaiter<span class="token punctuation">;</span>
</code></pre>
<h3 id="fifo&#x961F;&#x5217;clh-&#x961F;&#x5217;&#xFF0C;&#x53CC;&#x5411;&#x94FE;&#x8868;">FIFO&#x961F;&#x5217;(CLH &#x961F;&#x5217;&#xFF0C;&#x53CC;&#x5411;&#x94FE;&#x8868;)</h3>
<p>&#x6574;&#x4E2A;&#x6846;&#x67B6;&#x7684;&#x5173;&#x952E;&#x5C31;&#x662F;&#x5982;&#x4F55;&#x7BA1;&#x7406;&#x88AB;&#x963B;&#x585E;&#x7684;&#x7EBF;&#x7A0B;&#x7684;&#x961F;&#x5217;&#xFF0C;&#x8BE5;&#x961F;&#x5217;&#x662F;&#x4E25;&#x683C;&#x7684;FIFO&#x961F;&#x5217;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x6846;&#x67B6;&#x4E0D;&#x652F;&#x6301;&#x57FA;&#x4E8E;&#x4F18;&#x5148;&#x7EA7;&#x7684;&#x540C;&#x6B65;&#x3002;</p>
<p>&#x81EA;&#x65CB;&#x5224;&#x65AD;&#x524D;&#x9A71;&#x8282;&#x70B9;&#x662F;&#x5426;&#x91CA;&#x653E;&#x4E86;&#x9501;&#xFF1A;&#x5982;&#x679C;&#x524D;&#x9A71;&#x6CA1;&#x6709;&#x91CA;&#x653E;&#x9501;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4E00;&#x76F4;&#x81EA;&#x65CB;&#xFF1B;&#x5426;&#x5219;&#x5C31;&#x80FD;&#x83B7;&#x53D6;&#x5230;&#x9501;&#xFF0C;&#x7ED3;&#x675F;&#x81EA;&#x65CB;</p>
<h4 id="acquirequeued&#x65B9;&#x6CD5;&#x4E2D;&#x4F1A;&#x4F7F;&#x7EBF;&#x7A0B;&#x81EA;&#x65CB;&#x963B;&#x585E;&#xFF0C;&#x76F4;&#x5230;&#x83B7;&#x53D6;&#x5230;&#x9501;"><code>acquireQueued</code>&#x65B9;&#x6CD5;&#x4E2D;&#x4F1A;&#x4F7F;&#x7EBF;&#x7A0B;&#x81EA;&#x65CB;&#x963B;&#x585E;&#xFF0C;&#x76F4;&#x5230;&#x83B7;&#x53D6;&#x5230;&#x9501;</h4>
<pre class="language-"><code class="lang-java"><span class="token comment">/**
    * Acquires in exclusive uninterruptible mode for thread already in
    * queue. Used by condition wait methods as well as acquire.
    *
    * @param node the nodxe
    * @param arg the acquire argument
    * @return {@code true} if interrupted while waiting
    */</span>
<span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">acquireQueued</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Node</span> node<span class="token punctuation">,</span> <span class="token keyword">int</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">boolean</span> failed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">boolean</span> interrupted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">final</span> <span class="token class-name">Node</span> p <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">predecessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">==</span> head <span class="token operator">&amp;&amp;</span> <span class="token function">tryAcquire</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">setHead</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
                p<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// help GC</span>
                failed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> interrupted<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">shouldParkAfterFailedAcquire</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> node<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                <span class="token function">parkAndCheckInterrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                interrupted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>failed<span class="token punctuation">)</span>
            <span class="token function">cancelAcquire</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="addwaiter&#x65B9;&#x6CD5;&#x4F1A;&#x5C06;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x5C01;&#x88C5;&#x6210;node&#x8282;&#x70B9;&#xFF0C;cas&#x64CD;&#x4F5C;&#x8FFD;&#x52A0;&#x5728;&#x961F;&#x5C3E;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;&#x8BE5;&#x8282;&#x70B9;"><code>addWaiter</code>&#x65B9;&#x6CD5;&#x4F1A;&#x5C06;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x5C01;&#x88C5;&#x6210;Node&#x8282;&#x70B9;&#xFF0C;CAS&#x64CD;&#x4F5C;&#x8FFD;&#x52A0;&#x5728;&#x961F;&#x5C3E;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;&#x8BE5;&#x8282;&#x70B9;</h4>
<pre class="language-"><code class="lang-java"><span class="token comment">/**
    * Creates and enqueues node for current thread and given mode.
    *
    * @param mode Node.EXCLUSIVE for exclusive, Node.SHARED for shared
    * @return the new node
    */</span>
<span class="token keyword">private</span> <span class="token class-name">Node</span> <span class="token function">addWaiter</span><span class="token punctuation">(</span><span class="token class-name">Node</span> mode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Node</span> node <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// &#x5C06;&#x8BE5;&#x7EBF;&#x7A0B;&#x8282;&#x70B9;&#x52A0;&#x5165;&#x5230;&#x961F;&#x5217;&#x7684;&#x5C3E;&#x90E8;,&#x5934;&#x5C3E;&#x6307;&#x9488;&#x53D8;&#x5316;</span>
    <span class="token comment">// Try the fast path of enq; backup to full enq on failure</span>
    <span class="token class-name">Node</span> pred <span class="token operator">=</span> tail<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pred <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        node<span class="token punctuation">.</span>prev <span class="token operator">=</span> pred<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">compareAndSetTail</span><span class="token punctuation">(</span>pred<span class="token punctuation">,</span> node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            pred<span class="token punctuation">.</span>next <span class="token operator">=</span> node<span class="token punctuation">;</span>
            <span class="token keyword">return</span> node<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">enq</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> node<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

&#x5728;`addWaiter`&#x65B9;&#x6CD5;&#x5904;&#x7406;&#x5931;&#x8D25;&#x7684;&#x65F6;&#x5019;&#x8FDB;&#x4E00;&#x6B65;&#x4F1A;&#x8C03;&#x7528;`enq`&#x65B9;&#x6CD5;

#### `enq`&#x65B9;&#x6CD5;&#x4F1A;&#x5C06;&#x5C06;node&#x52A0;&#x5165;&#x961F;&#x5C3E;&#xFF0C;&#x4E0D;&#x65AD;&#x7684;&#x8FDB;&#x884C;CAS&#x64CD;&#x4F5C;

<span class="token comment">/**
    * Inserts node into queue, initializing if necessary. See picture above.
    * @param node the node to insert
    * @return node&apos;s predecessor
    */</span>
<span class="token keyword">private</span> <span class="token class-name">Node</span> <span class="token function">enq</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Node</span> node<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Node</span> t <span class="token operator">=</span> tail<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Must initialize</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">compareAndSetHead</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                tail <span class="token operator">=</span> head<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            node<span class="token punctuation">.</span>prev <span class="token operator">=</span> t<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">compareAndSetTail</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                t<span class="token punctuation">.</span>next <span class="token operator">=</span> node<span class="token punctuation">;</span>
                <span class="token keyword">return</span> t<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x901A;&#x8FC7;<code>&#x81EA;&#x65CB;</code>(CAS&#x64CD;&#x4F5C;)&#x6765;&#x4FDD;&#x8BC1;&#x8BE5;&#x8282;&#x70B9;&#x80FD;&#x987A;&#x5229;&#x7684;&#x52A0;&#x5165;&#x5230;&#x961F;&#x5217;&#x5C3E;&#x90E8;&#xFF0C;&#x53EA;&#x6709;&#x52A0;&#x5165;&#x6210;&#x529F;&#x624D;&#x4F1A;&#x9000;&#x51FA;&#x5FAA;&#x73AF;&#xFF0C;&#x5426;&#x5219;&#x4F1A;&#x4E00;&#x76F4;&#x81EA;&#x65CB;&#x76F4;&#x5230;&#x6210;&#x529F;&#x3002;</p>
<h3 id="&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;abstractqueuedsynchronizer&#x62BD;&#x8C61;&#x7C7B;&#x548C;lock&#x63A5;&#x53E3;">&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;AbstractQueuedSynchronizer&#x62BD;&#x8C61;&#x7C7B;&#x548C;Lock&#x63A5;&#x53E3;</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">class</span> <span class="token class-name">Sync</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractQueuedSynchronizer</span> <span class="token punctuation">{</span>
    <span class="token comment">// Reports whether in locked</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">isHeldExclusively</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// status &#x4E3A;0&#x80FD;&#x83B7;&#x53D6;&#x9501;&#xFF1B;&#x81EA;&#x65CB;&#x8BBE;&#x7F6E;&#x4E3A;1&#xFF0C;&#x8868;&#x793A;&#x83B7;&#x53D6;&#x5230;&#x9501;&#x4E86;</span>
    <span class="token comment">// Acquires the lock if state is zero</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">tryAcquire</span><span class="token punctuation">(</span><span class="token keyword">int</span> acquires<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">assert</span> acquires <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// Otherwise unused</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">compareAndSetState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">setExclusiveOwnerThread</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// &#x91CA;&#x653E;&#x9501;&#xFF0C;&#x8981;&#x628A;&#x72B6;&#x6001;&#x8BBE;&#x7F6E;&#x4E3A;0</span>
    <span class="token comment">// Releases the lock by setting state to zero</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">tryRelease</span><span class="token punctuation">(</span><span class="token keyword">int</span> releases<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">assert</span> releases <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// Otherwise unused</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalMonitorStateException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">setExclusiveOwnerThread</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Provides a Condition</span>
    <span class="token class-name">Condition</span> <span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ConditionObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Deserializes properly</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">readObject</span><span class="token punctuation">(</span><span class="token class-name">ObjectInputStream</span> s<span class="token punctuation">)</span>
            <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span>
        s<span class="token punctuation">.</span><span class="token function">defaultReadObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// reset to unlocked state</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">SelfLock</span> <span class="token keyword">implements</span> <span class="token class-name">Lock</span><span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Sync</span> sync <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        sync<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">lockInterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        sync<span class="token punctuation">.</span><span class="token function">acquireInterruptibly</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> sync<span class="token punctuation">.</span><span class="token function">tryAcquire</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token keyword">long</span> time<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> sync<span class="token punctuation">.</span><span class="token function">tryAcquireNanos</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> unit<span class="token punctuation">.</span><span class="token function">toNanos</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        sync<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Condition</span> <span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> sync<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><footer class="page-footer"><span class="copyright">Copyright @doctording all right reserved&#xFF0C;powered by Gitbook</span><span class="footer-modification">&#x8BE5;&#x6587;&#x4EF6;&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;
2020-08-03 21:58:12
</span></footer><div id="gitalk-container"></div><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://cdn.bootcss.com/blueimp-md5/2.12.0/js/md5.min.js"></script><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                
                <a href="cas.html" class="navigation navigation-next navigation-unique" aria-label="Next page: CAS(Conmpare And Swap/Exchange) & unsafe">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"AQS","layout":"page","date":"2020-20-15 00:00","level":"1.10.1","depth":2,"next":{"title":"CAS(Conmpare And Swap/Exchange) & unsafe","level":"1.10.2","depth":2,"path":"content/java_thread_concurrent/cas.md","ref":"./content/java_thread_concurrent/cas.md","articles":[]},"previous":{"title":"[Java多线程 & 并发基础]","level":"1.10","depth":1,"ref":"","articles":[{"title":"AQS","level":"1.10.1","depth":2,"path":"content/java_thread_concurrent/aqs.md","ref":"./content/java_thread_concurrent/aqs.md","articles":[]},{"title":"CAS(Conmpare And Swap/Exchange) & unsafe","level":"1.10.2","depth":2,"path":"content/java_thread_concurrent/cas.md","ref":"./content/java_thread_concurrent/cas.md","articles":[]},{"title":"volatile 关键字","level":"1.10.3","depth":2,"path":"content/java_thread_concurrent/volatile.md","ref":"./content/java_thread_concurrent/volatile.md","articles":[]},{"title":"synchronized 关键字","level":"1.10.4","depth":2,"path":"content/java_thread_concurrent/synchronized.md","ref":"./content/java_thread_concurrent/synchronized.md","articles":[]},{"title":"线程基础","level":"1.10.5","depth":2,"path":"content/java_thread_concurrent/thread_basic.md","ref":"./content/java_thread_concurrent/thread_basic.md","articles":[{"title":"Condition","level":"1.10.5.1","depth":3,"path":"content/java_thread_concurrent/thread_condition.md","ref":"./content/java_thread_concurrent/thread_condition.md","articles":[]},{"title":"Semaphore","level":"1.10.5.2","depth":3,"path":"content/java_thread_concurrent/semaphore.md","ref":"./content/java_thread_concurrent/semaphore.md","articles":[]},{"title":"Hook线程","level":"1.10.5.3","depth":3,"path":"content/java_thread_concurrent/hook_thread.md","ref":"./content/java_thread_concurrent/hook_thread.md","articles":[]},{"title":"CountDownLatch & CyclicBarrier","level":"1.10.5.4","depth":3,"path":"content/java_thread_concurrent/countdownlatch_cyclicBarrier.md","ref":"./content/java_thread_concurrent/countdownlatch_cyclicBarrier.md","articles":[]},{"title":"LongAdder","level":"1.10.5.5","depth":3,"path":"content/java_thread_concurrent/longAdder.md","ref":"./content/java_thread_concurrent/longAdder.md","articles":[]},{"title":"多线程设计模式","level":"1.10.5.6","depth":3,"path":"content/java_thread_concurrent/thread_design.md","ref":"./content/java_thread_concurrent/thread_design.md","articles":[]}]},{"title":"[线程池]","level":"1.10.6","depth":2,"ref":"","articles":[{"title":"Java线程池","level":"1.10.6.1","depth":3,"path":"content/java_thread_concurrent/thread_pool.md","ref":"./content/java_thread_concurrent/thread_pool.md","articles":[]},{"title":"常见的多线程题目","level":"1.10.6.2","depth":3,"path":"content/java_thread_concurrent/concurrency_problems.md","ref":"./content/java_thread_concurrent/concurrency_problems.md","articles":[]},{"title":"自定义线程池","level":"1.10.6.3","depth":3,"path":"content/java_thread_concurrent/thread_pool_self.md","ref":"./content/java_thread_concurrent/thread_pool_self.md","articles":[]}]},{"title":"Java Lock","level":"1.10.7","depth":2,"path":"content/java_thread_concurrent/thread_lock.md","ref":"./content/java_thread_concurrent/thread_lock.md","articles":[]},{"title":"死锁问题","level":"1.10.8","depth":2,"path":"content/java_thread_concurrent/thread_deadlock.md","ref":"./content/java_thread_concurrent/thread_deadlock.md","articles":[]},{"title":"ThreadLocal对象","level":"1.10.9","depth":2,"path":"content/java_thread_concurrent/threadLocal.md","ref":"./content/java_thread_concurrent/threadLocal.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["prism","-highlight","-lunr","-search","-sharing","ace","codeblock-filename","search-plus","sectionx","splitter","tbfed-pagefooter","expandable-chapters","back-to-top-button","code","uml","page-treeview","gittalk"],"styles":{"website":"styles/website.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright @doctording","modify_label":"该文件修改时间：","modify_format":"YYYY-MM-DD HH:mm:ss"},"page-treeview":{"collapsed":false,"copyright":"Copyright @doctording","minHeaderCount":"2","minHeaderDeep":"2"},"prism":{},"ace":{},"splitter":{},"code":{"copyButtons":true},"fontsettings":{"theme":"white","family":"sans","size":2},"sectionx":{},"uml":{"format":"svg"},"codeblock-filename":{},"back-to-top-button":{},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"gittalk":{"clientID":"094729e19245d3fe84aa","clientSecret":"6c4cf7b48e7ae41c20d453c24eb9d5469e4d19fb","repo":"sword_at_offer","owner":"doctording","admin":["doctording"],"distractionFreeMode":false},"expandable-chapters":{},"search-plus":{}},"theme":"default","author":"doctording","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"java-note","language":"zh-hans","gitbook":"*","description":"Java开发"},"file":{"path":"content/java_thread_concurrent/aqs.md","mtime":"2020-08-03T13:58:12.435Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-08-27T15:04:59.989Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-ace/ace/ace.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-ace/ace.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sectionx/sectionx.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-gittalk/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

